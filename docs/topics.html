<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>mrgsolve User Guide</title>
  <meta name="description" content="A guide to using mrgsolve.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="mrgsolve User Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to using mrgsolve." />
  <meta name="github-repo" content="metrumresearchgroup/mrgsolve" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="mrgsolve User Guide" />
  
  <meta name="twitter:description" content="A guide to using mrgsolve." />
  

<meta name="author" content="Metrum Research Group, LLC">


<meta name="date" content="2018-09-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="simulated-output.html">
<link rel="next" href="section-sequence.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">User Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> mrgsolve User Guide</a></li>
<li class="chapter" data-level="2" data-path="model-components.html"><a href="model-components.html"><i class="fa fa-check"></i><b>2</b> Model components</a><ul>
<li class="chapter" data-level="2.1" data-path="model-components.html"><a href="model-components.html#component-param"><i class="fa fa-check"></i><b>2.1</b> Parameter list</a><ul>
<li class="chapter" data-level="2.1.1" data-path="model-components.html"><a href="model-components.html#central-role-of-parameters-in-planning-simulations"><i class="fa fa-check"></i><b>2.1.1</b> Central role of parameters in planning simulations</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="model-components.html"><a href="model-components.html#component-init"><i class="fa fa-check"></i><b>2.2</b> Compartment list</a></li>
<li class="chapter" data-level="2.3" data-path="model-components.html"><a href="model-components.html#component-stime"><i class="fa fa-check"></i><b>2.3</b> Simulation time grid</a><ul>
<li class="chapter" data-level="2.3.1" data-path="model-components.html"><a href="model-components.html#component-tgrid"><i class="fa fa-check"></i><b>2.3.1</b> <code>tgrid</code> objects</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-components.html"><a href="model-components.html#solver-settings"><i class="fa fa-check"></i><b>2.4</b> Solver settings</a><ul>
<li class="chapter" data-level="2.4.1" data-path="model-components.html"><a href="model-components.html#atol"><i class="fa fa-check"></i><b>2.4.1</b> <code>atol</code></a></li>
<li class="chapter" data-level="2.4.2" data-path="model-components.html"><a href="model-components.html#rtol"><i class="fa fa-check"></i><b>2.4.2</b> <code>rtol</code></a></li>
<li class="chapter" data-level="2.4.3" data-path="model-components.html"><a href="model-components.html#maxsteps"><i class="fa fa-check"></i><b>2.4.3</b> <code>maxsteps</code></a></li>
<li class="chapter" data-level="2.4.4" data-path="model-components.html"><a href="model-components.html#hmax"><i class="fa fa-check"></i><b>2.4.4</b> <code>hmax</code></a></li>
<li class="chapter" data-level="2.4.5" data-path="model-components.html"><a href="model-components.html#hmin"><i class="fa fa-check"></i><b>2.4.5</b> <code>hmin</code></a></li>
<li class="chapter" data-level="2.4.6" data-path="model-components.html"><a href="model-components.html#ixpr"><i class="fa fa-check"></i><b>2.4.6</b> <code>ixpr</code></a></li>
<li class="chapter" data-level="2.4.7" data-path="model-components.html"><a href="model-components.html#mxhnil"><i class="fa fa-check"></i><b>2.4.7</b> <code>mxhnil</code></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="model-components.html"><a href="model-components.html#functions"><i class="fa fa-check"></i><b>2.5</b> Functions</a><ul>
<li class="chapter" data-level="2.5.1" data-path="model-components.html"><a href="model-components.html#the-main-function"><i class="fa fa-check"></i><b>2.5.1</b> The <code>$MAIN</code> function</a></li>
<li class="chapter" data-level="2.5.2" data-path="model-components.html"><a href="model-components.html#the-ode-function"><i class="fa fa-check"></i><b>2.5.2</b> The <code>$ODE</code> function</a></li>
<li class="chapter" data-level="2.5.3" data-path="model-components.html"><a href="model-components.html#the-table-function"><i class="fa fa-check"></i><b>2.5.3</b> The <code>$TABLE</code> function</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="model-components.html"><a href="model-components.html#random-effect-variances"><i class="fa fa-check"></i><b>2.6</b> Random effect variances</a><ul>
<li class="chapter" data-level="2.6.1" data-path="model-components.html"><a href="model-components.html#omega"><i class="fa fa-check"></i><b>2.6.1</b> <code>OMEGA</code></a></li>
<li class="chapter" data-level="2.6.2" data-path="model-components.html"><a href="model-components.html#sigma"><i class="fa fa-check"></i><b>2.6.2</b> <code>SIGMA</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-specification.html"><a href="model-specification.html"><i class="fa fa-check"></i><b>3</b> Model specification</a><ul>
<li class="chapter" data-level="3.1" data-path="model-specification.html"><a href="model-specification.html#how-where-to-write-a-model"><i class="fa fa-check"></i><b>3.1</b> How / where to write a model</a><ul>
<li class="chapter" data-level="3.1.1" data-path="model-specification.html"><a href="model-specification.html#spec-separate-file"><i class="fa fa-check"></i><b>3.1.1</b> Separate file</a></li>
<li class="chapter" data-level="3.1.2" data-path="model-specification.html"><a href="model-specification.html#spec-inline"><i class="fa fa-check"></i><b>3.1.2</b> Inline / <code>code</code>  </a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="model-specification.html"><a href="model-specification.html#code-blocks"><i class="fa fa-check"></i><b>3.2</b> Code blocks</a><ul>
<li class="chapter" data-level="3.2.1" data-path="model-specification.html"><a href="model-specification.html#about-code-blocks"><i class="fa fa-check"></i><b>3.2.1</b> About code blocks</a></li>
<li class="chapter" data-level="3.2.2" data-path="model-specification.html"><a href="model-specification.html#block-param"><i class="fa fa-check"></i><b>3.2.2</b> <code>$PARAM</code>  </a></li>
<li class="chapter" data-level="3.2.3" data-path="model-specification.html"><a href="model-specification.html#block-fixed"><i class="fa fa-check"></i><b>3.2.3</b> <code>$FIXED</code>  </a></li>
<li class="chapter" data-level="3.2.4" data-path="model-specification.html"><a href="model-specification.html#cmt-and-init"><i class="fa fa-check"></i><b>3.2.4</b> <code>$CMT</code> and <code>$INIT</code></a></li>
<li class="chapter" data-level="3.2.5" data-path="model-specification.html"><a href="model-specification.html#block-main"><i class="fa fa-check"></i><b>3.2.5</b> <code>$MAIN</code>  </a></li>
<li class="chapter" data-level="3.2.6" data-path="model-specification.html"><a href="model-specification.html#block-ode"><i class="fa fa-check"></i><b>3.2.6</b> <code>$ODE</code>  </a></li>
<li class="chapter" data-level="3.2.7" data-path="model-specification.html"><a href="model-specification.html#block-table"><i class="fa fa-check"></i><b>3.2.7</b> <code>$TABLE</code>  </a></li>
<li class="chapter" data-level="3.2.8" data-path="model-specification.html"><a href="model-specification.html#block-preamble"><i class="fa fa-check"></i><b>3.2.8</b> <code>$PREAMBLE</code>  </a></li>
<li class="chapter" data-level="3.2.9" data-path="model-specification.html"><a href="model-specification.html#block-capture"><i class="fa fa-check"></i><b>3.2.9</b> <code>$CAPTURE</code>  </a></li>
<li class="chapter" data-level="3.2.10" data-path="model-specification.html"><a href="model-specification.html#block-omega"><i class="fa fa-check"></i><b>3.2.10</b> <code>$OMEGA</code>  </a></li>
<li class="chapter" data-level="3.2.11" data-path="model-specification.html"><a href="model-specification.html#block-sigma"><i class="fa fa-check"></i><b>3.2.11</b> <code>$SIGMA</code>  </a></li>
<li class="chapter" data-level="3.2.12" data-path="model-specification.html"><a href="model-specification.html#set"><i class="fa fa-check"></i><b>3.2.12</b> <code>$SET</code></a></li>
<li class="chapter" data-level="3.2.13" data-path="model-specification.html"><a href="model-specification.html#global"><i class="fa fa-check"></i><b>3.2.13</b> <code>$GLOBAL</code></a></li>
<li class="chapter" data-level="3.2.14" data-path="model-specification.html"><a href="model-specification.html#pkmodel"><i class="fa fa-check"></i><b>3.2.14</b> <code>$PKMODEL</code></a></li>
<li class="chapter" data-level="3.2.15" data-path="model-specification.html"><a href="model-specification.html#block-plugin"><i class="fa fa-check"></i><b>3.2.15</b> <code>$PLUGIN</code>  </a></li>
<li class="chapter" data-level="3.2.16" data-path="model-specification.html"><a href="model-specification.html#block-theta"><i class="fa fa-check"></i><b>3.2.16</b> <code>$THETA</code>  </a></li>
<li class="chapter" data-level="3.2.17" data-path="model-specification.html"><a href="model-specification.html#block-nmxml"><i class="fa fa-check"></i><b>3.2.17</b> <code>$NMXML</code>  </a></li>
<li class="chapter" data-level="3.2.18" data-path="model-specification.html"><a href="model-specification.html#block-include"><i class="fa fa-check"></i><b>3.2.18</b> <code>$INCLUDE</code>  </a></li>
<li class="chapter" data-level="3.2.19" data-path="model-specification.html"><a href="model-specification.html#block-env"><i class="fa fa-check"></i><b>3.2.19</b> <code>$ENV</code>  </a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="model-specification.html"><a href="model-specification.html#variables-and-macros"><i class="fa fa-check"></i><b>3.3</b> Variables and Macros</a><ul>
<li class="chapter" data-level="3.3.1" data-path="model-specification.html"><a href="model-specification.html#id"><i class="fa fa-check"></i><b>3.3.1</b> <code>ID</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="model-specification.html"><a href="model-specification.html#time"><i class="fa fa-check"></i><b>3.3.2</b> <code>TIME</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="model-specification.html"><a href="model-specification.html#solvertime"><i class="fa fa-check"></i><b>3.3.3</b> <code>SOLVERTIME</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="model-specification.html"><a href="model-specification.html#evid"><i class="fa fa-check"></i><b>3.3.4</b> <code>EVID</code></a></li>
<li class="chapter" data-level="3.3.5" data-path="model-specification.html"><a href="model-specification.html#newind"><i class="fa fa-check"></i><b>3.3.5</b> <code>NEWIND</code></a></li>
<li class="chapter" data-level="3.3.6" data-path="model-specification.html"><a href="model-specification.html#self.cmt"><i class="fa fa-check"></i><b>3.3.6</b> <code>self.cmt</code></a></li>
<li class="chapter" data-level="3.3.7" data-path="model-specification.html"><a href="model-specification.html#self.amt"><i class="fa fa-check"></i><b>3.3.7</b> <code>self.amt</code></a></li>
<li class="chapter" data-level="3.3.8" data-path="model-specification.html"><a href="model-specification.html#self.nid"><i class="fa fa-check"></i><b>3.3.8</b> <code>self.nid</code></a></li>
<li class="chapter" data-level="3.3.9" data-path="model-specification.html"><a href="model-specification.html#self.idn"><i class="fa fa-check"></i><b>3.3.9</b> <code>self.idn</code></a></li>
<li class="chapter" data-level="3.3.10" data-path="model-specification.html"><a href="model-specification.html#self.nrow"><i class="fa fa-check"></i><b>3.3.10</b> <code>self.nrow</code></a></li>
<li class="chapter" data-level="3.3.11" data-path="model-specification.html"><a href="model-specification.html#self.rown"><i class="fa fa-check"></i><b>3.3.11</b> <code>self.rown</code></a></li>
<li class="chapter" data-level="3.3.12" data-path="model-specification.html"><a href="model-specification.html#etan"><i class="fa fa-check"></i><b>3.3.12</b> <code>ETA(n)</code></a></li>
<li class="chapter" data-level="3.3.13" data-path="model-specification.html"><a href="model-specification.html#epsn"><i class="fa fa-check"></i><b>3.3.13</b> <code>EPS(n)</code></a></li>
<li class="chapter" data-level="3.3.14" data-path="model-specification.html"><a href="model-specification.html#tablename"><i class="fa fa-check"></i><b>3.3.14</b> <code>table(name)</code></a></li>
<li class="chapter" data-level="3.3.15" data-path="model-specification.html"><a href="model-specification.html#spec-f"><i class="fa fa-check"></i><b>3.3.15</b> <code>F_CMT</code>  </a></li>
<li class="chapter" data-level="3.3.16" data-path="model-specification.html"><a href="model-specification.html#spec-alag"><i class="fa fa-check"></i><b>3.3.16</b> <code>ALAG_CMT</code>  </a></li>
<li class="chapter" data-level="3.3.17" data-path="model-specification.html"><a href="model-specification.html#spec-r"><i class="fa fa-check"></i><b>3.3.17</b> <code>R_CMT</code>  </a></li>
<li class="chapter" data-level="3.3.18" data-path="model-specification.html"><a href="model-specification.html#spec-d"><i class="fa fa-check"></i><b>3.3.18</b> <code>D_CMT</code>  </a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="model-specification.html"><a href="model-specification.html#new-variables"><i class="fa fa-check"></i><b>3.4</b> Derive new variables</a></li>
<li class="chapter" data-level="3.5" data-path="model-specification.html"><a href="model-specification.html#examples"><i class="fa fa-check"></i><b>3.5</b> Examples</a><ul>
<li class="chapter" data-level="3.5.1" data-path="model-specification.html"><a href="model-specification.html#simple-pk-model"><i class="fa fa-check"></i><b>3.5.1</b> Simple PK model</a></li>
<li class="chapter" data-level="3.5.2" data-path="model-specification.html"><a href="model-specification.html#pkpd-model"><i class="fa fa-check"></i><b>3.5.2</b> PK/PD model</a></li>
<li class="chapter" data-level="3.5.3" data-path="model-specification.html"><a href="model-specification.html#population-pk-model-with-covariates-and-iov"><i class="fa fa-check"></i><b>3.5.3</b> Population PK model with covariates and IOV</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="input-data-sets.html"><a href="input-data-sets.html"><i class="fa fa-check"></i><b>4</b> Input data sets</a><ul>
<li class="chapter" data-level="4.1" data-path="input-data-sets.html"><a href="input-data-sets.html#datasets"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="input-data-sets.html"><a href="input-data-sets.html#data-set"><i class="fa fa-check"></i><b>4.2</b> Event data sets (<code>data</code>)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="input-data-sets.html"><a href="input-data-sets.html#two-types-of-data_set"><i class="fa fa-check"></i><b>4.2.1</b> Two types of <code>data_set</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="input-data-sets.html"><a href="input-data-sets.html#sorting-requirements"><i class="fa fa-check"></i><b>4.2.2</b> Sorting requirements</a></li>
<li class="chapter" data-level="4.2.3" data-path="input-data-sets.html"><a href="input-data-sets.html#creating-data-sets"><i class="fa fa-check"></i><b>4.2.3</b> Creating data sets</a></li>
<li class="chapter" data-level="4.2.4" data-path="input-data-sets.html"><a href="input-data-sets.html#example"><i class="fa fa-check"></i><b>4.2.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="input-data-sets.html"><a href="input-data-sets.html#idata-set"><i class="fa fa-check"></i><b>4.3</b> Individual data sets (<code>idata</code>)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="input-data-sets.html"><a href="input-data-sets.html#use-case"><i class="fa fa-check"></i><b>4.3.1</b> Use case</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="input-data-sets.html"><a href="input-data-sets.html#numeric-only"><i class="fa fa-check"></i><b>4.4</b> Numeric data only</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="simulated-output.html"><a href="simulated-output.html"><i class="fa fa-check"></i><b>5</b> Simulated output</a><ul>
<li class="chapter" data-level="5.1" data-path="simulated-output.html"><a href="simulated-output.html#coersion-methods"><i class="fa fa-check"></i><b>5.1</b> Coersion methods</a></li>
<li class="chapter" data-level="5.2" data-path="simulated-output.html"><a href="simulated-output.html#query-methods"><i class="fa fa-check"></i><b>5.2</b> Query methods</a></li>
<li class="chapter" data-level="5.3" data-path="simulated-output.html"><a href="simulated-output.html#methods-for-dplyr-verbs"><i class="fa fa-check"></i><b>5.3</b> Methods for <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="topics.html"><a href="topics.html"><i class="fa fa-check"></i><b>6</b> Topics</a><ul>
<li class="chapter" data-level="6.1" data-path="topics.html"><a href="topics.html#topic-annotated"><i class="fa fa-check"></i><b>6.1</b> Annotated model specification</a></li>
<li class="chapter" data-level="6.2" data-path="topics.html"><a href="topics.html#topic-init"><i class="fa fa-check"></i><b>6.2</b> Set initial conditions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="topics.html"><a href="topics.html#summary"><i class="fa fa-check"></i><b>6.2.1</b> Summary</a></li>
<li class="chapter" data-level="6.2.2" data-path="topics.html"><a href="topics.html#make-a-model-only-to-examine-init-behavior"><i class="fa fa-check"></i><b>6.2.2</b> Make a model only to examine <code>init</code> behavior</a></li>
<li class="chapter" data-level="6.2.3" data-path="topics.html"><a href="topics.html#example-pkpd-model-with-initial-condition"><i class="fa fa-check"></i><b>6.2.3</b> Example PK/PD model with initial condition</a></li>
<li class="chapter" data-level="6.2.4" data-path="topics.html"><a href="topics.html#remember-calling-init-will-let-you-check-to-see-what-is-going-on"><i class="fa fa-check"></i><b>6.2.4</b> Remember: calling <code>init</code> will let you check to see what is going on</a></li>
<li class="chapter" data-level="6.2.5" data-path="topics.html"><a href="topics.html#set-initial-conditions-via-idata"><i class="fa fa-check"></i><b>6.2.5</b> Set initial conditions via <code>idata</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="topics.html"><a href="topics.html#topic-parameter-update"><i class="fa fa-check"></i><b>6.3</b> Updating parameters</a><ul>
<li class="chapter" data-level="6.3.1" data-path="topics.html"><a href="topics.html#parameter-update-hierarchy"><i class="fa fa-check"></i><b>6.3.1</b> Parameter update hierarchy</a></li>
<li class="chapter" data-level="6.3.2" data-path="topics.html"><a href="topics.html#topic-parameter-update-base"><i class="fa fa-check"></i><b>6.3.2</b> Updating the base parameter list</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="topics.html"><a href="topics.html#topic-tgrid"><i class="fa fa-check"></i><b>6.4</b> Time grid objects</a></li>
<li class="chapter" data-level="6.5" data-path="topics.html"><a href="topics.html#topic-designs"><i class="fa fa-check"></i><b>6.5</b> Individualized sampling designs</a></li>
<li class="chapter" data-level="6.6" data-path="topics.html"><a href="topics.html#some-helpful-c"><i class="fa fa-check"></i><b>6.6</b> Some helpful <code>C++</code></a></li>
<li class="chapter" data-level="6.7" data-path="topics.html"><a href="topics.html#resimulate-eta-and-eps"><i class="fa fa-check"></i><b>6.7</b> Resimulate <code>ETA</code> and <code>EPS</code></a></li>
<li class="chapter" data-level="6.8" data-path="topics.html"><a href="topics.html#topic-matrix-update"><i class="fa fa-check"></i><b>6.8</b> Updating <code>$OMEGA</code> and <code>$SIGMA</code>  </a><ul>
<li class="chapter" data-level="6.8.1" data-path="topics.html"><a href="topics.html#matrix-helper-functions"><i class="fa fa-check"></i><b>6.8.1</b> Matrix helper functions</a></li>
<li class="chapter" data-level="6.8.2" data-path="topics.html"><a href="topics.html#example-unnamed-matrix"><i class="fa fa-check"></i><b>6.8.2</b> Example: unnamed matrix</a></li>
<li class="chapter" data-level="6.8.3" data-path="topics.html"><a href="topics.html#example-named-matrices"><i class="fa fa-check"></i><b>6.8.3</b> Example: named matrices</a></li>
<li class="chapter" data-level="6.8.4" data-path="topics.html"><a href="topics.html#example-unnamed-matrices"><i class="fa fa-check"></i><b>6.8.4</b> Example: unnamed matrices</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="topics.html"><a href="topics.html#topics-time-varying"><i class="fa fa-check"></i><b>6.9</b> Time varying covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-sequence.html"><a href="section-sequence.html"><i class="fa fa-check"></i><b>7</b> Simulation sequence</a><ul>
<li class="chapter" data-level="7.1" data-path="section-sequence.html"><a href="section-sequence.html#functions-to-call"><i class="fa fa-check"></i><b>7.1</b> Functions to call</a></li>
<li class="chapter" data-level="7.2" data-path="section-sequence.html"><a href="section-sequence.html#problem-initiation"><i class="fa fa-check"></i><b>7.2</b> Problem initiation</a></li>
<li class="chapter" data-level="7.3" data-path="section-sequence.html"><a href="section-sequence.html#subject-initiation"><i class="fa fa-check"></i><b>7.3</b> Subject initiation</a></li>
<li class="chapter" data-level="7.4" data-path="section-sequence.html"><a href="section-sequence.html#sequence-for-a-single-record"><i class="fa fa-check"></i><b>7.4</b> Sequence for a single record</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>8</b> Installation</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><font color='DarkGreen'>mrgsolve User Guide</font></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="topics" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Topics</h1>
<div id="topic-annotated" class="section level2">
<h2><span class="header-section-number">6.1</span> Annotated model specification</h2>
<p>Here is a complete annotated <code>mrgsolve</code> model. The goal was to get in several of the most common blocks that you might want to annotate. The different code blocks are rendered here separately for clarity in presentation; but users should include all relevant blocks in a single file (or R string).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">$</span>PROB

<span class="co"># Final PK model</span>

<span class="op">-</span><span class="st"> </span>Author<span class="op">:</span><span class="st"> </span>Pmetrics Scientist
<span class="op">-</span><span class="st"> </span>Client<span class="op">:</span><span class="st"> </span>Pharmaco, Inc.
<span class="op">-</span><span class="st"> </span>Date<span class="op">:</span><span class="st"> `</span><span class="dt">r Sys.Date()</span><span class="st">`</span>
<span class="op">-</span><span class="st"> </span>NONMEM Run<span class="op">:</span><span class="st"> </span><span class="dv">12345</span>
<span class="op">-</span><span class="st"> </span>Structure<span class="op">:</span><span class="st"> </span>one compartment, first order absorption
<span class="op">-</span><span class="st"> </span>Implementation<span class="op">:</span><span class="st"> </span>closed form solutions
<span class="op">-</span><span class="st"> </span>Error model<span class="op">:</span><span class="st"> </span>Additive <span class="op">+</span><span class="st"> </span>proportional
<span class="op">-</span><span class="st"> </span>Covariates<span class="op">:</span>
<span class="st">  </span><span class="op">-</span><span class="st"> </span>WT on clearance
<span class="op">-</span><span class="st"> </span>SEX on volume
<span class="op">-</span><span class="st"> </span>Random effects on<span class="op">:</span><span class="st"> `</span><span class="dt">CL</span><span class="st">`</span>, <span class="st">`</span><span class="dt">V</span><span class="st">`</span>, <span class="st">`</span><span class="dt">KA</span><span class="st">`</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[PARAM] <span class="op">@</span>annotated
TVCL <span class="op">:</span><span class="st"> </span><span class="fl">1.1</span>   <span class="op">:</span><span class="st"> </span><span class="kw">Clearance</span> (L<span class="op">/</span>hr)
TVV  <span class="op">:</span><span class="st"> </span><span class="fl">35.6</span>  <span class="op">:</span><span class="st"> </span>Volume of <span class="kw">distribution</span> (L)
TVKA <span class="op">:</span><span class="st"> </span><span class="fl">1.35</span>  <span class="op">:</span><span class="st"> </span>Absorption rate <span class="kw">constant</span> (<span class="dv">1</span><span class="op">/</span>hr)
WT   <span class="op">:</span><span class="st"> </span><span class="dv">70</span>    <span class="op">:</span><span class="st"> </span><span class="kw">Weight</span> (kg)
SEX  <span class="op">:</span><span class="st"> </span><span class="dv">1</span>     <span class="op">:</span><span class="st"> </span>Male =<span class="st"> </span><span class="dv">0</span>, Female <span class="dv">1</span>
WTCL <span class="op">:</span><span class="st"> </span><span class="fl">0.75</span>  <span class="op">:</span><span class="st"> </span>Exponent weight on CL
SEXV <span class="op">:</span><span class="st"> </span><span class="fl">0.878</span> <span class="op">:</span><span class="st"> </span>Volume female<span class="op">/</span>Volume male</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[MAIN]
double CL =<span class="st"> </span>TVCL<span class="op">*</span><span class="kw">pow</span>(WT<span class="op">/</span><span class="dv">70</span>,WTCL)<span class="op">*</span><span class="kw">exp</span>(ECL);
double V  =<span class="st"> </span>TVV <span class="op">*</span><span class="kw">pow</span>(SEXVC,SEX)<span class="op">*</span><span class="kw">exp</span>(EV);
double KA =<span class="st"> </span>TVKA<span class="op">*</span><span class="kw">exp</span>(EKA);</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[OMEGA] <span class="op">@</span>name OMGA <span class="op">@</span>correlation <span class="op">@</span>block
ECL <span class="op">:</span><span class="st"> </span><span class="fl">1.23</span> <span class="op">:</span><span class="st"> </span>Random effect on CL
EV  <span class="op">:</span><span class="st"> </span><span class="fl">0.67</span> <span class="fl">0.4</span> <span class="op">:</span><span class="st"> </span>Random effect on V
EKA <span class="op">:</span><span class="st"> </span><span class="fl">0.25</span> <span class="fl">0.87</span> <span class="fl">0.2</span> <span class="op">:</span><span class="st"> </span>Random effect on KA</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[SIGMA] <span class="op">@</span>name SGMA 
PROP<span class="op">:</span><span class="st"> </span><span class="fl">0.25</span> <span class="op">:</span><span class="st"> </span>Proportional residual error
ADD <span class="op">:</span><span class="st"> </span><span class="dv">25</span>   <span class="op">:</span><span class="st"> </span>Additive residual error</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[CMT]
GUT  <span class="op">:</span><span class="st"> </span>Dosing <span class="kw">compartment</span>  (mg)
CENT <span class="op">:</span><span class="st"> </span>Central <span class="kw">compartment</span> (mg)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[PKMODEL] ncmt =<span class="st"> </span><span class="dv">1</span>, depot=<span class="ot">TRUE</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[TABLE]
capture IPRED =<span class="st"> </span>CENT<span class="op">/</span>V;
double DV =<span class="st"> </span>IPRED<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>PROP) <span class="op">+</span><span class="st"> </span>ADD;</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[CAPTURE]
DV  <span class="op">:</span><span class="st"> </span><span class="kw">Concentration</span> (mg<span class="op">/</span>L)
ECL <span class="op">:</span><span class="st"> </span>Random effect on CL
CL  <span class="op">:</span><span class="st"> </span>Individual <span class="kw">clearance</span> (L<span class="op">/</span>hr)</code></pre></div>
</div>
<div id="topic-init" class="section level2">
<h2><span class="header-section-number">6.2</span> Set initial conditions</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mrgsolve)
<span class="kw">library</span>(dplyr)</code></pre></div>
<div id="summary" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Summary</h3>
<ul>
<li><code>mrgsolve</code> keeps a base list of compartments and initial conditions that you can update <strong>either</strong> from <code>R</code> or from inside the model specification</li>
<li>When you use <code>$CMT</code>, the value in that base list is assumed to be 0 for every compartment</li>
<li><code>mrgsolve</code> will by default use the values in that base list when starting the problem</li>
<li>When only the base list is available, every individual will get the same initial condition</li>
<li>You can <strong>override</strong> this base list by including code in <code>$MAIN</code> to set the initial condition</li>
<li>Most often, you do this so that the initial is calculated as a function of a parameter</li>
<li>For example, <code>$MAIN RESP_0 = KIN/KOUT;</code> when <code>KIN</code> and <code>KOUT</code> have some value in <code>$PARAM</code></li>
<li>This code in <code>$MAIN</code> overwrites the value in the base list for the current <code>ID</code></li>
<li>For typical PK/PD type models, we most frequently initialize in <code>$MAIN</code></li>
<li>This is equivalent to what you might do in your NONMEM model</li>
<li>For larger systems models, we often just set the initial value via the base list</li>
</ul>
</div>
<div id="make-a-model-only-to-examine-init-behavior" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Make a model only to examine <code>init</code> behavior</h3>
<p>Note: <code>IFLAG</code> is my invention only for this demo. The demo is always responsible for setting and interpreting the value (it is not reserved in any way and <code>mrgsolve</code> does not control the value).</p>
<p>For this demo</p>
<ul>
<li>Compartment <code>A</code> initial condition defaults to 0</li>
<li>Compartment <code>A</code> initial condition will get set to <code>BASE</code> <strong>only</strong> if <code>IFLAG  &gt; 0</code></li>
<li>Compartment <code>A</code> always stays at the initial condition</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$PARAM BASE=100, IFLAG = 0</span>

<span class="st">$CMT A</span>

<span class="st">$MAIN</span>

<span class="st">if(IFLAG &gt; 0) A_0 = BASE;</span>

<span class="st">$ODE dxdt_A = 0;</span>
<span class="st">&#39;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;init&quot;</span>,code)</code></pre></div>
<p><strong>Check the initial condition</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">init</span>(mod)</code></pre></div>
<pre><code>. 
.  Model initial conditions (N=1):
.  name    value . name    value
.  A (1)   0     | . ...   .</code></pre>
<p>Note:</p>
<ul>
<li>We used <code>$CMT</code> in the model spec; that implies that the base initial condition for <code>A</code> is set to 0</li>
<li>In this chunk, the code in <code>$MAIN</code> doesn’t get run because <code>IFLAG</code> is 0</li>
<li>So, if we don’t update something in <code>$MAIN</code> the initial condition is as we set it in the base list</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>mrgsim <span class="op">%&gt;%</span><span class="st"> </span>plot</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-init-2-1.png" width="672" /></p>
<p><strong>Next, we update the base initial condition for <code>A</code> to 50</strong></p>
<p>Note:</p>
<ul>
<li>The code in <code>$MAIN</code> still doesn’t get run because <code>IFLAG</code> is 0</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">init</span>(<span class="dt">A =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span>mrgsim <span class="op">%&gt;%</span><span class="st"> </span>plot</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-init-3-1.png" width="672" /></p>
<p><strong>Now, turn on <code>IFLAG</code></strong></p>
<p>Note:</p>
<ul>
<li>Now, that code in <code>$MAIN</code> gets run</li>
<li><code>A_0</code> is set to the value of <code>BASE</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(<span class="dt">IFLAG=</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>mrgsim <span class="op">%&gt;%</span><span class="st"> </span>plot</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-init-4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(<span class="dt">IFLAG=</span><span class="dv">1</span>, <span class="dt">BASE=</span><span class="dv">300</span>) <span class="op">%&gt;%</span><span class="st"> </span>mrgsim <span class="op">%&gt;%</span><span class="st"> </span>plot</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-init-5-1.png" width="672" /></p>
</div>
<div id="example-pkpd-model-with-initial-condition" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Example PK/PD model with initial condition</h3>
<p>Just to be clear, there is no need to set any sort of flag to set the initial condition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$PARAM AUC=0, AUC50 = 75, KIN=200, KOUT=5</span>

<span class="st">$CMT RESP</span>

<span class="st">$MAIN </span>
<span class="st">RESP_0 = KIN/KOUT;</span>

<span class="st">$ODE</span>

<span class="st">dxdt_RESP = KIN*(1-AUC/(AUC50+AUC)) - KOUT*RESP;</span>

<span class="st">&#39;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;init2&quot;</span>, code)</code></pre></div>
<p>The initial condition is set to 40 per the values of <code>KIN</code> and <code>KOUT</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>mrgsim <span class="op">%&gt;%</span><span class="st"> </span>plot</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-init-7-1.png" width="672" /></p>
<p>Even when we change <code>RESP_0</code> in <code>R</code>, the calculation in <code>$MAIN</code> gets the final say</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">init</span>(<span class="dt">RESP=</span><span class="fl">1E9</span>) <span class="op">%&gt;%</span><span class="st"> </span>mrgsim</code></pre></div>
<pre><code>. Model:  init2 
. Dim:    25 x 3 
. Time:   0 to 24 
. ID:     1 
.      ID time RESP
. [1,]  1    0   40
. [2,]  1    1   40
. [3,]  1    2   40
. [4,]  1    3   40
. [5,]  1    4   40
. [6,]  1    5   40
. [7,]  1    6   40
. [8,]  1    7   40</code></pre>
</div>
<div id="remember-calling-init-will-let-you-check-to-see-what-is-going-on" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Remember: calling <code>init</code> will let you check to see what is going on</h3>
<ul>
<li>It’s a good idea to get in the habit of doing this when things aren’t clear</li>
<li><code>init</code> first takes the base initial condition list, then calls <code>$MAIN</code> and does any calculation you have in there; so the result is the calculated initials</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">init</span>(mod)</code></pre></div>
<pre><code>. 
.  Model initial conditions (N=1):
.  name       value . name    value
.  RESP (1)   0     | . ...   .</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(<span class="dt">KIN=</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>init</code></pre></div>
<pre><code>. 
.  Model initial conditions (N=1):
.  name       value . name    value
.  RESP (1)   0     | . ...   .</code></pre>
</div>
<div id="set-initial-conditions-via-idata" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Set initial conditions via <code>idata</code></h3>
<p>Go back to house model</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span>mrgsolve<span class="op">:::</span><span class="kw">house</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">init</span>(mod)</code></pre></div>
<pre><code>. 
.  Model initial conditions (N=3):
.  name       value . name       value
.  CENT (2)   0     | RESP (3)   50   
.  GUT (1)    0     | . ...      .</code></pre>
<p>Notes</p>
<ul>
<li>In <code>idata</code> (only), include a column with <code>CMT_0</code> (like you’d do in <code>$MAIN</code>).</li>
<li>When each ID is simulated, the <code>idata</code> value will override the base initial list for that subject.</li>
<li>But note that if <code>CMT_0</code> is set in <code>$MAIN</code>, that will override the <code>idata</code> update.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idata &lt;-<span class="st"> </span><span class="kw">expand.idata</span>(<span class="dt">CENT_0 =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">1</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idata <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>.   ID CENT_0
. 1  1      0
. 2  2      1
. 3  3      2
. 4  4      3
. 5  5      4
. 6  6      5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out &lt;-<span class="st"> </span>
<span class="st">  </span>mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">idata_set</span>(idata) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="dv">40</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(out, CENT<span class="op">~</span>.)</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-init-11-1.png" width="672" /></p>
</div>
</div>
<div id="topic-parameter-update" class="section level2">
<h2><span class="header-section-number">6.3</span> Updating parameters</h2>
<p>The parameter list was introduced in section <a href="model-components.html#component-param">2.1</a> and the <code>$PARAM</code> code block was shown in <a href="model-specification.html#block-param">3.2.2</a>. Once a model is compiled, the names and number of parameters in a model is fixed. However, the values of parameters can be changed: parameters may be updated either by the user (in <code>R</code>) or by <code>mrgsolve</code> (in the <code>C++</code> simulation engine, as the simulation proceeds).</p>
<ul>
<li>To update in <code>R</code>, use the <code>param()</code> function (see examples below)</li>
<li>To have <code>mrgsolve</code> update the parameters, attach columns to your data set (either <code>data_set</code> or <code>idata_set</code>) with the same name as items in the parameter list</li>
</ul>
<p>Both of these methods are discussed and illustrated in the following sections.</p>
<div id="parameter-update-hierarchy" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Parameter update hierarchy</h3>
<p>As we noted above, new parameter values can come from three potential sources:</p>
<ol style="list-style-type: decimal">
<li>Modification of the (base) parameter list</li>
<li>A column in an <code>idata_set</code> that has the same name as a model parameter</li>
<li>A column in a <code>data_set</code> that has the same name as a model parameter</li>
</ol>
<p>These sources for new parameter values are discussed below. We note here that the sources listed above are listed in the order of the parameter update <em>hierarchy</em>. So, the base parameter list provides the value by default. A parameter value coming from an <code>idata_set</code> will override the value in the base list. And a parameter value coming from a <code>data_set</code> will override the value coming from the base list or an <code>idata_set</code> (in case a parameter is listed in both the <code>idata_set</code> and the <code>data_set</code>). In other words, the hierarchy is:</p>
<ol style="list-style-type: decimal">
<li>base parameter list is the default</li>
<li>the <code>idata_set</code> overrides the base list</li>
<li>the <code>data_set</code> overrides the <code>idata_set</code> and the base list</li>
</ol>
<p>The parameter update hierarchy is discussed in the following sections.</p>
<p><strong>Base parameter set</strong></p>
<ul>
<li>Every model has a base set of “parameters”</li>
<li>These are named and set in <code>$PARAM</code></li>
<li>Parameters can only get into the parameter list in <code>$PARAM</code> (or <code>$THETA</code>)</li>
<li>No changing the names or numbers of parameters once the model is compiled</li>
<li>But, several ways to change the values</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$VCMT KYLE</span>
<span class="st">$PARAM CL = 1.1, VC=23.1, KA=1.7, KM=10</span>
<span class="st">$CAPTURE CL VC KA KM</span>
<span class="st">&#39;</span>
mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;tmp&quot;</span>, code, <span class="dt">warn=</span><span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">param</span>(mod)</code></pre></div>
<pre><code>. 
.  Model parameters (N=4):
.  name value . name value
.  CL   1.1   | KM   10   
.  KA   1.7   | VC   23.1</code></pre>
<p><strong>The base parameter set is the default</strong></p>
<p>The base parameter set allows you to run the model without entering any other data; there are some default values in place.</p>
<p><strong>The parameters in the base list can be changed or updated in <code>R</code></strong></p>
<p>Use the <code>param()</code> function to both set and get:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">param</span>(<span class="dt">CL=</span><span class="fl">2.1</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">param</span>(mod)</code></pre></div>
<pre><code>. 
.  Model parameters (N=4):
.  name value . name value
.  CL   2.1   | KM   10   
.  KA   1.7   | VC   23.1</code></pre>
<p>But whatever you’ve done in <code>R</code>, there is a base set (with values) to use. See section <a href="topics.html#topic-parameter-update-base">6.3.2</a> for a more detailed discussion of using <code>param()</code> to updated the base list.</p>
<p><strong>Parameters can also be updated during the simulation run</strong></p>
<p>Parameters can be updated by putting columns in <code>idata</code> set or <code>data_set</code> that have the same name as one of the parameters in the parameter list. But there is no changing values in the base parameter set once the simulation starts.<br />
That is, the following model specification will not compile:</p>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c">$PARAM CL = <span class="dv">2</span>

$MAIN CL = <span class="dv">3</span>; <span class="co">// ERROR</span></code></pre></div>
<p>You cannot over-write the value of a parameter in the model specification.<br />
Let <code>mrgsolve</code> do the updating.</p>
<p><code>mrgsolve</code> always reverts to the base parameter set when starting work on a new individual.</p>
<p><strong>Parameters updated from <code>idata_set</code></strong></p>
<p>When <code>mrgsolve</code> finds parameters in <code>idata</code>, it will update the base parameter list with those parameters prior to starting that individual.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(exidata)
<span class="kw">head</span>(exidata)</code></pre></div>
<pre><code>.   ID    CL    VC     KA KOUT  IC50 FOO
. 1  1 1.050 47.80 0.8390 2.45 1.280   4
. 2  2 0.730 30.10 0.0684 2.51 1.840   6
. 3  3 2.820 23.80 0.1180 3.88 2.480   5
. 4  4 0.552 26.30 0.4950 1.18 0.977   2
. 5  5 0.483  4.36 0.1220 2.35 0.483  10
. 6  6 3.620 39.80 0.1260 1.89 4.240   1</code></pre>
<p>Notice that there are several columns in <code>exidata</code> that match up with the names in the parameter list</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(exidata)</code></pre></div>
<pre><code>. [1] &quot;ID&quot;   &quot;CL&quot;   &quot;VC&quot;   &quot;KA&quot;   &quot;KOUT&quot; &quot;IC50&quot; &quot;FOO&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(<span class="kw">param</span>(mod))</code></pre></div>
<pre><code>. [1] &quot;CL&quot; &quot;VC&quot; &quot;KA&quot; &quot;KM&quot;</code></pre>
<p>The matching names tell <code>mrgsolve</code> to update, assigning each individual their individual parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out &lt;-<span class="st"> </span>
<span class="st">  </span>mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">idata_set</span>(exidata) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="op">-</span><span class="dv">1</span> , <span class="dt">add=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out</code></pre></div>
<pre><code>. Model:  tmp 
. Dim:    20 x 7 
. Time:   0 to 2 
. ID:     10 
.      ID time KYLE    CL   VC     KA KM
. [1,]  1    0    0 1.050 47.8 0.8390 10
. [2,]  1    2    0 1.050 47.8 0.8390 10
. [3,]  2    0    0 0.730 30.1 0.0684 10
. [4,]  2    2    0 0.730 30.1 0.0684 10
. [5,]  3    0    0 2.820 23.8 0.1180 10
. [6,]  3    2    0 2.820 23.8 0.1180 10
. [7,]  4    0    0 0.552 26.3 0.4950 10
. [8,]  4    2    0 0.552 26.3 0.4950 10</code></pre>
<p><strong>Parameters updated from <code>data_set</code></strong></p>
<p>Like an <code>idata</code> set, we can put parameters on a <code>data</code> set</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">expand.ev</span>(<span class="dt">amt=</span><span class="dv">0</span>, <span class="dt">CL=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">VC=</span><span class="dv">30</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out &lt;-<span class="st"> </span>
<span class="st">  </span>mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>obsonly <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">add=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out</code></pre></div>
<pre><code>. Model:  tmp 
. Dim:    6 x 7 
. Time:   0 to 2 
. ID:     3 
.      ID time KYLE CL VC  KA KM
. [1,]  1    0    0  1 30 1.7 10
. [2,]  1    2    0  1 30 1.7 10
. [3,]  2    0    0  2 30 1.7 10
. [4,]  2    2    0  2 30 1.7 10
. [5,]  3    0    0  3 30 1.7 10
. [6,]  3    2    0  3 30 1.7 10</code></pre>
<p>This is how we do time-varying parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data_frame</span>(<span class="dt">CL=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">evid=</span><span class="dv">0</span>,<span class="dt">ID=</span><span class="dv">1</span>,<span class="dt">cmt=</span><span class="dv">1</span>,<span class="dt">time=</span>CL<span class="op">-</span><span class="dv">1</span>,<span class="dt">amt=</span><span class="dv">0</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<pre><code>. Model:  tmp 
. Dim:    5 x 7 
. Time:   0 to 4 
. ID:     1 
.      ID time KYLE CL   VC  KA KM
. [1,]  1    0    0  1 23.1 1.7 10
. [2,]  1    1    0  2 23.1 1.7 10
. [3,]  1    2    0  3 23.1 1.7 10
. [4,]  1    3    0  4 23.1 1.7 10
. [5,]  1    4    0  5 23.1 1.7 10</code></pre>
<p>For more information on time-varying covariates (parameters), see sections <a href="topics.html#topics-time-varying">6.9</a> and <a href="section-sequence.html#section-sequence">7</a>.</p>
<p><strong>Parameters are carried back when first record isn’t at <code>time == 0</code></strong></p>
<p>What about this?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">expand.ev</span>(<span class="dt">amt=</span><span class="dv">100</span>,<span class="dt">time=</span><span class="dv">24</span>,<span class="dt">CL=</span><span class="dv">5</span>,<span class="dt">VC=</span><span class="dv">32</span>)
data</code></pre></div>
<pre><code>.   ID amt time CL VC evid cmt
. 1  1 100   24  5 32    1   1</code></pre>
<p>The first <code>data</code> record happens at <code>time==24</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">add=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))</code></pre></div>
<pre><code>. Model:  tmp 
. Dim:    3 x 7 
. Time:   0 to 24 
. ID:     1 
.      ID time KYLE CL VC  KA KM
. [1,]  1    0    0  5 32 1.7 10
. [2,]  1    2    0  5 32 1.7 10
. [3,]  1   24  100  5 32 1.7 10</code></pre>
<p>Since the data set doesn’t start until <code>time==5</code>, we might think that <code>CL</code> doesn’t change from the base parameter set until then.</p>
<p>But by default, <code>mrgsolve</code> carries those parameter values back to the start of the simulation. This is by design … by far the more useful configuration.</p>
<p>If you wanted the base parameter set in play until that first data set record, do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="op">-</span><span class="dv">1</span>,<span class="dt">add=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">filbak=</span><span class="ot">FALSE</span>)</code></pre></div>
<pre><code>. Model:  tmp 
. Dim:    3 x 7 
. Time:   0 to 24 
. ID:     1 
.      ID time KYLE  CL   VC  KA KM
. [1,]  1    0    0 2.1 23.1 1.7 10
. [2,]  1    2    0 2.1 23.1 1.7 10
. [3,]  1   24  100 5.0 32.0 1.7 10</code></pre>
<p>Will this work?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idata &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;expand.idata&quot;</span>, <span class="kw">as.list</span>(<span class="kw">param</span>(mod)))

idata</code></pre></div>
<pre><code>.   ID  CL   VC  KA KM
. 1  1 2.1 23.1 1.7 10</code></pre>
<p>Here, we’ll pass in <strong>both</strong> <code>data_set</code> and <code>idata_set</code> and they have conflicting values for the parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">idata_set</span>(idata) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="op">-</span><span class="dv">1</span>,<span class="dt">add=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))</code></pre></div>
<pre><code>. Model:  tmp 
. Dim:    3 x 7 
. Time:   0 to 24 
. ID:     1 
.      ID time KYLE CL VC  KA KM
. [1,]  1    0    0  5 32 1.7 10
. [2,]  1    2    0  5 32 1.7 10
. [3,]  1   24  100  5 32 1.7 10</code></pre>
<p>The data set always gets the last word.</p>
</div>
<div id="topic-parameter-update-base" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Updating the base parameter list</h3>
<p>From the previous section</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">param</span>(mod)</code></pre></div>
<pre><code>. 
.  Model parameters (N=4):
.  name value . name value
.  CL   2.1   | KM   10   
.  KA   1.7   | VC   23.1</code></pre>
<p><strong>Update with <code>name-value</code> pairs</strong></p>
<p>We can call <code>param()</code> to update the model object, directly naming the parameter to update and the new value to take</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(<span class="dt">CL =</span> <span class="dv">777</span>, <span class="dt">KM =</span> <span class="dv">999</span>) <span class="op">%&gt;%</span><span class="st"> </span>param</code></pre></div>
<pre><code>. 
.  Model parameters (N=4):
.  name value . name value
.  CL   777   | KM   999  
.  KA   1.7   | VC   23.1</code></pre>
<p>The parameter list can also be updated by scanning the names in a list</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">what &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">CL =</span> <span class="dv">555</span>, <span class="dt">VC =</span> <span class="dv">888</span>, <span class="dt">KYLE =</span> <span class="dv">123</span>, <span class="dt">MN =</span> <span class="dv">100</span>)

mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(what) <span class="op">%&gt;%</span><span class="st"> </span>param</code></pre></div>
<pre><code>. 
.  Model parameters (N=4):
.  name value . name value
.  CL   555   | KM   10   
.  KA   1.7   | VC   888</code></pre>
<p><code>mrgsolve</code> looks at the names to drive the update. <code>KYLE</code> (a compartment name) and <code>MN</code> (not in the model anywhere) are ignored.</p>
<p>Alternatively, we can pick a row from a data frame to provide the input for the update</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">CL=</span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">10</span>), <span class="dt">VC=</span><span class="kw">c</span>(<span class="dv">11</span>,<span class="dv">12</span>), <span class="dt">KTB=</span><span class="kw">c</span>(<span class="dv">13</span>,<span class="dv">14</span>))

mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(d[<span class="dv">2</span>,]) <span class="op">%&gt;%</span><span class="st"> </span>param</code></pre></div>
<pre><code>. 
.  Model parameters (N=4):
.  name value . name value
.  CL   10    | KM   10   
.  KA   1.7   | VC   12</code></pre>
<p>Here the second row in the data frame drives the update. Other names are ignored.</p>
<p>A warning will be issued if an update is attempted, but no matching names are found</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">param</span>(<span class="dt">ZIP =</span> <span class="dv">1</span>, <span class="dt">CODE =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>param</code></pre></div>
<pre><code>Warning message:
Found nothing to update: param </code></pre>
</div>
</div>
<div id="topic-tgrid" class="section level2">
<h2><span class="header-section-number">6.4</span> Time grid objects</h2>
<p><strong>Simulation times in <code>mrgsolve</code></strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span>mrgsolve<span class="op">:::</span><span class="kw">house</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">Req</span>(CP) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ev</span>(<span class="dt">amt=</span><span class="dv">1000</span>,<span class="dt">ii=</span><span class="dv">24</span>, <span class="dt">addl=</span><span class="dv">1000</span>) </code></pre></div>
<p><code>mrgsolve</code> keeps track of a simulation <code>start</code> and <code>end</code> time and a fixed size step between <code>start</code> and <code>end</code> (called <code>delta</code>). <code>mrgsolve</code> also keeps an arbitrary vector of simulation times called <code>add</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="dv">4</span>,<span class="dt">delta=</span><span class="dv">2</span>,<span class="dt">add=</span><span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">50</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.frame</code></pre></div>
<pre><code>.   ID time       CP
. 1  1    0  0.00000
. 2  1    0  0.00000
. 3  1    2 42.47580
. 4  1    4 42.28701
. 5  1    7 36.75460
. 6  1    9 33.26649
. 7  1   50 60.97754</code></pre>
<p><strong><code>tgrid</code> objects</strong></p>
<p>The <code>tgrid</code> object abstracts this setup and allows us to make complicated sampling designs from elementary building blocks.</p>
<p><strong>Make a day 1 sampling with intensive sampling around the peak and sparser otherwise</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">peak1 &lt;-<span class="st"> </span><span class="kw">tgrid</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="fl">0.1</span>)
sparse1 &lt;-<span class="st"> </span><span class="kw">tgrid</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">4</span>)</code></pre></div>
<p><strong>Use the <code>c</code> operator to combine simpler designs into more complicated designs</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">day1 &lt;-<span class="st"> </span><span class="kw">c</span>(peak1,sparse1)</code></pre></div>
<p>Check this by calling <code>stime</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stime</span>(day1)</code></pre></div>
<pre><code>.  [1]  0.0  1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  2.0  2.1  2.2
. [15]  2.3  2.4  2.5  2.6  2.7  2.8  2.9  3.0  3.1  3.2  3.3  3.4  3.5  3.6
. [29]  3.7  3.8  3.9  4.0  8.0 12.0 16.0 20.0 24.0</code></pre>
<p>Pass this object in to <code>mrgsim</code> as <code>tgrid</code>. It will override the default <code>start/end/delta/add</code> sequence.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">tgrid=</span>day1) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot</span>(<span class="dt">type=</span><span class="st">&#39;b&#39;</span>)</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-tgrid-1-1.png" width="672" /></p>
<p><strong>Now, look at both day 1 and day 10</strong>:</p>
<p>Adding a number to a <code>tgrid</code> object will offset those times by that amount.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des &lt;-<span class="st"> </span><span class="kw">c</span>(day1, day1<span class="op">+</span><span class="dv">10</span><span class="op">*</span><span class="dv">24</span>)

mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">tgrid=</span>des) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot</span>(<span class="dt">type=</span><span class="st">&#39;b&#39;</span>)</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-tgrid-2-1.png" width="672" /></p>
<p>Pick up day 5 as well</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des &lt;-<span class="st"> </span><span class="kw">c</span>(des, day1<span class="op">+</span><span class="dv">5</span><span class="op">*</span><span class="dv">24</span>)

mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">tgrid=</span>des) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot</span>(<span class="dt">type=</span><span class="st">&#39;b&#39;</span>)</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-tgrid-3-1.png" width="672" /></p>
</div>
<div id="topic-designs" class="section level2">
<h2><span class="header-section-number">6.5</span> Individualized sampling designs</h2>
<p>Here is a PopPK model and a full <code>data_set</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span>mrgsolve<span class="op">:::</span><span class="kw">house</span>()

<span class="kw">data</span>(exTheoph)

df &lt;-<span class="st"> </span>exTheoph

<span class="kw">head</span>(df)</code></pre></div>
<pre><code>.   ID   WT Dose time  conc cmt  amt evid
. 1  1 79.6 4.02 0.00  0.00   1 4.02    1
. 2  1 79.6 4.02 0.25  2.84   0 0.00    0
. 3  1 79.6 4.02 0.57  6.57   0 0.00    0
. 4  1 79.6 4.02 1.12 10.50   0 0.00    0
. 5  1 79.6 4.02 2.02  9.66   0 0.00    0
. 6  1 79.6 4.02 3.82  8.58   0 0.00    0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">Req</span>(CP) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">carry.out</span>(a.u.g) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(df) <span class="op">%&gt;%</span>
<span class="st">  </span>obsaug <span class="op">%&gt;%</span>
<span class="st">  </span>mrgsim </code></pre></div>
<pre><code>. Model:  housemodel 
. Dim:    5904 x 4 
. Time:   0 to 120 
. ID:     12 
.      ID time a.u.g      CP
. [1,]  1 0.00     1 0.00000
. [2,]  1 0.00     0 0.00000
. [3,]  1 0.25     1 0.04552
. [4,]  1 0.25     0 0.04552
. [5,]  1 0.50     1 0.07870
. [6,]  1 0.57     0 0.08624
. [7,]  1 0.75     1 0.10274
. [8,]  1 1.00     1 0.12001</code></pre>
<p>Now, define two time grid objects: <code>des1</code> runs from 0 to 24 and <code>des2</code> runs from 0 to 96, both every hour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des1 &lt;-<span class="st"> </span><span class="kw">tgrid</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">1</span>)
des2 &lt;-<span class="st"> </span><span class="kw">tgrid</span>(<span class="dv">0</span>,<span class="dv">96</span>,<span class="dv">1</span>)

<span class="kw">range</span>(<span class="kw">stime</span>(des1))</code></pre></div>
<pre><code>. [1]  0 24</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(<span class="kw">stime</span>(des2))</code></pre></div>
<pre><code>. [1]  0 96</code></pre>
<p>Now, derive an <code>idata_set</code> after adding a grouping column (<code>GRP</code>) that splits the data set into two groups</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">GRP =</span> <span class="kw">as.integer</span>(ID <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>))

id &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(ID,GRP) 

id</code></pre></div>
<pre><code>.    ID GRP
. 1   1   0
. 2   2   0
. 3   3   0
. 4   4   0
. 5   5   0
. 6   6   1
. 7   7   1
. 8   8   1
. 9   9   1
. 10 10   1
. 11 11   1
. 12 12   1</code></pre>
<p>Now, we have two groups in <code>GRP</code> in <code>idata_set</code> and we have two <code>tgrid</code> objects.</p>
<ul>
<li>Pass in both the <code>idata_set</code> and the <code>data_set</code></li>
<li>Call <code>design</code></li>
<li>Identify <code>GRP</code> as <code>descol</code>; the column <strong>must</strong> be in <code>idata_set</code></li>
<li>Pass in a list of designs; it <strong>must</strong> be at least two because there are two levels in <code>GRP</code></li>
</ul>
<p>When we simulate, the individuals in <code>GRP 1</code> will get <code>des1</code> and those in <code>GRP 2</code> will get <code>des2</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out &lt;-<span class="st"> </span>
<span class="st">  </span>mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">Req</span>(CP) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">carry.out</span>(a.u.g,GRP) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">idata_set</span>(id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(df) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">design</span>(<span class="dt">descol=</span><span class="st">&quot;GRP&quot;</span>, <span class="dt">deslist=</span><span class="kw">list</span>(des1,des2)) <span class="op">%&gt;%</span>
<span class="st">  </span>obsaug <span class="op">%&gt;%</span>
<span class="st">  </span>mrgsim 

<span class="kw">plot</span>(out, CP<span class="op">~</span>time<span class="op">|</span>GRP)</code></pre></div>
<p><img src="user-guide_files/figure-html/topic-design-1-1.png" width="672" /></p>
</div>
<div id="some-helpful-c" class="section level2">
<h2><span class="header-section-number">6.6</span> Some helpful <code>C++</code></h2>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c">
<span class="co">// If</span>
<span class="cf">if</span>(a == <span class="dv">2</span>) b = <span class="dv">2</span>;

<span class="co">// If else</span>
<span class="cf">if</span>(b &lt;= <span class="dv">2</span>) {
c=<span class="dv">3</span>;
} <span class="cf">else</span> {
c=<span class="dv">4</span>;
}

<span class="co">// x &lt;- ifelse(c == 4, 8, 10)</span>
<span class="dt">double</span> x = c == <span class="dv">4</span> ? <span class="dv">8</span> : <span class="dv">10</span>;

<span class="dt">double</span> d = pow(base,exponent);
<span class="dt">double</span> e = exp(<span class="dv">3</span>);
<span class="dt">double</span> f = fabs(-<span class="dv">4</span>);
<span class="dt">double</span> g = sqrt(<span class="dv">5</span>);
<span class="dt">double</span> h = log(<span class="dv">6</span>);
<span class="dt">double</span> i = log10(<span class="dv">7</span>);
<span class="dt">double</span> j = floor(<span class="fl">4.2</span>);
<span class="dt">double</span> k = ceil(<span class="fl">4.2</span>);</code></pre></div>
</div>
<div id="resimulate-eta-and-eps" class="section level2">
<h2><span class="header-section-number">6.7</span> Resimulate <code>ETA</code> and <code>EPS</code></h2>
<p><strong>Call <code>simeps()</code> to resimulate <code>ETA</code></strong></p>
<ul>
<li>No <code>$PLUGIN</code> is required</li>
<li><code>simeta()</code> takes no arguments</li>
</ul>
<p>For example, we can simulate individual-level covariates within a certain range:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$PARAM TVCL = 1, TVWT = 70</span>

<span class="st">$MAIN </span>
<span class="st">capture WT = TVWT*exp(EWT);</span>

<span class="st">int i = 0;</span>

<span class="st">while((WT &lt; 60) || (WT &gt; 80)) {</span>
<span class="st">  if(++i &gt; 100) break;</span>
<span class="st">  simeta();</span>
<span class="st">  WT = TVWT*exp(EWT);</span>
<span class="st">}</span>

<span class="st">$OMEGA @labels EWT</span>
<span class="st">4</span>

<span class="st">$CAPTURE EWT WT</span>
<span class="st">&#39;</span>

mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;simeta&quot;</span>, code)

out &lt;-<span class="st"> </span>mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mrgsim</span>(<span class="dt">nid=</span><span class="dv">100</span>, <span class="dt">end=</span><span class="op">-</span><span class="dv">1</span>)

sum &lt;-<span class="st"> </span><span class="kw">summary</span>(out)

sum</code></pre></div>
<pre><code>.        ID              time        EWT                  WT       
.  Min.   :  1.00   Min.   :0   Min.   :-0.147157   Min.   :60.42  
.  1st Qu.: 25.75   1st Qu.:0   1st Qu.:-0.067350   1st Qu.:65.44  
.  Median : 50.50   Median :0   Median : 0.002623   Median :70.18  
.  Mean   : 50.50   Mean   :0   Mean   :-0.006769   Mean   :69.73  
.  3rd Qu.: 75.25   3rd Qu.:0   3rd Qu.: 0.053306   3rd Qu.:73.83  
.  Max.   :100.00   Max.   :0   Max.   : 0.126415   Max.   :79.43</code></pre>
<p><strong>Call <code>simeps()</code> to resimulate <code>EPS</code></strong></p>
<ul>
<li>No <code>$PLUGIN</code> is required</li>
<li><code>simeps()</code> takes no arguments</li>
</ul>
<p>For example, we can resimulate untill all concentrations are greater than zero:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$PARAM CL = 1, V = 20,</span>

<span class="st">$CMT CENT</span>

<span class="st">$SIGMA 50</span>

<span class="st">$PKMODEL ncmt=1</span>

<span class="st">$TABLE</span>
<span class="st">capture CP = CENT/V + EPS(1);</span>

<span class="st">int i = 0;</span>

<span class="st">while(CP &lt; 0 &amp;&amp; i &lt; 100) {</span>
<span class="st">  simeps();</span>
<span class="st">  CP = CENT/V + EPS(1);</span>
<span class="st">  ++i;</span>
<span class="st">}</span>

<span class="st">&#39;</span>

mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;simeps&quot;</span>, code)

out &lt;-<span class="st"> </span>mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ev</span>(<span class="dt">amt=</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="dv">48</span>)
sum &lt;-<span class="st"> </span><span class="kw">summary</span>(out)

sum</code></pre></div>
<pre><code>.        ID         time            CENT              CP         
.  Min.   :1   Min.   : 0.00   Min.   :  0.00   Min.   : 0.4829  
.  1st Qu.:1   1st Qu.:11.25   1st Qu.: 15.93   1st Qu.: 3.4087  
.  Median :1   Median :23.50   Median : 29.38   Median : 6.4026  
.  Mean   :1   Mean   :23.52   Mean   : 37.47   Mean   : 6.9016  
.  3rd Qu.:1   3rd Qu.:35.75   3rd Qu.: 54.21   3rd Qu.: 9.1498  
.  Max.   :1   Max.   :48.00   Max.   :100.00   Max.   :19.5884</code></pre>
<p><strong>A safety check is recommended</strong> Note that in both examples, we implement a safety check: an integer counter is incremented every time we resimulated. The resimulation process stops if we don’t reach the desired condition within 100 replicates. You might also consider issuing a message or a flag in the simulated data if you are not able to reach the desired condition.</p>
</div>
<div id="topic-matrix-update" class="section level2">
<h2><span class="header-section-number">6.8</span> Updating <code>$OMEGA</code> and <code>$SIGMA</code>  </h2>
<p>Like the values of parameters in the parameter list, we may want to update the values in <code>$OMEGA</code> and <code>$SIGMA</code> matrices. We can do so without re-compiling the model.</p>
<div id="matrix-helper-functions" class="section level3">
<h3><span class="header-section-number">6.8.1</span> Matrix helper functions</h3>
<p><code>mrgsolve</code> keeps <code>$OMEGA</code> and <code>$SIGMA</code> in block matrices (regardless of whether the off-diagonal elements are zeros or not). Recall that in the model specification file we can enter data for <code>$OMEGA</code> and <code>$SIGMA</code> as the lower triangle of the matrix (see section <a href="model-specification.html#block-omega">3.2.10</a>). In <code>R</code>, we need to provide a matrix (as an <code>R</code> object). <code>mrgsolve</code> provides some convenience functions to help … allowing the user to enter lower diagonals instead of the full matrix.</p>
<p><code>dmat()</code> for diagonal matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dmat</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</code></pre></div>
<pre><code>.      [,1] [,2] [,3]
. [1,]    1    0    0
. [2,]    0    2    0
. [3,]    0    0    3</code></pre>
<p><code>bmat()</code> for block matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dmat</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</code></pre></div>
<pre><code>.      [,1] [,2] [,3]
. [1,]    1    0    0
. [2,]    0    2    0
. [3,]    0    0    3</code></pre>
<p><code>cmat()</code> for a block matrix where the diagonal elements are variances and the off-diagonals are taken to be correlations, not covariances</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cmat</span>(<span class="fl">0.1</span>, <span class="fl">0.87</span>,<span class="fl">0.3</span>)</code></pre></div>
<pre><code>.           [,1]      [,2]
. [1,] 0.1000000 0.1506884
. [2,] 0.1506884 0.3000000</code></pre>
<p><code>mrgsolve</code> will convert the correlations to covariances.</p>
<p><code>mrgsolve</code> also provides <code>as_bmat()</code> and <code>as_dmat()</code> for converting other <code>R</code> objects to matrices or lists of matrices.</p>
<p>Consider this list with named elements holding the data for a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">OMEGA1.1 =</span> <span class="fl">0.9</span>, <span class="dt">OMEGA2.1 =</span> <span class="fl">0.3</span>, <span class="dt">OMEGA2.2 =</span> <span class="fl">0.4</span>)</code></pre></div>
<p>These data could form either a 3x3 diagonal matrix or a 2x2 block matrix. But the names suggest a 2x2 form. <code>as_bmat()</code> can make the matrix like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_bmat</span>(m, <span class="st">&quot;OMEGA&quot;</span>)</code></pre></div>
<pre><code>.      [,1] [,2]
. [1,]  0.9  0.3
. [2,]  0.3  0.4</code></pre>
<p>The second argument is a regular expression that <code>mrgsolve</code> uses to find elements in the list to use for building the matrix.</p>
<p>Frequently, we have estimates in a data frame like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(exBoot)
<span class="kw">head</span>(exBoot)</code></pre></div>
<pre><code>.   run  THETA1 THETA2  THETA3 OMEGA11   OMEGA21 OMEGA22 OMEGA31  OMEGA32
. 1   1 -0.7634  2.280  0.8472 0.12860  0.046130  0.2874 0.13820 -0.02164
. 2   2 -0.4816  2.076  0.5355 0.12000  0.051000  0.2409 0.06754 -0.07759
. 3   3 -0.5865  2.334 -0.4597 0.11460  0.097150  0.2130 0.16650  0.18100
. 4   4 -0.6881  1.824  0.7736 0.14990  0.000003  0.2738 0.24700 -0.05466
. 5   5  0.2909  1.519 -1.2440 0.07308  0.003842  0.2989 0.06475  0.05078
. 6   6  0.1135  2.144 -1.0040 0.13390 -0.019270  0.1640 0.10740 -0.01170
.   OMEGA33  SIGMA11 SIGMA21 SIGMA22
. 1  0.3933 0.002579       0  1.0300
. 2  0.3342 0.002228       0  1.0050
. 3  0.4699 0.002418       0  1.0890
. 4  0.5536 0.002177       0  0.8684
. 5  0.2500 0.001606       0  0.8996
. 6  0.3412 0.002134       0  0.9744</code></pre>
<p>We can use <code>as_bmat()</code> with this data frame to extract the <code>$OMEGA</code> matrices</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">omegas &lt;-<span class="st"> </span><span class="kw">as_bmat</span>(exBoot, <span class="st">&quot;OMEGA&quot;</span>)
<span class="kw">length</span>(omegas)</code></pre></div>
<pre><code>. [1] 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(exBoot)</code></pre></div>
<pre><code>. [1] 100  13</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">omegas[[<span class="dv">6</span>]]</code></pre></div>
<pre><code>.          [,1]     [,2]    [,3]
. [1,]  0.13390 -0.01927  0.1074
. [2,] -0.01927  0.16400 -0.0117
. [3,]  0.10740 -0.01170  0.3412</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">omegas[[<span class="dv">16</span>]]</code></pre></div>
<pre><code>.         [,1]    [,2]   [,3]
. [1,] 0.08126 0.01252 0.1050
. [2,] 0.01252 0.16860 0.0149
. [3,] 0.10500 0.01490 0.4062</code></pre>
<p>The result of calling <code>as_bmat</code> or <code>as_dmat</code> is a list of matrices, one for each row in the data frame.</p>
<p>Note in this example, we could have called</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sigmas &lt;-<span class="st"> </span><span class="kw">as_bmat</span>(exBoot,<span class="st">&quot;SIGMA&quot;</span>) </code></pre></div>
<p>to grab the <code>$SIGMA</code> matrices.</p>
<p>For help on these helper functions, see <code>?dmat</code>, <code>?bmat</code>, <code>?cmat</code>, <code>?as_bmat</code>, <code>?as_dmat</code> in the <code>R</code> help system after loading <code>mrgsolve</code>.</p>
</div>
<div id="example-unnamed-matrix" class="section level3">
<h3><span class="header-section-number">6.8.2</span> Example: unnamed matrix</h3>
<p>Here is a model with only a 3x3 <code>$OMEGA</code> matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$OMEGA</span>
<span class="st">1 2 3</span>
<span class="st">&#39;</span>

mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;matrix&quot;</span>, code, <span class="dt">compile=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>Let’s check the values in the matrix using <code>omat()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>omat</code></pre></div>
<pre><code>. $...
.     [,1] [,2] [,3]
. 1:     1    0    0
. 2:     0    2    0
. 3:     0    0    3</code></pre>
<p>We also use <code>omat()</code> to update the values in the matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">omat</span>(<span class="kw">dmat</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)) <span class="op">%&gt;%</span><span class="st"> </span>omat</code></pre></div>
<pre><code>. $...
.     [,1] [,2] [,3]
. 1:     4    0    0
. 2:     0    5    0
. 3:     0    0    6</code></pre>
<p>To update <code>$OMEGA</code>, we must provide a matrix of the same dimension, in this case 3x3. An error is generated if we provide a matrix with the wrong dimension.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans &lt;-<span class="st"> </span><span class="kw">try</span>(mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">omat</span>(<span class="kw">dmat</span>(<span class="dv">11</span>,<span class="dv">23</span>)))

ans</code></pre></div>
<pre><code>. [1] &quot;Error : improper signature: omat\n&quot;
. attr(,&quot;class&quot;)
. [1] &quot;try-error&quot;
. attr(,&quot;condition&quot;)
. &lt;simpleError: improper signature: omat&gt;</code></pre>
</div>
<div id="example-named-matrices" class="section level3">
<h3><span class="header-section-number">6.8.3</span> Example: named matrices</h3>
<p>When there are multiple <code>$OMEGA</code> matrices, it can be helpful to assign them names. Here, there are two matrices: one for interindividual variability (<code>IIV</code>) and one for interoccasion variability (<code>IOV</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$OMEGA @name IIV</span>
<span class="st">1 2 3</span>
<span class="st">$OMEGA @name IOV</span>
<span class="st">4 5</span>
<span class="st">&#39;</span>
mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;iov&quot;</span>, code, <span class="dt">compile=</span><span class="ot">FALSE</span>)

<span class="kw">revar</span>(mod)</code></pre></div>
<pre><code>. $omega
. $IIV
.     [,1] [,2] [,3]
. 1:     1    0    0
. 2:     0    2    0
. 3:     0    0    3
. 
. $IOV
.     [,1] [,2]
. 4:     4    0
. 5:     0    5
. 
. 
. $sigma
. No matrices found</code></pre>
<p>Now, we can update either <code>IIV</code> or <code>IOV</code> (or both) by name</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">omat</span>(<span class="dt">IOV =</span> <span class="kw">dmat</span>(<span class="dv">11</span>,<span class="dv">12</span>), <span class="dt">IIV =</span> <span class="kw">dmat</span>(<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>omat</code></pre></div>
<pre><code>. $IIV
.     [,1] [,2] [,3]
. 1:    13    0    0
. 2:     0   14    0
. 3:     0    0   15
. 
. $IOV
.     [,1] [,2]
. 4:    11    0
. 5:     0   12</code></pre>
<p>Again, an error is generated if we try to assign a 3x3 matrix to the <code>IOV</code> position</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans &lt;-<span class="st"> </span><span class="kw">try</span>(mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">omat</span>(<span class="dt">IIV=</span><span class="kw">dmat</span>(<span class="dv">1</span>,<span class="dv">2</span>)))
ans</code></pre></div>
<pre><code>. [1] &quot;Error : improper dimension: omat\n&quot;
. attr(,&quot;class&quot;)
. [1] &quot;try-error&quot;
. attr(,&quot;condition&quot;)
. &lt;simpleError: improper dimension: omat&gt;</code></pre>
</div>
<div id="example-unnamed-matrices" class="section level3">
<h3><span class="header-section-number">6.8.4</span> Example: unnamed matrices</h3>
<p>If we do write the model with unnamed matrices, we can still update them</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$OMEGA</span>
<span class="st">1 2 3</span>

<span class="st">$OMEGA </span>
<span class="st">4 5</span>
<span class="st">&#39;</span>
mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;multi&quot;</span>, code, <span class="dt">compile=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>In this case, the only way to update is to pass in a <strong>list</strong> of matrices, where (in this example) the first matrix is 3x3 and the second is 2x2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">omat</span>(<span class="kw">list</span>(<span class="kw">dmat</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>),<span class="kw">dmat</span>(<span class="dv">8</span>,<span class="dv">9</span>))) <span class="op">%&gt;%</span><span class="st"> </span>omat</code></pre></div>
<pre><code>. $...
.     [,1] [,2] [,3]
. 1:     5    0    0
. 2:     0    6    0
. 3:     0    0    7
. 
. $...
.     [,1] [,2]
. 4:     8    0
. 5:     0    9</code></pre>
</div>
</div>
<div id="topics-time-varying" class="section level2">
<h2><span class="header-section-number">6.9</span> Time varying covariates</h2>
<p>A note in a previous section showed how to implement time-varying covariates or other time-varying parameters by including those parameters as column in the data set.</p>
<p>By default, <code>mrgsolve</code> performs next observation carried backward (<code>nocb</code>) when processing time-varying covariates. That is, when the system advances from <code>TIME1</code> to <code>TIME2</code>, and the advance is a function of a covariate found in the data set, the system advances using the covariate value <code>COV2</code> rather than the covariate <code>COV1</code>.</p>
<p>The user can change the behavior to last observation carried forward (<code>locf</code>), so that the system uses the value of <code>COV1</code> to advance from <code>TIME1</code> to <code>TIME2</code>. To use <code>locf</code> advance, set <code>nocb</code> to <code>FALSE</code> when calling <code>mrgsim</code>. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mrgsim</span>(<span class="dt">nocb =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Note that time-varying covariates are not possible when using <code>qsim</code> simulation.</p>
<p>There is additional information about the sequence of events that takes place during system advance in section <a href="section-sequence.html#section-sequence">7</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simulated-output.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-sequence.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["user-guide.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
