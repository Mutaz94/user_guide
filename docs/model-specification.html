<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Model specification | mrgsolve User Guide</title>
  <meta name="description" content="A guide to using mrgsolve." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Model specification | mrgsolve User Guide" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://mrgsolve.github.io/user_guide/" />
  
  <meta property="og:description" content="A guide to using mrgsolve." />
  <meta name="github-repo" content="mrgsolve/user_guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Model specification | mrgsolve User Guide" />
  <meta name="twitter:site" content="@mrgsolve" />
  <meta name="twitter:description" content="A guide to using mrgsolve." />
  

<meta name="author" content="Metrum Research Group" />


<meta name="date" content="2019-12-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-components.html"/>
<link rel="next" href="data-set-chapter.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="bookstyle.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">User Guide: mrgsolve</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="model-components.html"><a href="model-components.html"><i class="fa fa-check"></i><b>1</b> Model components</a><ul>
<li class="chapter" data-level="1.1" data-path="model-components.html"><a href="model-components.html#component-param"><i class="fa fa-check"></i><b>1.1</b> Parameter list</a><ul>
<li class="chapter" data-level="1.1.1" data-path="model-components.html"><a href="model-components.html#central-role-of-parameters-in-planning-simulations"><i class="fa fa-check"></i><b>1.1.1</b> Central role of parameters in planning simulations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="model-components.html"><a href="model-components.html#component-init"><i class="fa fa-check"></i><b>1.2</b> Compartment list</a></li>
<li class="chapter" data-level="1.3" data-path="model-components.html"><a href="model-components.html#component-stime"><i class="fa fa-check"></i><b>1.3</b> Simulation time grid</a><ul>
<li class="chapter" data-level="1.3.1" data-path="model-components.html"><a href="model-components.html#component-tgrid"><i class="fa fa-check"></i><b>1.3.1</b> <code>tgrid</code> objects</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="model-components.html"><a href="model-components.html#solver-settings"><i class="fa fa-check"></i><b>1.4</b> Solver settings</a><ul>
<li class="chapter" data-level="1.4.1" data-path="model-components.html"><a href="model-components.html#atol"><i class="fa fa-check"></i><b>1.4.1</b> <code>atol</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="model-components.html"><a href="model-components.html#rtol"><i class="fa fa-check"></i><b>1.4.2</b> <code>rtol</code></a></li>
<li class="chapter" data-level="1.4.3" data-path="model-components.html"><a href="model-components.html#maxsteps"><i class="fa fa-check"></i><b>1.4.3</b> <code>maxsteps</code></a></li>
<li class="chapter" data-level="1.4.4" data-path="model-components.html"><a href="model-components.html#hmax"><i class="fa fa-check"></i><b>1.4.4</b> <code>hmax</code></a></li>
<li class="chapter" data-level="1.4.5" data-path="model-components.html"><a href="model-components.html#hmin"><i class="fa fa-check"></i><b>1.4.5</b> <code>hmin</code></a></li>
<li class="chapter" data-level="1.4.6" data-path="model-components.html"><a href="model-components.html#ixpr"><i class="fa fa-check"></i><b>1.4.6</b> <code>ixpr</code></a></li>
<li class="chapter" data-level="1.4.7" data-path="model-components.html"><a href="model-components.html#mxhnil"><i class="fa fa-check"></i><b>1.4.7</b> <code>mxhnil</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="model-components.html"><a href="model-components.html#functions"><i class="fa fa-check"></i><b>1.5</b> Functions</a><ul>
<li class="chapter" data-level="1.5.1" data-path="model-components.html"><a href="model-components.html#the-preamble-function"><i class="fa fa-check"></i><b>1.5.1</b> The <code>$PREAMBLE</code> function</a></li>
<li class="chapter" data-level="1.5.2" data-path="model-components.html"><a href="model-components.html#the-main-function"><i class="fa fa-check"></i><b>1.5.2</b> The <code>$MAIN</code> function</a></li>
<li class="chapter" data-level="1.5.3" data-path="model-components.html"><a href="model-components.html#the-ode-function"><i class="fa fa-check"></i><b>1.5.3</b> The <code>$ODE</code> function</a></li>
<li class="chapter" data-level="1.5.4" data-path="model-components.html"><a href="model-components.html#the-table-function"><i class="fa fa-check"></i><b>1.5.4</b> The <code>$TABLE</code> function</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="model-components.html"><a href="model-components.html#random-effect-variances"><i class="fa fa-check"></i><b>1.6</b> Random effect variances</a><ul>
<li class="chapter" data-level="1.6.1" data-path="model-components.html"><a href="model-components.html#omega"><i class="fa fa-check"></i><b>1.6.1</b> <code>OMEGA</code></a></li>
<li class="chapter" data-level="1.6.2" data-path="model-components.html"><a href="model-components.html#sigma"><i class="fa fa-check"></i><b>1.6.2</b> <code>SIGMA</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="model-specification.html"><a href="model-specification.html"><i class="fa fa-check"></i><b>2</b> Model specification</a><ul>
<li class="chapter" data-level="2.1" data-path="model-specification.html"><a href="model-specification.html#how-where-to-write-a-model"><i class="fa fa-check"></i><b>2.1</b> How / where to write a model</a><ul>
<li class="chapter" data-level="2.1.1" data-path="model-specification.html"><a href="model-specification.html#spec-separate-file"><i class="fa fa-check"></i><b>2.1.1</b> Separate file</a></li>
<li class="chapter" data-level="2.1.2" data-path="model-specification.html"><a href="model-specification.html#spec-inline"><i class="fa fa-check"></i><b>2.1.2</b> Inline / <code>code</code>  </a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="model-specification.html"><a href="model-specification.html#code-blocks"><i class="fa fa-check"></i><b>2.2</b> Code blocks</a><ul>
<li class="chapter" data-level="2.2.1" data-path="model-specification.html"><a href="model-specification.html#about-code-blocks"><i class="fa fa-check"></i><b>2.2.1</b> About code blocks</a></li>
<li class="chapter" data-level="2.2.2" data-path="model-specification.html"><a href="model-specification.html#block-prob"><i class="fa fa-check"></i><b>2.2.2</b> <code>$PROB</code>  </a></li>
<li class="chapter" data-level="2.2.3" data-path="model-specification.html"><a href="model-specification.html#block-param"><i class="fa fa-check"></i><b>2.2.3</b> <code>$PARAM</code>  </a></li>
<li class="chapter" data-level="2.2.4" data-path="model-specification.html"><a href="model-specification.html#block-fixed"><i class="fa fa-check"></i><b>2.2.4</b> <code>$FIXED</code>  </a></li>
<li class="chapter" data-level="2.2.5" data-path="model-specification.html"><a href="model-specification.html#cmt-and-init"><i class="fa fa-check"></i><b>2.2.5</b> <code>$CMT</code> and <code>$INIT</code></a></li>
<li class="chapter" data-level="2.2.6" data-path="model-specification.html"><a href="model-specification.html#block-main"><i class="fa fa-check"></i><b>2.2.6</b> <code>$MAIN</code>  </a></li>
<li class="chapter" data-level="2.2.7" data-path="model-specification.html"><a href="model-specification.html#block-ode"><i class="fa fa-check"></i><b>2.2.7</b> <code>$ODE</code>  </a></li>
<li class="chapter" data-level="2.2.8" data-path="model-specification.html"><a href="model-specification.html#block-table"><i class="fa fa-check"></i><b>2.2.8</b> <code>$TABLE</code>  </a></li>
<li class="chapter" data-level="2.2.9" data-path="model-specification.html"><a href="model-specification.html#block-preamble"><i class="fa fa-check"></i><b>2.2.9</b> <code>$PREAMBLE</code>  </a></li>
<li class="chapter" data-level="2.2.10" data-path="model-specification.html"><a href="model-specification.html#block-pred"><i class="fa fa-check"></i><b>2.2.10</b> <code>$PRED</code>  </a></li>
<li class="chapter" data-level="2.2.11" data-path="model-specification.html"><a href="model-specification.html#block-capture"><i class="fa fa-check"></i><b>2.2.11</b> <code>$CAPTURE</code>  </a></li>
<li class="chapter" data-level="2.2.12" data-path="model-specification.html"><a href="model-specification.html#block-omega"><i class="fa fa-check"></i><b>2.2.12</b> <code>$OMEGA</code>  </a></li>
<li class="chapter" data-level="2.2.13" data-path="model-specification.html"><a href="model-specification.html#block-sigma"><i class="fa fa-check"></i><b>2.2.13</b> <code>$SIGMA</code>  </a></li>
<li class="chapter" data-level="2.2.14" data-path="model-specification.html"><a href="model-specification.html#set"><i class="fa fa-check"></i><b>2.2.14</b> <code>$SET</code></a></li>
<li class="chapter" data-level="2.2.15" data-path="model-specification.html"><a href="model-specification.html#global"><i class="fa fa-check"></i><b>2.2.15</b> <code>$GLOBAL</code></a></li>
<li class="chapter" data-level="2.2.16" data-path="model-specification.html"><a href="model-specification.html#pkmodel"><i class="fa fa-check"></i><b>2.2.16</b> <code>$PKMODEL</code></a></li>
<li class="chapter" data-level="2.2.17" data-path="model-specification.html"><a href="model-specification.html#block-plugin"><i class="fa fa-check"></i><b>2.2.17</b> <code>$PLUGIN</code>  </a></li>
<li class="chapter" data-level="2.2.18" data-path="model-specification.html"><a href="model-specification.html#block-theta"><i class="fa fa-check"></i><b>2.2.18</b> <code>$THETA</code>  </a></li>
<li class="chapter" data-level="2.2.19" data-path="model-specification.html"><a href="model-specification.html#block-nmxml"><i class="fa fa-check"></i><b>2.2.19</b> <code>$NMXML</code>  </a></li>
<li class="chapter" data-level="2.2.20" data-path="model-specification.html"><a href="model-specification.html#block-include"><i class="fa fa-check"></i><b>2.2.20</b> <code>$INCLUDE</code>  </a></li>
<li class="chapter" data-level="2.2.21" data-path="model-specification.html"><a href="model-specification.html#block-env"><i class="fa fa-check"></i><b>2.2.21</b> <code>$ENV</code>  </a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="model-specification.html"><a href="model-specification.html#variables-and-macros"><i class="fa fa-check"></i><b>2.3</b> Variables and Macros</a><ul>
<li class="chapter" data-level="2.3.1" data-path="model-specification.html"><a href="model-specification.html#id"><i class="fa fa-check"></i><b>2.3.1</b> <code>ID</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="model-specification.html"><a href="model-specification.html#time"><i class="fa fa-check"></i><b>2.3.2</b> <code>TIME</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="model-specification.html"><a href="model-specification.html#solvertime"><i class="fa fa-check"></i><b>2.3.3</b> <code>SOLVERTIME</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="model-specification.html"><a href="model-specification.html#evid"><i class="fa fa-check"></i><b>2.3.4</b> <code>EVID</code></a></li>
<li class="chapter" data-level="2.3.5" data-path="model-specification.html"><a href="model-specification.html#cmt"><i class="fa fa-check"></i><b>2.3.5</b> <code>CMT</code></a></li>
<li class="chapter" data-level="2.3.6" data-path="model-specification.html"><a href="model-specification.html#amt"><i class="fa fa-check"></i><b>2.3.6</b> <code>AMT</code></a></li>
<li class="chapter" data-level="2.3.7" data-path="model-specification.html"><a href="model-specification.html#newind"><i class="fa fa-check"></i><b>2.3.7</b> <code>NEWIND</code></a></li>
<li class="chapter" data-level="2.3.8" data-path="model-specification.html"><a href="model-specification.html#self.cmt"><i class="fa fa-check"></i><b>2.3.8</b> <code>self.cmt</code></a></li>
<li class="chapter" data-level="2.3.9" data-path="model-specification.html"><a href="model-specification.html#self.amt"><i class="fa fa-check"></i><b>2.3.9</b> <code>self.amt</code></a></li>
<li class="chapter" data-level="2.3.10" data-path="model-specification.html"><a href="model-specification.html#self.nid"><i class="fa fa-check"></i><b>2.3.10</b> <code>self.nid</code></a></li>
<li class="chapter" data-level="2.3.11" data-path="model-specification.html"><a href="model-specification.html#self.idn"><i class="fa fa-check"></i><b>2.3.11</b> <code>self.idn</code></a></li>
<li class="chapter" data-level="2.3.12" data-path="model-specification.html"><a href="model-specification.html#self.nrow"><i class="fa fa-check"></i><b>2.3.12</b> <code>self.nrow</code></a></li>
<li class="chapter" data-level="2.3.13" data-path="model-specification.html"><a href="model-specification.html#self.rown"><i class="fa fa-check"></i><b>2.3.13</b> <code>self.rown</code></a></li>
<li class="chapter" data-level="2.3.14" data-path="model-specification.html"><a href="model-specification.html#self.tad"><i class="fa fa-check"></i><b>2.3.14</b> <code>self.tad()</code></a></li>
<li class="chapter" data-level="2.3.15" data-path="model-specification.html"><a href="model-specification.html#self.mtimetime"><i class="fa fa-check"></i><b>2.3.15</b> <code>self.mtime(&lt;time&gt;)</code></a></li>
<li class="chapter" data-level="2.3.16" data-path="model-specification.html"><a href="model-specification.html#self.stop"><i class="fa fa-check"></i><b>2.3.16</b> <code>self.stop()</code></a></li>
<li class="chapter" data-level="2.3.17" data-path="model-specification.html"><a href="model-specification.html#self.stop_id"><i class="fa fa-check"></i><b>2.3.17</b> <code>self.stop_id()</code></a></li>
<li class="chapter" data-level="2.3.18" data-path="model-specification.html"><a href="model-specification.html#self.stop_id_cf"><i class="fa fa-check"></i><b>2.3.18</b> <code>self.stop_id_cf()</code></a></li>
<li class="chapter" data-level="2.3.19" data-path="model-specification.html"><a href="model-specification.html#etan"><i class="fa fa-check"></i><b>2.3.19</b> <code>ETA(n)</code></a></li>
<li class="chapter" data-level="2.3.20" data-path="model-specification.html"><a href="model-specification.html#epsn"><i class="fa fa-check"></i><b>2.3.20</b> <code>EPS(n)</code></a></li>
<li class="chapter" data-level="2.3.21" data-path="model-specification.html"><a href="model-specification.html#tablename"><i class="fa fa-check"></i><b>2.3.21</b> <code>table(&lt;name&gt;)</code></a></li>
<li class="chapter" data-level="2.3.22" data-path="model-specification.html"><a href="model-specification.html#spec-f"><i class="fa fa-check"></i><b>2.3.22</b> <code>F_CMT</code>  </a></li>
<li class="chapter" data-level="2.3.23" data-path="model-specification.html"><a href="model-specification.html#spec-alag"><i class="fa fa-check"></i><b>2.3.23</b> <code>ALAG_CMT</code>  </a></li>
<li class="chapter" data-level="2.3.24" data-path="model-specification.html"><a href="model-specification.html#spec-r"><i class="fa fa-check"></i><b>2.3.24</b> <code>R_CMT</code>  </a></li>
<li class="chapter" data-level="2.3.25" data-path="model-specification.html"><a href="model-specification.html#spec-d"><i class="fa fa-check"></i><b>2.3.25</b> <code>D_CMT</code>  </a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-specification.html"><a href="model-specification.html#new-variables"><i class="fa fa-check"></i><b>2.4</b> Derive new variables</a><ul>
<li class="chapter" data-level="2.4.1" data-path="model-specification.html"><a href="model-specification.html#special-handling-for-double-int-bool"><i class="fa fa-check"></i><b>2.4.1</b> Special handling for <code>double</code>, <code>int</code>, <code>bool</code></a></li>
<li class="chapter" data-level="2.4.2" data-path="model-specification.html"><a href="model-specification.html#using-other-types-globally"><i class="fa fa-check"></i><b>2.4.2</b> Using other types globally</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="model-specification.html"><a href="model-specification.html#examples"><i class="fa fa-check"></i><b>2.5</b> Examples</a><ul>
<li class="chapter" data-level="2.5.1" data-path="model-specification.html"><a href="model-specification.html#simple-pk-model"><i class="fa fa-check"></i><b>2.5.1</b> Simple PK model</a></li>
<li class="chapter" data-level="2.5.2" data-path="model-specification.html"><a href="model-specification.html#pkpd-model"><i class="fa fa-check"></i><b>2.5.2</b> PK/PD model</a></li>
<li class="chapter" data-level="2.5.3" data-path="model-specification.html"><a href="model-specification.html#population-pk-model-with-covariates-and-iov"><i class="fa fa-check"></i><b>2.5.3</b> Population PK model with covariates and IOV</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-set-chapter.html"><a href="data-set-chapter.html"><i class="fa fa-check"></i><b>3</b> Input data sets</a><ul>
<li class="chapter" data-level="3.1" data-path="data-set-chapter.html"><a href="data-set-chapter.html#datasets"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="data-set-chapter.html"><a href="data-set-chapter.html#data-set"><i class="fa fa-check"></i><b>3.2</b> Event data sets (<code>data</code>)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-set-chapter.html"><a href="data-set-chapter.html#two-types-of-data_set"><i class="fa fa-check"></i><b>3.2.1</b> Two types of <code>data_set</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="data-set-chapter.html"><a href="data-set-chapter.html#sorting-requirements"><i class="fa fa-check"></i><b>3.2.2</b> Sorting requirements</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-set-chapter.html"><a href="data-set-chapter.html#creating-data-sets"><i class="fa fa-check"></i><b>3.2.3</b> Creating data sets</a></li>
<li class="chapter" data-level="3.2.4" data-path="data-set-chapter.html"><a href="data-set-chapter.html#example"><i class="fa fa-check"></i><b>3.2.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-set-chapter.html"><a href="data-set-chapter.html#idata-set"><i class="fa fa-check"></i><b>3.3</b> Individual data sets (<code>idata</code>)</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-set-chapter.html"><a href="data-set-chapter.html#use-case"><i class="fa fa-check"></i><b>3.3.1</b> Use case</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-set-chapter.html"><a href="data-set-chapter.html#numeric-only"><i class="fa fa-check"></i><b>3.4</b> Numeric data only</a></li>
<li class="chapter" data-level="3.5" data-path="data-set-chapter.html"><a href="data-set-chapter.html#valid_data_set"><i class="fa fa-check"></i><b>3.5</b> Data set validation</a></li>
<li class="chapter" data-level="3.6" data-path="data-set-chapter.html"><a href="data-set-chapter.html#pred-data"><i class="fa fa-check"></i><b>3.6</b> Data sets for use with <code>$PRED</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simulated-output.html"><a href="simulated-output.html"><i class="fa fa-check"></i><b>4</b> Simulated output</a><ul>
<li class="chapter" data-level="4.1" data-path="simulated-output.html"><a href="simulated-output.html#coercion-methods"><i class="fa fa-check"></i><b>4.1</b> Coercion methods</a></li>
<li class="chapter" data-level="4.2" data-path="simulated-output.html"><a href="simulated-output.html#query-methods"><i class="fa fa-check"></i><b>4.2</b> Query methods</a></li>
<li class="chapter" data-level="4.3" data-path="simulated-output.html"><a href="simulated-output.html#methods-for-dplyr-verbs"><i class="fa fa-check"></i><b>4.3</b> Methods for <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-sequence.html"><a href="section-sequence.html"><i class="fa fa-check"></i><b>5</b> Simulation sequence</a><ul>
<li class="chapter" data-level="5.1" data-path="section-sequence.html"><a href="section-sequence.html#functions-to-call"><i class="fa fa-check"></i><b>5.1</b> Functions to call</a></li>
<li class="chapter" data-level="5.2" data-path="section-sequence.html"><a href="section-sequence.html#problem-initiation"><i class="fa fa-check"></i><b>5.2</b> Problem initiation</a></li>
<li class="chapter" data-level="5.3" data-path="section-sequence.html"><a href="section-sequence.html#subject-initiation"><i class="fa fa-check"></i><b>5.3</b> Subject initiation</a></li>
<li class="chapter" data-level="5.4" data-path="section-sequence.html"><a href="section-sequence.html#sequence-for-a-single-record"><i class="fa fa-check"></i><b>5.4</b> Sequence for a single record</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="topics.html"><a href="topics.html"><i class="fa fa-check"></i><b>6</b> Topics</a><ul>
<li class="chapter" data-level="6.1" data-path="topics.html"><a href="topics.html#topic-annotated"><i class="fa fa-check"></i><b>6.1</b> Annotated model specification</a></li>
<li class="chapter" data-level="6.2" data-path="topics.html"><a href="topics.html#topic-init"><i class="fa fa-check"></i><b>6.2</b> Set initial conditions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="topics.html"><a href="topics.html#summary"><i class="fa fa-check"></i><b>6.2.1</b> Summary</a></li>
<li class="chapter" data-level="6.2.2" data-path="topics.html"><a href="topics.html#make-a-model-only-to-examine-init-behavior"><i class="fa fa-check"></i><b>6.2.2</b> Make a model only to examine <code>init</code> behavior</a></li>
<li class="chapter" data-level="6.2.3" data-path="topics.html"><a href="topics.html#example-pkpd-model-with-initial-condition"><i class="fa fa-check"></i><b>6.2.3</b> Example PK/PD model with initial condition</a></li>
<li class="chapter" data-level="6.2.4" data-path="topics.html"><a href="topics.html#remember-calling-init-will-let-you-check-to-see-what-is-going-on"><i class="fa fa-check"></i><b>6.2.4</b> Remember: calling <code>init</code> will let you check to see what is going on</a></li>
<li class="chapter" data-level="6.2.5" data-path="topics.html"><a href="topics.html#set-initial-conditions-via-idata"><i class="fa fa-check"></i><b>6.2.5</b> Set initial conditions via <code>idata</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="topics.html"><a href="topics.html#topic-parameter-update"><i class="fa fa-check"></i><b>6.3</b> Updating parameters</a><ul>
<li class="chapter" data-level="6.3.1" data-path="topics.html"><a href="topics.html#parameter-update-hierarchy"><i class="fa fa-check"></i><b>6.3.1</b> Parameter update hierarchy</a></li>
<li class="chapter" data-level="6.3.2" data-path="topics.html"><a href="topics.html#topic-parameter-update-base"><i class="fa fa-check"></i><b>6.3.2</b> Updating the base parameter list</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="topics.html"><a href="topics.html#topic-tgrid"><i class="fa fa-check"></i><b>6.4</b> Time grid objects</a></li>
<li class="chapter" data-level="6.5" data-path="topics.html"><a href="topics.html#topic-designs"><i class="fa fa-check"></i><b>6.5</b> Individualized sampling designs</a></li>
<li class="chapter" data-level="6.6" data-path="topics.html"><a href="topics.html#some-helpful-c"><i class="fa fa-check"></i><b>6.6</b> Some helpful <code>C++</code></a><ul>
<li class="chapter" data-level="6.6.1" data-path="topics.html"><a href="topics.html#semi-colons"><i class="fa fa-check"></i><b>6.6.1</b> Semi-colons</a></li>
<li class="chapter" data-level="6.6.2" data-path="topics.html"><a href="topics.html#if-else"><i class="fa fa-check"></i><b>6.6.2</b> if-else</a></li>
<li class="chapter" data-level="6.6.3" data-path="topics.html"><a href="topics.html#functions-1"><i class="fa fa-check"></i><b>6.6.3</b> Functions</a></li>
<li class="chapter" data-level="6.6.4" data-path="topics.html"><a href="topics.html#integer-division"><i class="fa fa-check"></i><b>6.6.4</b> Integer division</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="topics.html"><a href="topics.html#resimulate-eta-and-eps"><i class="fa fa-check"></i><b>6.7</b> Resimulate <code>ETA</code> and <code>EPS</code></a></li>
<li class="chapter" data-level="6.8" data-path="topics.html"><a href="topics.html#topic-matrix-update"><i class="fa fa-check"></i><b>6.8</b> Updating <code>$OMEGA</code> and <code>$SIGMA</code>  </a><ul>
<li class="chapter" data-level="6.8.1" data-path="topics.html"><a href="topics.html#matrix-helper-functions"><i class="fa fa-check"></i><b>6.8.1</b> Matrix helper functions</a></li>
<li class="chapter" data-level="6.8.2" data-path="topics.html"><a href="topics.html#fill-a-matrix-with-zeros"><i class="fa fa-check"></i><b>6.8.2</b> Fill a matrix with zeros</a></li>
<li class="chapter" data-level="6.8.3" data-path="topics.html"><a href="topics.html#example-unnamed-matrix"><i class="fa fa-check"></i><b>6.8.3</b> Example: unnamed matrix</a></li>
<li class="chapter" data-level="6.8.4" data-path="topics.html"><a href="topics.html#example-named-matrices"><i class="fa fa-check"></i><b>6.8.4</b> Example: named matrices</a></li>
<li class="chapter" data-level="6.8.5" data-path="topics.html"><a href="topics.html#example-unnamed-matrices"><i class="fa fa-check"></i><b>6.8.5</b> Example: unnamed matrices</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="topics.html"><a href="topics.html#topics-time-varying"><i class="fa fa-check"></i><b>6.9</b> Time varying covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>7</b> Installation</a></li>
<li class="divider"></li>
<li><a href="https://mrgsolve.github.io" target="blank">https://mrgsolve.github.io</a></li>
<li><a href="https:/metrumrg.com" target="blank">https://metrumrg.com</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">mrgsolve User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-specification" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Model specification</h1>
<p>This chapter details the <code>mrgsolve</code> model specification format.</p>
<div id="how-where-to-write-a-model" class="section level2">
<h2><span class="header-section-number">2.1</span> How / where to write a model</h2>
<p>There are two ways to write your model:</p>
<div id="spec-separate-file" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Separate file</h3>
<p>Open a text editor and type the model into a file with name that has the
format <code>&lt;model-name&gt;.cpp</code>. This filename format identifies a “name” for your
model (<code>&lt;model-name&gt;</code>, the “stem” of the file name). The extension <strong>MUST</strong>
be <code>.cpp</code> (<code>mrgsolve</code> currently assumes the extension). Note: this whole file
will be read and parsed, so everything in it must be valid <code>mrgsolve</code> model
specification elements.</p>
<p>Use the <code>mread()</code> function to read and parse this file. For the model
called <code>mymodel</code> saved in <code>mymodel.cpp</code> (in the current working directory),
issue the command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">mread</span>(<span class="st">&quot;mymodel&quot;</span>)</a></code></pre></div>
<p><code>mread()</code> returns a model object from which you can simulate.</p>
</div>
<div id="spec-inline" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Inline / <code>code</code>  </h3>
<p>Often it is more convenient to write a model right in your <code>R</code> script. The
model might look something like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">code &lt;-<span class="st"> &#39;</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">$PARAM CL = 1, VC = 20</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">$PKMODEL ncmt=1</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">&#39;</span></a></code></pre></div>
<p>Here, we created a character vector of length 1 and saved it to the <code>R</code> object
called <code>code</code>. The name of this object is irrelevant. But <code>code</code> will be
passed into <code>mrgsolve</code> as the model definition. When <code>mrgsolve</code> gets a model
like this along with a “name” for the model, mrgsolve will write the code to a
file called <code>&lt;model-name&gt;.cpp</code> and read it right back in as if you had typed
the code into this file (section <a href="model-specification.html#spec-separate-file">2.1.1</a>).</p>
<p>To parse and load this model, use the <code>mcode()</code> command:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;mymodel&quot;</span>, code)</a></code></pre></div>
<p><code>mcode()</code> is a convenience wrapper for <code>mread()</code>. <code>mcode</code> writes the code to
<code>mymodel.cpp</code> in <code>tempdir()</code>, reads it back in, compiles and loads.</p>
<p>The <code>mcode</code> call is equivalent to:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">mread</span>(<span class="st">&quot;mymodel&quot;</span>, <span class="kw">tempdir</span>(), code)</a></code></pre></div>
<p>For help, see <code>?mread</code> , <code>?mcode</code> in the <code>R</code> help system after loading
<code>mrgsolve</code>.</p>
</div>
</div>
<div id="code-blocks" class="section level2">
<h2><span class="header-section-number">2.2</span> Code blocks</h2>
<div id="about-code-blocks" class="section level3">
<h3><span class="header-section-number">2.2.1</span> About code blocks</h3>
<p><strong>Block identifier</strong></p>
<p>Different types of code are organized in the model specification file and
separated by block identifiers. There are two ways to formulate block identifiers that
can be used in mrgsolve. In the first type, a dollar-sign is placed at the
start of the block name</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb12-1" data-line-number="1">$BLOCKNAME</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">&lt;block-code&gt;</a></code></pre></div>
<p>For example, a block of parameters would be</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb13-1" data-line-number="1">$PARAM</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">CL = <span class="dv">1</span></a></code></pre></div>
<p>The second way to write this is with brackets</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb14-1" data-line-number="1">[ BLOCKNAME ] </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">&lt;block-code&gt;</a></code></pre></div>
<p>There is no functional difference between the dollar-sign notation and the
brackets. When model specification code is saved into a file with a <code>.cpp</code>
extension, the code editor may make certain assumptions about formatting or
styling the code. Using brackets will most-likely work better with the
editor in that case.</p>
<p>Users are free to include block code on the same line as the block identifier,
but must include a space after the identifier. For example, the parser will
recognize <code>$PARAM CL = 1</code> but not <code>$PARAMCL=1</code> as parameters.</p>
<p><strong>Block syntax</strong>
Different blocks may require different syntax. For example, code written in
<code>$PARAM</code> will be parsed by the <code>R</code> parser and will generally need to adhere to
<code>R</code> syntax requirements. On the other hand, code in <code>$MAIN</code>, <code>$ODE</code>, and
<code>$TABLE</code> will be used to make functions in <code>C++</code> and therefore will need to be
valid <code>C++</code> code, including terminal <code>;</code> on each line.</p>
<p><strong>Block options</strong>
Options may be specified on some code blocks that signal how the code is
to be parsed or used in the simulation.</p>
</div>
<div id="block-prob" class="section level3">
<h3><span class="header-section-number">2.2.2</span> <code>$PROB</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code>, <code>@covariates</code></p>
<p>Use this block to make notes about the model. There are no restrictions on the
text that gets entered here. mrgsolve does not routinely process the text
in any way, except when rendering the model as a document. Frequently, we
write the text here in markdown format so that it will render nicely in the
model document. But this is completely optional.</p>
<p>See the annotated model in section <a href="topics.html#topic-annotated">6.1</a> for an example.</p>
</div>
<div id="block-param" class="section level3">
<h3><span class="header-section-number">2.2.3</span> <code>$PARAM</code>  </h3>
<p><strong>Syntax</strong>: R<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code>, <code>@covariates</code></p>
<p>Define the parameter list in the current model. Parameters are names associated
with values that can be used throughout the model. A value must be given
for every parameter name. Names (and numbers) of parameters must be set at the
time the model is compiled, but parameter values may be updated without
re-compiling the model.</p>
<p>The <code>@covariates</code> option allows you to tag a collection of parameters as
“covariates”. It does not change the functionality of the model or simulation
workflow in any way, but allows you to get that list of covariate names out
of the model object.</p>
<p>Example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb15-1" data-line-number="1">[ PARAM ] CL = <span class="dv">1</span>, VC = <span class="dv">20</span>, KA = <span class="fl">1.2</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">KM = <span class="dv">25</span>, VMAX = <span class="dv">400</span>, FLAG = <span class="dv">1</span>, WT = <span class="dv">80</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">SEX = <span class="dv">0</span>, N = sqrt(<span class="dv">25</span>)</a></code></pre></div>
<p>Annotated example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb16-1" data-line-number="1">[ PARAM ] @annotated</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">CL :   <span class="dv">1</span> : Clearance (L/hr)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">VC :  <span class="dv">20</span> : Volume of distribution (L)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">KA:  <span class="fl">1.2</span> : Absorption rate constant (<span class="dv">1</span>/hr)</a></code></pre></div>
<p>See the <code>popex</code> model for an example of using <code>@covariates</code></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb17-1" data-line-number="1">$PROB</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="er"># Example population PK model</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">$PARAM TVKA = <span class="fl">0.5</span>, TVCL = <span class="dv">1</span>, TVV = <span class="dv">24</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">$PARAM @covariates</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">WT = <span class="dv">70</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">$PKMODEL cmt=<span class="st">&quot;GUT CENT&quot;</span>, depot=TRUE</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"></a>
<a class="sourceLine" id="cb17-11" data-line-number="11">$SET end=<span class="dv">240</span>, delta=<span class="fl">0.5</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"></a>
<a class="sourceLine" id="cb17-13" data-line-number="13">$MAIN</a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="dt">double</span> CL = exp(log(TVCL) + <span class="fl">0.75</span>*log(WT/<span class="dv">70</span>) + ECL);</a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="dt">double</span> V  = exp(log(TVV)  +      log(WT/<span class="dv">70</span>) + EV );</a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="dt">double</span> KA = exp(log(TVKA)                   + EKA);</a>
<a class="sourceLine" id="cb17-17" data-line-number="17"></a>
<a class="sourceLine" id="cb17-18" data-line-number="18">$OMEGA @labels ECL EV EKA</a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="fl">0.3</span> <span class="fl">0.1</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"></a>
<a class="sourceLine" id="cb17-21" data-line-number="21">$SIGMA <span class="dv">0</span></a>
<a class="sourceLine" id="cb17-22" data-line-number="22"></a>
<a class="sourceLine" id="cb17-23" data-line-number="23">$TABLE</a>
<a class="sourceLine" id="cb17-24" data-line-number="24">capture IPRED = CENT/V;</a>
<a class="sourceLine" id="cb17-25" data-line-number="25">capture DV = IPRED*exp(EPS(<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb17-26" data-line-number="26"></a>
<a class="sourceLine" id="cb17-27" data-line-number="27">$CAPTURE CL V ECL</a>
<a class="sourceLine" id="cb17-28" data-line-number="28"></a>
<a class="sourceLine" id="cb17-29" data-line-number="29">  </a></code></pre></div>
<p>then</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">modlib</span>(<span class="st">&quot;popex&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">as.list</span>(mod)<span class="op">$</span>covariates</a></code></pre></div>
<pre><code>. character(0)</code></pre>
<p>Notes:</p>
<ul>
<li>Multiple blocks are allowed</li>
<li>Values are evaluated by the <code>R</code> interpreter</li>
</ul>
<p>See also: section <a href="model-specification.html#block-theta">2.2.18</a> and <a href="model-specification.html#block-fixed">2.2.4</a>.</p>
<p>See <code>?param</code> in the <code>R</code> help system after loading <code>mrgsolve</code>.</p>
</div>
<div id="block-fixed" class="section level3">
<h3><span class="header-section-number">2.2.4</span> <code>$FIXED</code>  </h3>
<p><strong>Syntax</strong>: R<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code></p>
<p>Like <code>$PARAM</code>, <code>$FIXED</code> is used to specify <code>name=value</code> pairs. Unlike
<code>$PARAM</code>, however, the values associated with names in <code>$FIXED</code> are not able
to be updated.</p>
<p>By default, names in <code>$FIXED</code> are associated with their value through a
<code>C++</code> preprocessor <code>#define</code> statement.</p>
<p>Usually, <code>$FIXED</code> is only used when there are a very large number of
parameters (<span class="math inline">\(&gt;\)</span> 100 or 200). When some of these parameters never need
to be updated, you can move them to a <code>$FIXED</code> block to get a modest gain
in efficiency of the simulation.</p>
<p>Items in <code>$FIXED</code> will not be shown when parameters are queried.</p>
<p>Example:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb21-1" data-line-number="1">[ PARAM ] CL = <span class="dv">2</span>, VC = <span class="dv">20</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">[ FIXED ]</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">g = <span class="fl">9.8</span></a></code></pre></div>
<p>Annotated example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb22-1" data-line-number="1">$FIXED @annotated</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">g : <span class="fl">9.8</span> : Acceleration due to gravity (m/s^<span class="dv">2</span>)</a></code></pre></div>
<p>See also: section <a href="model-specification.html#block-param">2.2.3</a> and <a href="model-specification.html#block-theta">2.2.18</a>.</p>
<p>Notes:</p>
<ul>
<li>Multiple blocks are allowed</li>
<li>Values are evaluated by the <code>R</code> interpreter</li>
</ul>
</div>
<div id="cmt-and-init" class="section level3">
<h3><span class="header-section-number">2.2.5</span> <code>$CMT</code> and <code>$INIT</code></h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code></p>
<p>Declare the names of all compartments in the model.</p>
<ul>
<li>For <code>$CMT</code> give the names of compartments; initial values are assumed to be 0</li>
<li>For <code>$INIT</code> give the name and initial value for all compartments</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb23-1" data-line-number="1">[ CMT ] GUT CENT RESPONSE</a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb24-1" data-line-number="1">[ INIT ] GUT  = <span class="dv">0</span>, CENT = <span class="dv">0</span>, RESPONSE = <span class="dv">25</span></a></code></pre></div>
<p>Annotated examples:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb25-1" data-line-number="1">[ CMT ] @annotated</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">GUT      : Dosing compartment (mg)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">CENT     : Central PK compartment (mg)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">RESPONSE : Response</a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb26-1" data-line-number="1">$INIT @annotated</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">GUT      :   <span class="dv">0</span> : Dosing compartment (mg)</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">CENT     :   <span class="dv">0</span> : Central PK compartment (mg)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">RESPONSE :  <span class="dv">25</span> : Response</a></code></pre></div>
<p>See <code>?init</code> in the <code>R</code> help system after loading <code>mrgsolve</code>.</p>
</div>
<div id="block-main" class="section level3">
<h3><span class="header-section-number">2.2.6</span> <code>$MAIN</code>  </h3>
<p><strong>Syntax</strong>: C++<br />
<strong>Multiple allowed</strong>: no</p>
<p>This code block has two main purposes:</p>
<ul>
<li>Derive new algebraic relationships between parameters, random, effects and
other derived variables</li>
<li>Set the initial conditions for model compartments</li>
</ul>
<p>For users who are familiar with NONMEM, <code>$MAIN</code> is similar to <code>$PK</code>.</p>
<p><code>$MAIN</code> is wrapped into a <code>C++</code> function and compiled / loaded by <code>mrgsolve</code>.<br />
The <code>MAIN</code> function gets called just prior to advancing the system from the
current time to the next time for each record in the data set. <code>$MAIN</code> also
gets called several times before starting the problem (<code>NEWIND == 0</code>) and
just prior to simulating each individual (<code>NEWIND == 1</code>). Finally, <code>$MAIN</code>
gets called every time the model initial conditions are queried with <code>init()</code>.</p>
<p>New variables may be declared in <code>$MAIN</code>. See section <a href="model-specification.html#new-variables">2.4</a>
for details.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb27-1" data-line-number="1">[ CMT ] CENT RESP</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"></a>
<a class="sourceLine" id="cb27-3" data-line-number="3">[ PARAM ] KIN = <span class="dv">100</span>, KOUT = <span class="dv">2</span>, CL = <span class="dv">1</span>, VC = <span class="dv">20</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">[ MAIN ]</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"></a>
<a class="sourceLine" id="cb27-7" data-line-number="7">RESP_0 = KIN/KOUT;</a>
<a class="sourceLine" id="cb27-8" data-line-number="8"></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="dt">double</span> ke = CL/VC;</a></code></pre></div>
</div>
<div id="block-ode" class="section level3">
<h3><span class="header-section-number">2.2.7</span> <code>$ODE</code>  </h3>
<p><strong>Syntax</strong>: C++<br />
<strong>Multiple allowed</strong>: no<br />
<strong>Options</strong>: <code>@param</code></p>
<p>Use <code>$ODE</code> to define model differential equations. For all compartments assign
the value of the differential equation to <code>dxdt_CMT</code> where <code>CMT</code> is the name
of the compartment. The <code>dxdt_</code> equation may be a function of model
parameters (via <code>$PARAM</code>), the current value of any compartment (<code>CMT</code>)
or any user-derived variable.</p>
<p>For example:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb28-1" data-line-number="1">[ CMT ] GUT CENT</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3">[ ODE ]</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">dxdt_GUT = -KA*GUT;</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">dxdt_CENT = KA*GUT - KE*CENT;</a></code></pre></div>
<p>It is important to make sure that there is a <code>dxdt_</code> expression defined for
every compartment listed in <code>$CMT</code> or <code>$INIT</code>, even if it is <code>dxdt_CMT = 0;</code></p>
<p>The <code>$ODE</code> function is called repeatedly during a simulation run. So it is
wise to do as many calculations as possible outside of <code>$ODE</code>, usually in
<code>$MAIN</code>. But remember that any calculation that depends on an amount in a
compartment and helps determine the <code>dxdt_</code> expression in a model must be
written in <code>$ODE</code>.</p>
<p>New variables may be declared in <code>$ODE</code>. See section <a href="model-specification.html#new-variables">2.4</a>
for details.</p>
<p>For example:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb29-1" data-line-number="1">$CMT CENT RESP</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">$PARAM VC = <span class="dv">100</span>, KE = <span class="fl">0.2</span>, KOUT = <span class="dv">2</span>, KIN = <span class="dv">100</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">$ODE</a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="dt">double</span> CP = CENT/VC;</a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="dt">double</span> INH = CP/(IMAX+CP)</a>
<a class="sourceLine" id="cb29-6" data-line-number="6"></a>
<a class="sourceLine" id="cb29-7" data-line-number="7">dxdt_CENT = -KE*CENT;</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">dxdt_RESP =  KIN*(<span class="dv">1</span> - INH) - RESP*KOUT;</a></code></pre></div>
<p>If the model needs to refer to the current time, use the <code>SOLVERTIME</code> variable.</p>
<p>Notes:</p>
<ul>
<li><code>$ODE</code> is written in <code>C++</code> syntax; every line must end in <code>;</code></li>
<li>There may be only one <code>$ODE</code> block in a model</li>
</ul>
</div>
<div id="block-table" class="section level3">
<h3><span class="header-section-number">2.2.8</span> <code>$TABLE</code>  </h3>
<p><strong>Syntax</strong>: C++<br />
<strong>Multiple allowed</strong>: no</p>
<p>Use <code>$TABLE</code> to interact with parameters, compartment values, and other
user-defined variables <strong>after</strong> the system advances to the next time.</p>
<p>For example:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb30-1" data-line-number="1">[ TABLE ]</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="dt">double</span> CP = CENT/VC;</a></code></pre></div>
<p><strong>NOTE</strong>
<code>mrgsolve</code> formerly had a <code>table()</code> macro for inserting derived values into
simulated output. This macro has been deprecated. The only way to insert
derived values into the simulated output is via <code>$CAPTURE</code>.</p>
<p><strong>NOTE</strong>
When variables are marked for capture (see <a href="model-specification.html#block-capture">2.2.11</a>), the values of
those variables are saved at the <strong>end</strong> of the <code>$TABLE</code> function. This process
is carried out automatically by <code>mrgsolve</code> and therefore requires no user
intervention.</p>
</div>
<div id="block-preamble" class="section level3">
<h3><span class="header-section-number">2.2.9</span> <code>$PREAMBLE</code>  </h3>
<p><strong>Syntax</strong>: C++<br />
<strong>Multiple allowed</strong>: no</p>
<p>This is the fourth C++ code block. It is called once in two different settings:</p>
<ol style="list-style-type: decimal">
<li>Immediately prior to starting the simulation run</li>
<li>Immediately prior to calling <code>$MAIN</code> when calculating initial conditions</li>
</ol>
<p><code>$PREAMBLE</code> is a function that allows you to set up your C++ environment. It is
only called one time during the simulation run (right at the start). The code
in this block is typically used to configure or initialize C++ variables or data
structures that were declared in <code>$GLOBAL</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb31-1" data-line-number="1">[ PLUGIN ] Rcpp</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">[ GLOBAL ]</a>
<a class="sourceLine" id="cb31-4" data-line-number="4">namespace{</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">  Rcpp::NumericVector x;</a>
<a class="sourceLine" id="cb31-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb31-7" data-line-number="7"></a>
<a class="sourceLine" id="cb31-8" data-line-number="8">[ PREAMBLE ]</a>
<a class="sourceLine" id="cb31-9" data-line-number="9">x.push_back(<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb31-10" data-line-number="10">x.push_back(<span class="dv">2</span>);</a>
<a class="sourceLine" id="cb31-11" data-line-number="11">x.push_back(<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb31-12" data-line-number="12"></a>
<a class="sourceLine" id="cb31-13" data-line-number="13">[ MAIN ]</a>
<a class="sourceLine" id="cb31-14" data-line-number="14">&lt;some code that uses x vector&gt;</a></code></pre></div>
<p>In this example, we want to use a numeric vector <code>x</code> and declare it in <code>$GLOBAL</code>
so that we can use it anywhere else in the code (the declaration is also made in
an unnamed namespace to ensure that the variable is local to the model file).
Then, in <code>$PREAMBLE</code>, we put 3 numbers into the vector and we use <code>x</code> in
<code>$MAIN</code>. Since <code>$MAIN</code>, <code>$TABLE</code> and (especially) <code>$ODE</code> are called repeatedly
as the simulation run progresses, we put the initialization of <code>x</code> in <code>$PREAMBLE</code>
to make sure the initialization of <code>x</code> only happens once.</p>
<p>Notes:</p>
<ul>
<li><code>$PREAMBLE</code> is written in <code>C++</code> syntax; every line must end in <code>;</code></li>
<li>There may be only one <code>$PREAMBLE</code> block in a model</li>
<li>Like <code>$MAIN</code>, <code>$ODE</code> and <code>$TABLE</code>, <code>double</code>, <code>int</code> and <code>bool</code> variables
initialized in <code>$PREAMBLE</code> are actually initialized for global (within the
model file)</li>
</ul>
<p>See also: <a href="model-specification.html#block-plugin">2.2.17</a>.</p>
</div>
<div id="block-pred" class="section level3">
<h3><span class="header-section-number">2.2.10</span> <code>$PRED</code>  </h3>
<p><strong>Syntax</strong>: C++<br />
<strong>Multiple allowed</strong>: no</p>
<p>Use <code>$PRED</code> to write a model without differential equations. In this block,
write all algebraic expressions for derived parameters, the response, and
any other derived output quantities.</p>
<p>For example:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb32-1" data-line-number="1">[ PARAM ] TVE0 = <span class="dv">100</span>, AUC50 = <span class="dv">100</span>, IMAX = <span class="dv">40</span>, AUC = <span class="dv">0</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"></a>
<a class="sourceLine" id="cb32-3" data-line-number="3">[ PRED ]</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="dt">double</span> E0 = EVE0*exp(ETA(<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="dt">double</span> RESP = E0 - IMAX*AUC/(AUC50+AUC);</a></code></pre></div>
<p>In this example, the entire model is written in the <code>$PRED</code> block. It is an
error to include the following blocks when <code>$PRED</code> is being used: <code>$MAIN</code>,
<code>$TABLE</code>, <code>$PKMODEL</code>, <code>$ODE</code>, <code>$CMT</code>, <code>$INIT</code>.</p>
<p>See the section <a href="data-set-chapter.html#pred-data">3.6</a> for additional information regarding data sets
in use with <code>$PRED</code> block.</p>
</div>
<div id="block-capture" class="section level3">
<h3><span class="header-section-number">2.2.11</span> <code>$CAPTURE</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code></p>
<p>This is a block to identify variables that should be captured in the simulated
output.</p>
<p>For example:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb33-1" data-line-number="1">[ PARAM ] A = <span class="dv">1</span>, B = <span class="dv">2</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"></a>
<a class="sourceLine" id="cb33-3" data-line-number="3">[ MAIN ]</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="dt">double</span> C = <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="dt">bool</span> yes = true;</a>
<a class="sourceLine" id="cb33-6" data-line-number="6"></a>
<a class="sourceLine" id="cb33-7" data-line-number="7">[ CAPTURE ] A B C yes</a></code></pre></div>
<p>This construct will result in 4 additional columns in the simulated output
with names <code>A</code>, <code>B</code>, <code>C</code>, and <code>yes</code>.</p>
<p>Users can also rename captured variables by providing a
<code>newname = oldname</code> specification.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb34-1" data-line-number="1">$PARAM WT = <span class="dv">70</span>, THETA1 = <span class="fl">2.2</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"></a>
<a class="sourceLine" id="cb34-3" data-line-number="3">$MAIN</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="dt">double</span> CL = THETA1*pow(WT/<span class="dv">70</span>,<span class="fl">0.75</span>)*exp(ETA(<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb34-5" data-line-number="5"></a>
<a class="sourceLine" id="cb34-6" data-line-number="6">$OMEGA <span class="dv">1</span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7"></a>
<a class="sourceLine" id="cb34-8" data-line-number="8">$CAPTURE WEIGHT = WT TVCL = THETA2 CL  ETA(<span class="dv">1</span>)</a></code></pre></div>
<p>In this example, the names of the captured data items will be
<code>WEIGHT,TVCL,CL,ETA_1</code>.</p>
<p>Users can use the <code>capture</code> type to declare variables in <code>$MAIN</code> and <code>$TABLE</code>.
<code>capture</code> types are really <code>double</code>s, but using that type will signal <code>mrgsolve</code>
to automatically capture that value. For example:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb35-1" data-line-number="1">$PARAM VC = <span class="dv">300</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"></a>
<a class="sourceLine" id="cb35-3" data-line-number="3">$CMT CENT</a>
<a class="sourceLine" id="cb35-4" data-line-number="4"></a>
<a class="sourceLine" id="cb35-5" data-line-number="5">$TABLE</a>
<a class="sourceLine" id="cb35-6" data-line-number="6">capture DV = (CENT/VC);</a></code></pre></div>
<p>Since we used type <code>capture</code> for <code>DV</code>, <code>DV</code> will show up as a column in the
simulated data.</p>
<p>Annotated example:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb36-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="dt">double</span> CLi = TVCL*exp(ECL);</a>
<a class="sourceLine" id="cb36-3" data-line-number="3"></a>
<a class="sourceLine" id="cb36-4" data-line-number="4">$TABLE</a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="dt">double</span> DV = (CENT/VC)*exp(PROP);</a>
<a class="sourceLine" id="cb36-6" data-line-number="6"></a>
<a class="sourceLine" id="cb36-7" data-line-number="7">$CAPTURE @annotated</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">CLi : Individual clearance (L/hr)</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">DV  : Plasma concentration (mcg/ml)</a></code></pre></div>
<p>New variables may be declared in <code>$TABLE</code>. See section <a href="model-specification.html#new-variables">2.4</a> for
details.</p>
</div>
<div id="block-omega" class="section level3">
<h3><span class="header-section-number">2.2.12</span> <code>$OMEGA</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code>, <code>@block</code>, <code>@correlation</code>, <code>@labels</code>, <code>@name</code></p>
<p>See <code>?modMATRIX</code> for more details about options for this block.</p>
<p>Use this block to enter variance/covariance matrices for subject-level random
effects drawn from multivariate normal distribution. All random effects are
assumed to have mean of 0. Off diagonal elements for block matrices are assumed
to be correlation coefficients if the <code>@correlation</code> option is used (see below).</p>
<p>By default, a <strong>diagonal</strong> matrix is assumed. So:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb37-1" data-line-number="1">$OMEGA</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span></a></code></pre></div>
<p>will generate a 3x3 omega matrix.</p>
<p>A <strong>block</strong> matrix may be entered by using <code>block=TRUE</code>. So:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb38-1" data-line-number="1">$OMEGA @block</a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="fl">0.1</span> <span class="fl">0.02</span> <span class="fl">0.3</span></a></code></pre></div>
<p>will generate a 2x2 matrix with covariance 0.02.</p>
<p>A 2x2 matrix where the off-diagonal element is a correlation, not a covariance
can be specified like this:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb39-1" data-line-number="1">$OMEGA @correlation</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="fl">0.1</span> <span class="fl">0.67</span> <span class="fl">0.3</span></a></code></pre></div>
<p>Here, the correlation is 0.67. <code>mrgsolve</code> will calculate the covariances and
substitute these values. The matrix will be stored and used with these
covariances, not the correlation.</p>
<p>A name can be assigned to each matrix:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb40-1" data-line-number="1">$OMEGA @name PK @block</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="fl">0.2</span> <span class="fl">0.02</span> <span class="fl">0.3</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"></a>
<a class="sourceLine" id="cb40-4" data-line-number="4">$OMEGA @name PD</a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span> <span class="fl">0.5</span></a></code></pre></div>
<p>to distinguish between multiple <code>$OMEGA</code> blocks and to facilitate updating later. The model in the preceding example will have two
<code>$OMEGA</code> matrices: 2x2 and 4x4.</p>
<p>Annotated example (diagonal matrix):</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb41-1" data-line-number="1">$OMEGA @annotated</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">ECL: <span class="fl">0.09</span> : ETA on clearance</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">EVC: <span class="fl">0.19</span> : ETA on volume</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">EKA: <span class="fl">0.45</span> : ETA on absorption rate constant</a></code></pre></div>
<p>Annotated example (block matrix):</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb42-1" data-line-number="1">$OMEGA @annotated @block</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">ECL: <span class="fl">0.09</span> : ETA on clearance</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">EVC: <span class="fl">0.001</span> <span class="fl">0.19</span> : ETA on volume</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">EKA: <span class="fl">0.001</span> <span class="fl">0.001</span> <span class="fl">0.45</span> : ETA on absorption rate constant</a></code></pre></div>
<p>Notes:</p>
<ul>
<li>Multiple <code>$OMEGA</code> blocks are allowed</li>
</ul>
</div>
<div id="block-sigma" class="section level3">
<h3><span class="header-section-number">2.2.13</span> <code>$SIGMA</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code>, <code>@block</code>, <code>@correlation</code>, <code>@labels</code>, <code>@name</code></p>
<p>See <code>?modMATRIX</code> for more details about options for this block.</p>
<p>Use this block to enter variance/covariance matrices for within-subject random
effects drawn from multivariate normal distribution. All random effects are
assumed to have mean of 0. Off diagonal elements for block matrices are assumed
to be correlation coefficients if the <code>@correlation</code> option is used (see below).</p>
<p>The <code>$SIGMA</code> block functions like the <code>$OMEGA</code> block. See <code>$OMEGA</code> for details.</p>
</div>
<div id="set" class="section level3">
<h3><span class="header-section-number">2.2.14</span> <code>$SET</code></h3>
<p><strong>Syntax</strong>: R<br />
<strong>Multiple allowed</strong>: no</p>
<p>Use this code block to set different options for the simulation. Use a
<code>name=value</code> format, where <code>value</code> is evaluated by the <code>R</code> interpreter.</p>
<p>Most of the options that can be entered in <code>$SET</code> are passed to <code>update</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb43-1" data-line-number="1">[ SET ] end = <span class="dv">240</span>, delta=<span class="fl">0.5</span>, req=s(RESP)</a></code></pre></div>
<p>Here, we set the simulation <code>end</code> time to 240, set the time difference between
two adjacent time points to 0.25 time units, and request only the <code>RESP</code>
compartment in the simulated output.</p>
</div>
<div id="global" class="section level3">
<h3><span class="header-section-number">2.2.15</span> <code>$GLOBAL</code></h3>
<p><strong>Syntax</strong>: C++<br />
<strong>Multiple allowed</strong>: no</p>
<p>The <code>$GLOBAL</code> block is for writing <code>C++</code> code that is outside of <code>$MAIN</code>,
<code>$ODE</code>, and <code>$TABLE</code>.</p>
<p>There are no artificial limit on what sort of <code>C++</code> code can go in <code>$GLOBAL</code>.<br />
However there are two more-common uses:</p>
<ol style="list-style-type: decimal">
<li>Write <code>#define</code> preprocessor statements</li>
<li>Define global variables, usually variables other than <code>double</code>, <code>bool</code>,
<code>int</code> (see <a href="model-specification.html#new-variables">2.4</a>)</li>
</ol>
<p><strong>Preprocessor directives</strong>
Preprocessor <code>#define</code> directives are direct substitutions that the <code>C++</code>
preprocessor makes prior to compiling your code.</p>
<p>For example:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb44-1" data-line-number="1">[ GLOBAL ]</a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="pp">#define CP (CENT/VC)</span></a></code></pre></div>
<p>When this preprocessor directive is included, everywhere the preprocessor finds
a <code>CP</code> token it will substitute <code>(CENT/VC)</code>. Both <code>CENT</code> and <code>VC</code> must be
defined and the ratio of <code>CENT</code> to <code>VC</code> will be calculated depending on whatever
the current values are. Notice that we included parentheses around <code>(CENT/VC)</code>.<br />
This makes sure the ratio between the two is taken first, before any other
operations involving <code>CP</code>.</p>
<p><strong>Declaring global variables</strong>
Sometimes, you may wish to use global variables and have more control over how
they get declared.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb45-1" data-line-number="1">$GLOBAL</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="dt">bool</span> cure = false;</a></code></pre></div>
<p>With this construct, the boolean variable <code>cure</code> is declared and defined right
as the model is compiled.</p>
</div>
<div id="pkmodel" class="section level3">
<h3><span class="header-section-number">2.2.16</span> <code>$PKMODEL</code></h3>
<p><strong>Syntax</strong>: R<br />
<strong>Multiple allowed</strong>: no</p>
<p>This code block implements a one- or two-compartment PK model where the system
is calculated by algebraic equations, not ODEs. <code>mrgsolve</code> handles the
calculations and an error is generated if both <code>$PKMODEL</code> and <code>$ODE</code> blocks are
included in the same model specification file.</p>
<p>This is an options-only block. The user must specify the number of compartments
(1 or 2) to use in the model as well as whether or not to include a depot dosing
compartment. See <code>?PKMODEL</code> for more details about this block, including
specific requirements for symbols that must be defined in the model
specification file.</p>
<p>The <code>$CMT</code> or <code>$INIT</code> block must also be included with an appropriate number of
compartments. Compartment names, however, may be determined by the user.</p>
<p>Example:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb46-1" data-line-number="1">[ CMT ] GUT CENT PERIPH</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">[ PKMODEL ] ncmt=<span class="dv">2</span>, depot=TRUE</a></code></pre></div>
<p>As of version <code>0.8.2</code>, we can alternatively specify the compartments
right in the <code>$PKMODEL</code> block:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb47-1" data-line-number="1">$PKMODEL cmt=<span class="st">&quot;GUT CENT PERIPH&quot;</span>, depot = TRUE</a></code></pre></div>
<p>Specifying three compartments with <code>depot=TRUE</code> implies <code>ncmt=2</code>. Notice that a
separate <code>$CMT</code> block is not appropriate when <code>cmt</code> is specified in <code>$PKMODEL</code>.</p>
</div>
<div id="block-plugin" class="section level3">
<h3><span class="header-section-number">2.2.17</span> <code>$PLUGIN</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: no</p>
<p>Plugins are a way to add extensions to your <code>mrgsolve</code> model. When a plugin is
recruited into the model, <code>mrgsolve</code> may do one or more of the following:</p>
<ul>
<li>Link to another <code>R</code> package during compilation, including
<ul>
<li><code>Rcpp</code> to allow you to write <code>Rcpp</code> code in your specification</li>
<li><code>mrgx</code> to provide some extra C++ functions (see below)</li>
<li><code>RcppArmadillo</code> to both <code>Rcpp</code> and <code>Armadillo</code> in your specification</li>
<li><code>BH</code> to use <code>boost</code> headers</li>
</ul></li>
<li>Include appropriate header files during compilation
<ul>
<li>For example, when the <code>Rcpp</code> plugin is called, <code>mrgsolve</code> will <code>#include &lt;Rcpp.h&gt;</code>
at the top of your model file</li>
</ul></li>
</ul>
<p>You recruit a plugin in the <code>$PLUGIN</code> block</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb48-1" data-line-number="1">[ PLUGIN ] Rcpp</a></code></pre></div>
<p>The example above will bring <code>Rcpp</code> headers into the model code.</p>
<p>Plugins that you can use:
- <code>Rcpp</code> to write any <code>Rcpp</code> code
- <code>mrgx</code> additional functions provided by <code>mrgsolve</code> that help use <code>Rcpp</code> in your model
- <code>RcppArmadillo</code> to write any <code>Rcpp</code> or <code>RcppArmadillo</code> code
- <code>BH</code> to link to <code>boost</code> headers</p>
<p>Note that <code>Rcpp</code>, <code>RcppArmadillo</code> and <code>BH</code> only allow you to link to those
headers. To take advantage of that, you will need to know how to use <code>Rcpp</code>,
<code>boost</code> etc. For the <code>BH</code> plugin, no headers are included for you; you must
include the proper headers you want to use in <code>$GLOBAL</code>.</p>
<p><strong>Rcpp</strong> example</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb49-1" data-line-number="1"></a>
<a class="sourceLine" id="cb49-2" data-line-number="2">[ PLUGIN ] Rcpp</a>
<a class="sourceLine" id="cb49-3" data-line-number="3"></a>
<a class="sourceLine" id="cb49-4" data-line-number="4">[ MAIN ]</a>
<a class="sourceLine" id="cb49-5" data-line-number="5"></a>
<a class="sourceLine" id="cb49-6" data-line-number="6"><span class="cf">if</span>(NEWIND &lt;=<span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb49-7" data-line-number="7">  <span class="dt">double</span> wt = R::rnorm(<span class="dv">70</span>,<span class="dv">20</span>);</a>
<a class="sourceLine" id="cb49-8" data-line-number="8">  <span class="dt">double</span> sex = R::rbinom(<span class="dv">1</span>,<span class="fl">0.51</span>);</a>
<a class="sourceLine" id="cb49-9" data-line-number="9">}</a></code></pre></div>
<p><strong>mrgx</strong></p>
<p>For example</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb50-1" data-line-number="1"></a>
<a class="sourceLine" id="cb50-2" data-line-number="2">$PLUGIN Rcpp mrgx</a></code></pre></div>
<p>Functions provided by <code>mrgx</code>:</p>
<ul>
<li><code>T get&lt;T&gt;(std::string &lt;pkgname&gt;, std::string &lt;objectname&gt;)</code>
<ul>
<li>This gets an object of any Rcpp-representable type (<code>T</code>) from any package</li>
</ul></li>
<li><code>T get&lt;T&gt;(std::string &lt;objectname)</code>
<ul>
<li>This gets an object of any Rcpp-representable type (<code>T</code>) from <code>.GlobalEnv</code></li>
</ul></li>
<li><code>T get&lt;T&gt;(std::string &lt;objectname&gt;, databox&amp; self)</code>
<ul>
<li>This gets an object of any Rcpp-representable type (<code>T</code>) from <code>$ENV</code></li>
</ul></li>
<li><code>double rnorm(double mean, double sd, double min, double max)</code>
<ul>
<li>Simulate one variate from a normal distribution that is between <code>min</code> and <code>max</code></li>
</ul></li>
<li><code>double rlognorm(double mean, double sd, double min, double max)</code>
<ul>
<li>Same as <code>mrgx::rnorm</code>, but the simulated value is passed to <code>exp</code> after simulating</li>
</ul></li>
<li><code>Rcpp::Function mt_fun()</code>
<ul>
<li>Returns <code>mrgsolve::mt_fun</code>; this is usually used when declaring a <code>R</code> function in <code>$GLOBAL</code></li>
<li>Example: <code>Rcpp::Function print = mrgx::mt_fun();</code></li>
</ul></li>
</ul>
<p><strong>IMPORTANT</strong> All of these functions are in the <code>mrgx</code> namespace. So, in order
to call these functions you must include <code>mrgx::</code> namespace identifier to the
front of the function name. For example, don’t use <code>rnorm(50,20,40,140)</code>; use
<code>mrgx::rnorm(50,20,40,140)</code>.</p>
<p><strong>Get a numeric vector from <code>$ENV</code></strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb51-1" data-line-number="1">[ PLUGIN ] Rcpp mrgx</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"></a>
<a class="sourceLine" id="cb51-3" data-line-number="3">[ ENV ]</a>
<a class="sourceLine" id="cb51-4" data-line-number="4">x &lt;- c(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb51-5" data-line-number="5"></a>
<a class="sourceLine" id="cb51-6" data-line-number="6">[ GLOBAL ]</a>
<a class="sourceLine" id="cb51-7" data-line-number="7">Rcpp::NumericVector x;</a>
<a class="sourceLine" id="cb51-8" data-line-number="8"></a>
<a class="sourceLine" id="cb51-9" data-line-number="9">[ PREAMBLE ]</a>
<a class="sourceLine" id="cb51-10" data-line-number="10">x = mrgx::get&lt;Rcpp::NumericVector&gt;(<span class="st">&quot;x&quot;</span>, self);</a></code></pre></div>
<p><strong>Get the <code>print</code> function from <code>package:base</code></strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb52-1" data-line-number="1">$PLUGIN Rcpp mrgx</a>
<a class="sourceLine" id="cb52-2" data-line-number="2"></a>
<a class="sourceLine" id="cb52-3" data-line-number="3">$GLOBAL</a>
<a class="sourceLine" id="cb52-4" data-line-number="4">Rcpp::Function print = mrgx::mt_fun();</a>
<a class="sourceLine" id="cb52-5" data-line-number="5"></a>
<a class="sourceLine" id="cb52-6" data-line-number="6">$PREAMBLE</a>
<a class="sourceLine" id="cb52-7" data-line-number="7">print = mrgx::get&lt;Rcpp::Function&gt;(<span class="st">&quot;base&quot;</span>, <span class="st">&quot;print&quot;</span>);</a>
<a class="sourceLine" id="cb52-8" data-line-number="8"></a>
<a class="sourceLine" id="cb52-9" data-line-number="9">$MAIN</a>
<a class="sourceLine" id="cb52-10" data-line-number="10">print(self.rown);</a></code></pre></div>
<p>Note that we declare the <code>print</code> in <code>$GLOBAL</code> and use the <code>mt_fun()</code> place holder.</p>
<p><strong>Simulate truncated normal variables</strong>
This simulates a weight that has mean 80, standard deviation 20 and is greater
than 40 and less than 140.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb53-1" data-line-number="1">$PLUGIN Rcpp mrgx</a>
<a class="sourceLine" id="cb53-2" data-line-number="2"></a>
<a class="sourceLine" id="cb53-3" data-line-number="3">$MAIN</a>
<a class="sourceLine" id="cb53-4" data-line-number="4"><span class="cf">if</span>(NEWIND &lt;=<span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb53-5" data-line-number="5">  <span class="dt">double</span> WT = mrgx::rnorm(<span class="dv">80</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">140</span>);</a>
<a class="sourceLine" id="cb53-6" data-line-number="6">}</a></code></pre></div>
<p>See also: <a href="model-specification.html#block-preamble">2.2.9</a>.</p>
</div>
<div id="block-theta" class="section level3">
<h3><span class="header-section-number">2.2.18</span> <code>$THETA</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: yes<br />
<strong>Options</strong>: <code>@annotated</code>, <code>@name</code></p>
<p>Use this code block as an efficient way to add to the parameter list where names
are determined by a prefix and a number. By default, the prefix is <code>THETA</code> and
the number sequentially numbers the input values.</p>
<p>For example:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb54-1" data-line-number="1">[ THETA ]</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span></a></code></pre></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb55-1" data-line-number="1">$PARAM THETA1 = <span class="fl">0.1</span>, THETA2 = <span class="fl">0.2</span>, THETA3 = <span class="fl">0.3</span></a></code></pre></div>
<p>Annotated example:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb56-1" data-line-number="1">$THETA @annotated</a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="fl">0.1</span> : Typical value of clearance (L/hr)</a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="fl">0.2</span> : Typical value of volume (L)</a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="fl">0.3</span> : Typical value of ka (<span class="dv">1</span>/hr)</a></code></pre></div>
<p>To change the prefix, use <code>@name</code> option</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb57-1" data-line-number="1">$THETA @name theta</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span></a></code></pre></div>
<p>would be equivalent to</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb58-1" data-line-number="1">[ PARAM ] theta1 = <span class="fl">0.1</span>, theta2 = <span class="fl">0.2</span>, theta3 = <span class="fl">0.3</span></a></code></pre></div>
<p>See also: <a href="model-specification.html#block-param">2.2.3</a> .</p>
</div>
<div id="block-nmxml" class="section level3">
<h3><span class="header-section-number">2.2.19</span> <code>$NMXML</code>  </h3>
<p><strong>Syntax</strong>: R<br />
<strong>Multiple allowed</strong>: yes</p>
<p>The <code>$NMXML</code> block lets you read and incorporate results from a NONMEM run into
your <code>mrgsolve</code> model. From the NONMEM run, <code>THETA</code> will be imported into your
parameter list (see <a href="model-specification.html#block-param">2.2.3</a> and <a href="model-components.html#component-param">1.1</a>), <code>OMEGA</code> will
be captured as an <code>$OMEGA</code> block (<a href="model-specification.html#block-omega">2.2.12</a>) and <code>SIGMA</code> will be
captured as a <code>$SIGMA</code> block (<a href="model-specification.html#block-sigma">2.2.13</a>). Users may optionally omit
any one of these from being imported.</p>
<p><code>$NMXML</code> contains a <code>project</code> argument and a <code>run</code> argument. By default, the
estimates are read from from the file <code>project/run/run.xml</code>. That is, it is
assumed that there is a directory named <code>run</code> that is inside the <code>project</code>
directory where <code>$NMXML</code> will find <code>run.xml</code>. Your NONMEM run directories may
not be organized in a way that is compatible with this default. In that case,
you will need to provide the <code>file</code> argument, which should be the path to the
<code>run.xml</code> file, either as a full path or as a path relative to the current
working directory.</p>
<p>For help on the arguments / options for <code>$NMXML</code>, please see the <code>?nmxml</code>
help topic in your <code>R</code> session after loading the <code>mrgsolve</code> package.</p>
<p><strong>An example</strong></p>
<p>There is a NONMEM run embedded in the <code>mrgsolve</code> package</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">path.package</span>(<span class="st">&quot;mrgsolve&quot;</span>),<span class="st">&quot;nonmem&quot;</span>)</a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="kw">list.files</span>(path, <span class="dt">recursive=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>.  [1] &quot;1005/1005.cat&quot;    &quot;1005/1005.coi&quot;    &quot;1005/1005.cor&quot;    &quot;1005/1005.cov&quot;   
.  [5] &quot;1005/1005.cpu&quot;    &quot;1005/1005.ctl&quot;    &quot;1005/1005.ext&quot;    &quot;1005/1005.grd&quot;   
.  [9] &quot;1005/1005.lst&quot;    &quot;1005/1005.phi&quot;    &quot;1005/1005.shk&quot;    &quot;1005/1005.shm&quot;   
. [13] &quot;1005/1005.tab&quot;    &quot;1005/1005.xml&quot;    &quot;1005/1005par.tab&quot; &quot;1005/INTER&quot;</code></pre>
<p>We can create a <code>mrgsolve</code> control stream that will import <code>THETA</code>, <code>OMEGA</code> and
<code>SIGMA</code> from that run using the <code>$NMXML</code> code block.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">code &lt;-<span class="st"> &#39;</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="st">$NMXML</span></a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="st">run = 1005</span></a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="st">project = path</span></a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="st">olabels = s_(ECL, EVC, EKA)</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="st">slabels = s_(PROP, ADD)</span></a>
<a class="sourceLine" id="cb61-7" data-line-number="7"></a>
<a class="sourceLine" id="cb61-8" data-line-number="8"><span class="st">$MAIN</span></a>
<a class="sourceLine" id="cb61-9" data-line-number="9"><span class="st">double CL = THETA1*exp(ECL);</span></a>
<a class="sourceLine" id="cb61-10" data-line-number="10"><span class="st">double V2 = THETA2*exp(EVC);</span></a>
<a class="sourceLine" id="cb61-11" data-line-number="11"><span class="st">double KA = THETA3*exp(EKA);</span></a>
<a class="sourceLine" id="cb61-12" data-line-number="12"><span class="st">double Q = THETA4;</span></a>
<a class="sourceLine" id="cb61-13" data-line-number="13"><span class="st">double V3 = THETA5;</span></a>
<a class="sourceLine" id="cb61-14" data-line-number="14"></a>
<a class="sourceLine" id="cb61-15" data-line-number="15"><span class="st">$PKMODEL ncmt=2, depot=TRUE</span></a>
<a class="sourceLine" id="cb61-16" data-line-number="16"></a>
<a class="sourceLine" id="cb61-17" data-line-number="17"><span class="st">$CMT GUT CENT PERIPH</span></a>
<a class="sourceLine" id="cb61-18" data-line-number="18"></a>
<a class="sourceLine" id="cb61-19" data-line-number="19"><span class="st">$TABLE</span></a>
<a class="sourceLine" id="cb61-20" data-line-number="20"><span class="st">double CP = (CENT/V2)*(1+PROP) + ADD/5;</span></a>
<a class="sourceLine" id="cb61-21" data-line-number="21"></a>
<a class="sourceLine" id="cb61-22" data-line-number="22"><span class="st">$CAPTURE CP</span></a>
<a class="sourceLine" id="cb61-23" data-line-number="23"></a>
<a class="sourceLine" id="cb61-24" data-line-number="24"><span class="st">$SET delta=4, end=96</span></a>
<a class="sourceLine" id="cb61-25" data-line-number="25"><span class="st">&#39;</span></a></code></pre></div>
<p><strong>NOTE</strong>: in order to use this code, we need to install the <code>xml2</code> package.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">mcode</span>(<span class="st">&quot;nmxml&quot;</span>, code, <span class="dt">quiet=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>. Loading required namespace: xml2</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">param</span>(mod)</a></code></pre></div>
<pre><code>. 
.  Model parameters (N=7):
.  name   value  . name   value
.  THETA1 9.51   | THETA5 113  
.  THETA2 22.8   | THETA6 1.02 
.  THETA3 0.0714 | THETA7 1.19 
.  THETA4 3.47   | .      .</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">revar</span>(mod)</a></code></pre></div>
<pre><code>. $omega
. $...
.              [,1]        [,2]        [,3]
. ECL:   0.21387884  0.12077020 -0.01162777
. EVC:   0.12077020  0.09451047 -0.03720637
. EKA:  -0.01162777 -0.03720637  0.04656315
. 
. 
. $sigma
. $...
.              [,1]      [,2]
. PROP:  0.04917071 0.0000000
. ADD:   0.00000000 0.2017688</code></pre>
</div>
<div id="block-include" class="section level3">
<h3><span class="header-section-number">2.2.20</span> <code>$INCLUDE</code>  </h3>
<p><strong>Syntax</strong>: text<br />
<strong>Multiple allowed</strong>: no</p>
<p>To include your own header file(s) in a model use <code>$INCLUDE</code></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb68-1" data-line-number="1">$INCLUDE</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">mystuff.h</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">otherstuff.h</a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb69-1" data-line-number="1">$INCLUDE</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">mystuff.h,  otherstuff.h</a></code></pre></div>
<p><code>mrgsolve</code> will insert proper <code>#include</code> preprocessor directives into the <code>C++</code>
code that gets compiled.</p>
<p><strong>Requirements</strong></p>
<ul>
<li>All header files listed in <code>$INCLUDE</code> are assumed (expected) to be under
the <code>project</code> directory; don’t use <code>$INCLUDE</code> for header files that are in
any other location</li>
<li>An error is generated if the header file does not exist</li>
<li>An error is generated if any quotation marks are found in the file name
(don’t use quotes around the file name; <code>mrgsolve</code> will take care of that)</li>
<li>A warning is issued if the header file does not end in <code>.h</code></li>
<li>When the header file is changed (MD5 checksum changes), the model will be
forced to be rebuilt (recompiled) when <code>mread</code> or <code>mcode</code> (but not
<code>mread_cache</code> or <code>mcode_cache</code>) is called; this feature is only available
for header files listed in <code>$INCLUDE</code> (see below)</li>
<li>Do not use <code>$INCLUDE</code> to include <code>Rcpp</code>, <code>boost</code>, <code>RcppArmadillo</code> or
<code>RcppEigen</code> headers; use the appropriate <code>$PLUGIN</code> instead</li>
</ul>
<p>For applications that don’t fit into the requirements listed above, users can
always include header files in the model in <code>$GLOBAL</code> like this:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb70-1" data-line-number="1">$GLOBAL</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="pp">#include </span><span class="im">&quot;/Users/me/libs/mystuff.h&quot;</span></a></code></pre></div>
<p>But be careful when doing this: if there are changes to <code>mystuff.h</code> but not to
any other part of the model specification, the model may not be fully compiled
when calling <code>mread</code>. In this case, always use <code>preclean=TRUE</code> argument to
<code>mread</code> to force the model to be built when calling <code>mread</code>.</p>
</div>
<div id="block-env" class="section level3">
<h3><span class="header-section-number">2.2.21</span> <code>$ENV</code>  </h3>
<p><strong>Syntax</strong>: R<br />
<strong>Multiple allowed</strong>: no</p>
<p>This block is all <code>R</code> code (just as you would code in a stand-alone <code>R</code> script.
The code is parsed and evaluated into a new environment when the model is
compiled. Objects inside <code>$ENV</code> can be utilized in different C++ functions
(see <a href="model-specification.html#block-plugin">2.2.17</a>) or other parts of the simulation process.</p>
<p>For example:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb71-1" data-line-number="1">$ENV</a>
<a class="sourceLine" id="cb71-2" data-line-number="2"></a>
<a class="sourceLine" id="cb71-3" data-line-number="3">Sigma &lt;- cmat(<span class="dv">1</span>,<span class="fl">0.6</span>,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb71-4" data-line-number="4"></a>
<a class="sourceLine" id="cb71-5" data-line-number="5">mu &lt;- c(<span class="dv">2</span>,<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb71-6" data-line-number="6"></a>
<a class="sourceLine" id="cb71-7" data-line-number="7">cama &lt;- function(mod) {</a>
<a class="sourceLine" id="cb71-8" data-line-number="8">  mod %&gt;%</a>
<a class="sourceLine" id="cb71-9" data-line-number="9">    ev(amt=<span class="dv">100</span>, ii=<span class="dv">12</span>, addl=<span class="dv">10</span>) %&gt;% </a>
<a class="sourceLine" id="cb71-10" data-line-number="10">    mrgsim(obsonly=TRUE,end=<span class="dv">120</span>)</a>
<a class="sourceLine" id="cb71-11" data-line-number="11">}</a></code></pre></div>
</div>
</div>
<div id="variables-and-macros" class="section level2">
<h2><span class="header-section-number">2.3</span> Variables and Macros</h2>
<p>This section describes some macros and internal variables that can be used in
model specification files. In the following section, we adopt the convention
that <code>CMT</code> stands for a compartment in the model.</p>
<p><strong>IMPORTANT NOTE</strong>:</p>
<p>It should be clear from the usage examples which variables can be set by the
user and which are to be read or checked. <strong>All internal variables are
pre-defined and pre-initialized by mrgsolve. <em>The user should never try to
declare an internal variable; this will always result in an compile-time
error</em></strong>.</p>
<div id="id" class="section level3">
<h3><span class="header-section-number">2.3.1</span> <code>ID</code></h3>
<p>The current subject identifier. <code>ID</code> is an alias for <code>self.id</code>.</p>
</div>
<div id="time" class="section level3">
<h3><span class="header-section-number">2.3.2</span> <code>TIME</code></h3>
<p>Gives the time in the current data set record. This is usually only used in
<code>$MAIN</code> or <code>$TABLE</code>. <code>TIME</code> is an alias for <code>self.time</code>. Contrast with
<code>SOLVERTIME</code>.</p>
</div>
<div id="solvertime" class="section level3">
<h3><span class="header-section-number">2.3.3</span> <code>SOLVERTIME</code></h3>
<p>Gives the time of the current timestep taken by the solver. <em>This is can only
be used in <code>$ODE</code></em>. Contrast with <code>TIME</code>.</p>
</div>
<div id="evid" class="section level3">
<h3><span class="header-section-number">2.3.4</span> <code>EVID</code></h3>
<p><code>EVID</code> is an event id indicator. <code>mrgsolve</code> recognized the following event IDs:</p>
<ul>
<li>0 = an observation record</li>
<li>1 = a bolus or infusion dose</li>
<li>2 = other type event, with solver reset</li>
<li>3 = system reset</li>
<li>4 = system reset and dose</li>
<li>8 = replace</li>
</ul>
<p><code>EVID</code> is an alias for <code>self.evid</code>.</p>
</div>
<div id="cmt" class="section level3">
<h3><span class="header-section-number">2.3.5</span> <code>CMT</code></h3>
<p><code>CMT</code> is the current compartment number. In this case, <code>CMT</code> is used literally
(not a stand-in for the name of a compartment). For example:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb72-1" data-line-number="1">$CMT GUT CENT PERIPH</a>
<a class="sourceLine" id="cb72-2" data-line-number="2"></a>
<a class="sourceLine" id="cb72-3" data-line-number="3">$MAIN</a>
<a class="sourceLine" id="cb72-4" data-line-number="4"></a>
<a class="sourceLine" id="cb72-5" data-line-number="5"><span class="cf">if</span>(CMT==<span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">  <span class="co">// ....</span></a>
<a class="sourceLine" id="cb72-7" data-line-number="7">}</a></code></pre></div>
<p>In the example, <code>GUT</code>, <code>CENT</code> and <code>PERIPH</code> are the amounts in the respective
compartments and <code>CMT</code> refers to the value of <code>CMT</code> in the data record /
data set.</p>
<p><code>CMT</code> is an alias for <code>self.cmt</code>.</p>
</div>
<div id="amt" class="section level3">
<h3><span class="header-section-number">2.3.6</span> <code>AMT</code></h3>
<p><code>AMT</code> is the current value of dose amount.</p>
<p><code>AMT</code> is an alias for <code>self.amt</code>.</p>
</div>
<div id="newind" class="section level3">
<h3><span class="header-section-number">2.3.7</span> <code>NEWIND</code></h3>
<p><code>NEWIND</code> is a new individual indicator, taking the following values:</p>
<ul>
<li>0 for the first event record of the data set</li>
<li>1 for the first event record of a subsequent individual</li>
<li>2 for subsequent event record for an individual</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb73-1" data-line-number="1">[ GLOBAL ]</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="dt">int</span> counter = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb73-3" data-line-number="3"></a>
<a class="sourceLine" id="cb73-4" data-line-number="4">[ MAIN ]</a>
<a class="sourceLine" id="cb73-5" data-line-number="5"><span class="cf">if</span>(NEWIND &lt;=<span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb73-6" data-line-number="6">  counter  = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb73-7" data-line-number="7">}</a></code></pre></div>
<p><code>NEWIND</code> is an alias for <code>self.newind</code>.</p>
</div>
<div id="self.cmt" class="section level3">
<h3><span class="header-section-number">2.3.8</span> <code>self.cmt</code></h3>
<p>The current compartment number regardless of whether it was given as <code>cmt</code> or
<code>CMT</code> in the data set. There is no alias for <code>self.cmt</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb74-1" data-line-number="1">$TABLE</a>
<a class="sourceLine" id="cb74-2" data-line-number="2"></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="dt">double</span> DV = CENT/VC + EPS(<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb74-4" data-line-number="4"></a>
<a class="sourceLine" id="cb74-5" data-line-number="5"><span class="cf">if</span>(self.cmt==<span class="dv">3</span>) DV = RESPOSE + EPS(<span class="dv">2</span>);</a></code></pre></div>
</div>
<div id="self.amt" class="section level3">
<h3><span class="header-section-number">2.3.9</span> <code>self.amt</code></h3>
<p>The current <code>amt</code> value regardless of whether it was given as <code>amt</code> or <code>AMT</code>
in the data set. There is no alias for <code>self.amt</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb75-1" data-line-number="1">[ PREAMBLE ]</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="dt">double</span> last_dose = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb75-3" data-line-number="3"></a>
<a class="sourceLine" id="cb75-4" data-line-number="4">[ MAIN ]</a>
<a class="sourceLine" id="cb75-5" data-line-number="5"></a>
<a class="sourceLine" id="cb75-6" data-line-number="6"><span class="cf">if</span>(EVID==<span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb75-7" data-line-number="7">  last_dose = self.amt;  </a>
<a class="sourceLine" id="cb75-8" data-line-number="8">}</a></code></pre></div>
</div>
<div id="self.nid" class="section level3">
<h3><span class="header-section-number">2.3.10</span> <code>self.nid</code></h3>
<p>The number of IDs in the data set.</p>
</div>
<div id="self.idn" class="section level3">
<h3><span class="header-section-number">2.3.11</span> <code>self.idn</code></h3>
<p>The current id number. Numbers start at 0 and increase by one to <code>self.nid-1</code>.</p>
</div>
<div id="self.nrow" class="section level3">
<h3><span class="header-section-number">2.3.12</span> <code>self.nrow</code></h3>
<p>The number of rows in the output data set.</p>
</div>
<div id="self.rown" class="section level3">
<h3><span class="header-section-number">2.3.13</span> <code>self.rown</code></h3>
<p>The current row number. Numbers start at 0 and increase by one to <code>self.rown-1</code>.</p>
</div>
<div id="self.tad" class="section level3">
<h3><span class="header-section-number">2.3.14</span> <code>self.tad()</code></h3>
<p>This is a function that calculates and returns the time after the most recent
dose. This function should be called in <code>$MAIN</code> every time <code>$MAIN</code> is called.</p>
<p>For example:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb76-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb76-2" data-line-number="2"></a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="dt">double</span> TAD = self.tad();</a></code></pre></div>
<p>Do not make this calculation depend on any test or condition; it must be called
every time <code>$MAIN</code> is called in order to see every dose.</p>
</div>
<div id="self.mtimetime" class="section level3">
<h3><span class="header-section-number">2.3.15</span> <code>self.mtime(&lt;time&gt;)</code></h3>
<p>This is a function that creates a modeled even time. The only argument is a
numeric time in the future for the current individual that indicates when a
discontinuity should be included in the simulation.</p>
<p>When when <code>self.mtime()</code> is called, a new record is added to the current
individual’s record set with <code>EVID</code> set to 2. This means that when the system
advances to this record (this time), the differential equation solver will
reset and restart, creating the discontinuity. The function returns the time of
this event so the user can work with it in subsequent code.</p>
<p>For example,</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb77-1" data-line-number="1">$PARAM change_point = <span class="fl">5.13</span>;</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"></a>
<a class="sourceLine" id="cb77-3" data-line-number="3">$MAIN</a>
<a class="sourceLine" id="cb77-4" data-line-number="4"></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="dt">double</span> KA = <span class="fl">1.1</span>;</a>
<a class="sourceLine" id="cb77-6" data-line-number="6"></a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="dt">double</span> mt1 = self.mtime(change_point);</a>
<a class="sourceLine" id="cb77-8" data-line-number="8"></a>
<a class="sourceLine" id="cb77-9" data-line-number="9"><span class="cf">if</span>(TIME &gt;= mt1) KA = <span class="fl">2.1</span>;  </a></code></pre></div>
</div>
<div id="self.stop" class="section level3">
<h3><span class="header-section-number">2.3.16</span> <code>self.stop()</code></h3>
<p>This <code>self</code> function is available to be called from <code>$PREAMBLE</code>, <code>$MAIN</code>,
and <code>$TABLE</code>. When this function is called, the entire problem is stopped upon
processing the next simulation record.</p>
<p>This might be called when something really bad happened and you just want to
stop the simulation with an error.</p>
</div>
<div id="self.stop_id" class="section level3">
<h3><span class="header-section-number">2.3.17</span> <code>self.stop_id()</code></h3>
<p>This <code>self</code> function is available to be called from <code>$PREAMBLE</code>, <code>$MAIN</code>,
and <code>$TABLE</code>. When this function is called, processing of the current individual
is stopped and missing values (<code>NA_real</code>) are filled in for remaining compartment’
and capture outputs.</p>
<p>This might be called when some condition is reached in the current individual
that indicates either that the rest of the outputs are inconsequential or there
was a problem with this particular individual.</p>
<p>See also <code>self.stop_id()</code> and <code>self.stop()</code>.</p>
</div>
<div id="self.stop_id_cf" class="section level3">
<h3><span class="header-section-number">2.3.18</span> <code>self.stop_id_cf()</code></h3>
<p>This <code>self</code> function is available to be called from <code>$PREAMBLE</code>, <code>$MAIN</code>,
and <code>$TABLE</code>. When this function is called, processing of the current individual
is stopped and current values are carried forward (<code>cf</code>) for the remaining
output records for that individual.</p>
<p>This might be called when some condition is reached in the current individual
that indicates either that the rest of the outputs are inconsequential or there
was a problem with this particular individual.</p>
<p>See also <code>self.stop_id_cf()</code> and <code>self.stop()</code>.</p>
</div>
<div id="etan" class="section level3">
<h3><span class="header-section-number">2.3.19</span> <code>ETA(n)</code></h3>
<p><code>ETA(n)</code> is the value of the subject-level variate drawn from the model
<code>OMEGA</code> matrix. <code>ETA(1)</code> through <code>ETA(25)</code> have default values of zero so
they may be used in a model even if appropriate <code>OMEGA</code> matrices have not been
provided.</p>
<p>For example:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb78-1" data-line-number="1">$OMEGA</a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"></a>
<a class="sourceLine" id="cb78-4" data-line-number="4">$MAIN</a>
<a class="sourceLine" id="cb78-5" data-line-number="5"><span class="dt">double</span> CL = TVCL*exp(ETA(<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb78-6" data-line-number="6"><span class="dt">double</span> VC = TVVC*exp(ETA(<span class="dv">2</span>));</a>
<a class="sourceLine" id="cb78-7" data-line-number="7"><span class="dt">double</span> KA = TVKA*exp(ETA(<span class="dv">3</span>));</a></code></pre></div>
<p>Here, we have a 3x3 <code>OMEGA</code> matrix. <code>ETA(1)</code>, <code>ETA(2)</code>, and <code>ETA(3)</code> will be
populated with variates drawn from this matrix. <code>ETA(4)</code> through <code>ETA(25)</code>
will be populated with zero.</p>
</div>
<div id="epsn" class="section level3">
<h3><span class="header-section-number">2.3.20</span> <code>EPS(n)</code></h3>
<p><code>EPS(n)</code> holds the current value of the observation-level random variates drawn
from <code>SIGMA</code>. The basic setup is the same as detailed in <code>ETA(n)</code>.</p>
<p>Example:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb79-1" data-line-number="1">[ CMT ] CENT</a>
<a class="sourceLine" id="cb79-2" data-line-number="2"></a>
<a class="sourceLine" id="cb79-3" data-line-number="3">[ PARAM ] CL=<span class="dv">1</span>, VC=<span class="dv">20</span></a>
<a class="sourceLine" id="cb79-4" data-line-number="4"></a>
<a class="sourceLine" id="cb79-5" data-line-number="5">[ SIGMA ] @labels ADD PROP</a>
<a class="sourceLine" id="cb79-6" data-line-number="6"><span class="dv">25</span> <span class="fl">0.0025</span></a>
<a class="sourceLine" id="cb79-7" data-line-number="7"></a>
<a class="sourceLine" id="cb79-8" data-line-number="8">[ TABLE ]</a>
<a class="sourceLine" id="cb79-9" data-line-number="9"><span class="dt">double</span> DV = (CENT/VC)*(<span class="dv">1</span>+PROP) + ADD;</a></code></pre></div>
</div>
<div id="tablename" class="section level3">
<h3><span class="header-section-number">2.3.21</span> <code>table(&lt;name&gt;)</code></h3>
<p>This macro has been deprecated. Users should <strong>not</strong> use code like this:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb80-1" data-line-number="1">[ TABLE ]</a>
<a class="sourceLine" id="cb80-2" data-line-number="2">table(CP) = CENT/VC;</a></code></pre></div>
<p>But rather this:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb81-1" data-line-number="1">$TABLE </a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="dt">double</span> CP = CENT/VC;</a>
<a class="sourceLine" id="cb81-3" data-line-number="3"></a>
<a class="sourceLine" id="cb81-4" data-line-number="4">$CAPTURE CP</a></code></pre></div>
<p>See: section <a href="model-specification.html#block-table">2.2.8</a> and also <a href="model-specification.html#block-capture">2.2.11</a></p>
</div>
<div id="spec-f" class="section level3">
<h3><span class="header-section-number">2.3.22</span> <code>F_CMT</code>  </h3>
<p>For the <code>CMT</code> compartment, sets the bioavailability fraction for that compartment.</p>
<p>Example:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb82-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb82-2" data-line-number="2">F_CENT = <span class="fl">0.7</span>;</a></code></pre></div>
</div>
<div id="spec-alag" class="section level3">
<h3><span class="header-section-number">2.3.23</span> <code>ALAG_CMT</code>  </h3>
<p>For the <code>CMT</code> compartment, sets the lag time for doses into that compartment.</p>
<p>Example:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb83-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">ALAG_GUT = <span class="fl">0.25</span>;</a></code></pre></div>
</div>
<div id="spec-r" class="section level3">
<h3><span class="header-section-number">2.3.24</span> <code>R_CMT</code>  </h3>
<p>For the <code>CMT</code> compartment, sets the infusion rate for that compartment. The
infusion rate is only set via <code>R_CMT</code> when <code>rate</code> in the data set or event
object is set to <code>-1</code>.</p>
<p>Example:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb84-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">R_CENT = <span class="dv">100</span>;</a></code></pre></div>
</div>
<div id="spec-d" class="section level3">
<h3><span class="header-section-number">2.3.25</span> <code>D_CMT</code>  </h3>
<p>For the <code>CMT</code> compartment, sets the infusion duration for that compartment.<br />
The infusion duration is only set via <code>D_CMT</code> when <code>rate</code> in the data set or
event object is set to <code>-2</code>.</p>
<p>Example:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb85-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">D_CENT = <span class="dv">2</span>;</a></code></pre></div>
</div>
</div>
<div id="new-variables" class="section level2">
<h2><span class="header-section-number">2.4</span> Derive new variables</h2>
<p>New <code>C++</code> variables may be derived in <code>$GLOBAL</code>, <code>$PREAMBLE</code> <code>$MAIN</code>, <code>$ODE</code> and
<code>$TABLE</code>. Because these are <code>C++</code> variables, the type of variable being used
must be declared. For the vast majority of applications, the <code>double</code> type is
used (double-precision numeric value).</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb86-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"></a>
<a class="sourceLine" id="cb86-3" data-line-number="3"><span class="dt">double</span> CLi = TVCL*exp(ETA(<span class="dv">1</span>));</a></code></pre></div>
<p>We want <code>CLi</code> to be a numeric value, so we use <code>double</code>. To initialize a <code>boolean</code>
variable (true / false), write</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb87-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="dt">bool</span> cure = false;</a></code></pre></div>
<div id="special-handling-for-double-int-bool" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Special handling for <code>double</code>, <code>int</code>, <code>bool</code></h3>
<p>When variables of the type <code>double</code>, <code>int</code>, and <code>bool</code> are declared and
initialized in <code>$PREAMBLE</code>, <code>$MAIN</code>, <code>$ODE</code>, <code>$TABLE</code>, mrgsolve will detect
those declarations, and modify the code so that the variables are actually
declared once in <code>$GLOBAL</code> not in <code>$MAIN</code>, <code>$ODE</code>, or <code>$TABLE</code>. This is done so
that variables declared in one code block (e.g. <code>$MAIN</code>) can be read and
modified in another code block (e.g. <code>$TABLE</code>).</p>
<p>For example, in the following code:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb88-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="dt">double</span> CLi = TVCL*exp(ETA(<span class="dv">1</span>));</a></code></pre></div>
<p>a double-precision numeric variable is created (<code>CLi</code>) in the <code>$MAIN</code> block.
When mrgsolve parses the model file, this code gets translated to</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb89-1" data-line-number="1">$GLOBAL</a>
<a class="sourceLine" id="cb89-2" data-line-number="2">namespace {</a>
<a class="sourceLine" id="cb89-3" data-line-number="3">  <span class="dt">double</span> CLi;</a>
<a class="sourceLine" id="cb89-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb89-5" data-line-number="5"></a>
<a class="sourceLine" id="cb89-6" data-line-number="6">$MAIN</a>
<a class="sourceLine" id="cb89-7" data-line-number="7">CLi = TVCL*exp(ETA(<span class="dv">1</span>));</a></code></pre></div>
<p>That is, <code>CLi</code> is declared in <code>$GLOBAL</code> in an unnamed namespace so that variables
like this are global variables within the model file only.</p>
<p>This way, we can still read the <code>CLi</code> variable in <code>$TABLE</code>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb90-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="dt">double</span> CLi = TVCL*exp(ETA(<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="dt">double</span> VCi = TVVC*exp(ETA(<span class="dv">2</span>));</a>
<a class="sourceLine" id="cb90-4" data-line-number="4"></a>
<a class="sourceLine" id="cb90-5" data-line-number="5">$TABLE</a>
<a class="sourceLine" id="cb90-6" data-line-number="6"><span class="dt">double</span> KEi = CLi/VCi;</a>
<a class="sourceLine" id="cb90-7" data-line-number="7"></a>
<a class="sourceLine" id="cb90-8" data-line-number="8">$CAPTURE KEi</a></code></pre></div>
<p>To declare a variable that is local to a particular code block:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb91-1" data-line-number="1">$MAIN</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"></a>
<a class="sourceLine" id="cb91-3" data-line-number="3">localdouble CLi = TVCL*exp(ETA(<span class="dv">1</span>));</a></code></pre></div>
<p>The <code>localdouble</code> type is still just a double-precision variable. The difference
is that it is protected from this re-declaration process and the variable
will be local to (in this case) the <code>$MAIN</code> block.</p>
</div>
<div id="using-other-types-globally" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Using other types globally</h3>
<p>As we noted in the previous section, <code>double</code>, <code>int</code>, and <code>bool</code> are processed
in a special way so that they are by default global to the file. Many times
we want to work with other variable types in a global manner. Whenever you
want a data structure to be accessible across functions (e.g. <code>$MAIN</code>, <code>$TABLE</code>,
etc.) they should be declared in <code>$GLOBAL</code>, optionally in an unnamed namespace.</p>
<p>For example:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb92-1" data-line-number="1">[ GLOBAL ]</a>
<a class="sourceLine" id="cb92-2" data-line-number="2">std::vector&lt;<span class="dt">double</span>&gt; myvec;</a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb93-1" data-line-number="1">[ GLOBAL ]</a>
<a class="sourceLine" id="cb93-2" data-line-number="2">namespace {</a>
<a class="sourceLine" id="cb93-3" data-line-number="3">  std::vector&lt;<span class="dt">double</span>&gt; myvec;</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">}</a></code></pre></div>
<p>In case that object needs some configuration prior to starting the problem,
use <code>$PREAMBLE</code> to do that work</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb94-1" data-line-number="1">[ GLOBAL ]</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">std::vector&lt;<span class="dt">double</span>&gt; myvec;</a>
<a class="sourceLine" id="cb94-3" data-line-number="3"></a>
<a class="sourceLine" id="cb94-4" data-line-number="4">[ PREAMBLE ] </a>
<a class="sourceLine" id="cb94-5" data-line-number="5">myvec.assign(<span class="dv">3</span>,<span class="dv">1</span>);</a></code></pre></div>
</div>
</div>
<div id="examples" class="section level2">
<h2><span class="header-section-number">2.5</span> Examples</h2>
<p>The following sections show example model specification. The intention is to
show how the different blocks, macros and variables can work together to make
a functional model. Some models are given purely for illustrative purpose and
may not be particularly useful in application.</p>
<div id="simple-pk-model" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Simple PK model</h3>
<p>Notes:</p>
<ul>
<li>Basic PK parameters are declared in <code>$PARAM</code>; every parameter needs to be
assigned a value</li>
<li>Two compartments <code>GUT</code> and <code>CENT</code> are declared in <code>$CMT</code>; using <code>$CMT</code>
assumes that both compartments start with 0 mass</li>
<li>Because we declared <code>GUT</code> and <code>CENT</code> as compartments, we write <code>dxdt_</code>
equations for both in <code>$ODE</code></li>
<li>In <code>$ODE</code>, we refer to parameters (<code>CL/VC/KA</code>) and the amounts in each
compartment at any particular time (<code>GUT</code> and <code>CENT</code>)</li>
<li><code>$ODE</code> should be <code>C++</code> code; each line ends in <code>;</code></li>
<li>We derive a variable called <code>CP</code> in <code>$TABLE</code> that has type <code>capture</code>; mrgsolve
will enter the <code>CP</code> name into the <code>$CAPTURE</code> block list</li>
</ul>
<div class="sourceCode" id="cb95"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb95-1" data-line-number="1">$PARAM CL = <span class="dv">1</span>, VC = <span class="dv">30</span>, KA = <span class="fl">1.3</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"></a>
<a class="sourceLine" id="cb95-3" data-line-number="3">$CMT GUT CENT</a>
<a class="sourceLine" id="cb95-4" data-line-number="4"></a>
<a class="sourceLine" id="cb95-5" data-line-number="5">$ODE</a>
<a class="sourceLine" id="cb95-6" data-line-number="6"></a>
<a class="sourceLine" id="cb95-7" data-line-number="7">dxdt_GUT = -KA*GUT;</a>
<a class="sourceLine" id="cb95-8" data-line-number="8">dxdt_CENT = KA*GUT - (CL/VC)*CENT;</a>
<a class="sourceLine" id="cb95-9" data-line-number="9"></a>
<a class="sourceLine" id="cb95-10" data-line-number="10">$TABLE</a>
<a class="sourceLine" id="cb95-11" data-line-number="11">capture CP = CENT/VC;</a></code></pre></div>
<p>This model can also be written without differential equations</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb96-1" data-line-number="1">[ PARAM ] CL = <span class="dv">1</span>, VC = <span class="dv">30</span>, KA = <span class="fl">1.3</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"></a>
<a class="sourceLine" id="cb96-3" data-line-number="3">[ PKMODEL ] cmt = <span class="st">&quot;CMT GUT CENT&quot;</span>, depot = TRUE</a>
<a class="sourceLine" id="cb96-4" data-line-number="4"></a>
<a class="sourceLine" id="cb96-5" data-line-number="5">$TABLE</a>
<a class="sourceLine" id="cb96-6" data-line-number="6">capture CP = CENT/VC;</a></code></pre></div>
</div>
<div id="pkpd-model" class="section level3">
<h3><span class="header-section-number">2.5.2</span> PK/PD model</h3>
<p>Notes:</p>
<ul>
<li>We use a preprocessor <code>#define</code> directive in <code>$GLOBAL</code>; everywhere in the
model where a <code>CP</code> token is found, the expression <code>(CENT/VC)</code> … with
parentheses … is inserted</li>
<li>We write the initial value for the <code>RESP</code> compartment in <code>$MAIN</code> as a
function of two parameters <code>KIN/KOUT</code></li>
<li>A new variable - <code>INH</code>- is declared and used in <code>$ODE</code></li>
<li>Since <code>CP</code> is defined as <code>CENT/VC</code>, we can “capture” that name/value in
<code>$CAPTURE</code></li>
<li>Both <code>$MAIN</code> and <code>$ODE</code> are <code>C++</code> code blocks; don’t forget to add the <code>;</code>
at the end of each statement</li>
</ul>
<div class="sourceCode" id="cb97"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb97-1" data-line-number="1">$PARAM CL = <span class="dv">1</span>, VC = <span class="dv">30</span>, KA = <span class="fl">1.3</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2">KIN = <span class="dv">100</span>, KOUT = <span class="dv">2</span>, IC50 = <span class="dv">2</span></a>
<a class="sourceLine" id="cb97-3" data-line-number="3"></a>
<a class="sourceLine" id="cb97-4" data-line-number="4">$GLOBAL</a>
<a class="sourceLine" id="cb97-5" data-line-number="5"><span class="pp">#define CP (CENT/VC)</span></a>
<a class="sourceLine" id="cb97-6" data-line-number="6"></a>
<a class="sourceLine" id="cb97-7" data-line-number="7">$CMT GUT CENT RESP</a>
<a class="sourceLine" id="cb97-8" data-line-number="8"></a>
<a class="sourceLine" id="cb97-9" data-line-number="9">$MAIN</a>
<a class="sourceLine" id="cb97-10" data-line-number="10">RESP_0 = KIN/KOUT;</a>
<a class="sourceLine" id="cb97-11" data-line-number="11"></a>
<a class="sourceLine" id="cb97-12" data-line-number="12">$ODE</a>
<a class="sourceLine" id="cb97-13" data-line-number="13"></a>
<a class="sourceLine" id="cb97-14" data-line-number="14"><span class="dt">double</span> INH = CP/(IC50+CP);</a>
<a class="sourceLine" id="cb97-15" data-line-number="15"></a>
<a class="sourceLine" id="cb97-16" data-line-number="16">dxdt_GUT = -KA*GUT;</a>
<a class="sourceLine" id="cb97-17" data-line-number="17">dxdt_CENT = KA*GUT - (CL/VC)*CENT;</a>
<a class="sourceLine" id="cb97-18" data-line-number="18">dxdt_RESP = KIN*(<span class="dv">1</span>-INH) - KOUT*CENT;</a>
<a class="sourceLine" id="cb97-19" data-line-number="19"></a>
<a class="sourceLine" id="cb97-20" data-line-number="20">$CAPTURE CP</a></code></pre></div>
</div>
<div id="population-pk-model-with-covariates-and-iov" class="section level3">
<h3><span class="header-section-number">2.5.3</span> Population PK model with covariates and IOV</h3>
<p>Notes:</p>
<ul>
<li>Use <code>$SET</code> to set the simulation time grid from 0 to 240 by 0.1</li>
<li>There are two <code>$OMEGA</code> matrices; we name them <code>IIV</code> and <code>IOV</code></li>
<li>The IIV “etas” are labeled as <code>ECL/EVC/EKA</code>; these are aliases to
<code>ETA(1)/ETA(2)/ETA(3)</code>. The <code>IOV</code> matrix is unlabeled; we must refer to
<code>ETA(4)/ETA(5)</code> for this</li>
<li>Because <code>ETA(1)</code> and <code>ETA(2)</code> are labeled, we can “capture” them as <code>ECL</code> and
<code>EVC</code></li>
<li>We added zeros for both <code>$OMEGA</code> matrices; all the etas will be zero until we
populate those matrices (section <a href="topics.html#topic-matrix-update">6.8</a>)</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb98-1" data-line-number="1">$PARAM TVCL = <span class="fl">1.3</span>, TVVC=<span class="dv">28</span>, TVKA=<span class="fl">0.6</span>, WT=<span class="dv">70</span>, OCC=<span class="dv">1</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"></a>
<a class="sourceLine" id="cb98-3" data-line-number="3">$SET delta=<span class="fl">0.1</span>, end=<span class="dv">240</span></a>
<a class="sourceLine" id="cb98-4" data-line-number="4"></a>
<a class="sourceLine" id="cb98-5" data-line-number="5">$CMT GUT CENT</a>
<a class="sourceLine" id="cb98-6" data-line-number="6"></a>
<a class="sourceLine" id="cb98-7" data-line-number="7">$MAIN</a>
<a class="sourceLine" id="cb98-8" data-line-number="8"></a>
<a class="sourceLine" id="cb98-9" data-line-number="9"><span class="dt">double</span> IOV = IOV1</a>
<a class="sourceLine" id="cb98-10" data-line-number="10"><span class="cf">if</span>(OCC==<span class="dv">2</span>) IOV = IOV2;</a>
<a class="sourceLine" id="cb98-11" data-line-number="11"></a>
<a class="sourceLine" id="cb98-12" data-line-number="12"><span class="dt">double</span> CLi = exp(log(TVCL) + <span class="fl">0.75</span>*log(WT/<span class="dv">70</span>) + ECL + IOV);</a>
<a class="sourceLine" id="cb98-13" data-line-number="13"><span class="dt">double</span> VCi = exp(log(TVVC) + EVC);</a>
<a class="sourceLine" id="cb98-14" data-line-number="14"><span class="dt">double</span> KAi = exp(log(TVKA) + EKA);</a>
<a class="sourceLine" id="cb98-15" data-line-number="15"></a>
<a class="sourceLine" id="cb98-16" data-line-number="16">$OMEGA @name IIV @labels ECL EVC EKA</a>
<a class="sourceLine" id="cb98-17" data-line-number="17"><span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb98-18" data-line-number="18">$OMEGA @name IOV @labels IOV1 IOV2</a>
<a class="sourceLine" id="cb98-19" data-line-number="19"><span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb98-20" data-line-number="20"></a>
<a class="sourceLine" id="cb98-21" data-line-number="21">$SIGMA <span class="dv">0</span></a>
<a class="sourceLine" id="cb98-22" data-line-number="22"></a>
<a class="sourceLine" id="cb98-23" data-line-number="23">$ODE</a>
<a class="sourceLine" id="cb98-24" data-line-number="24">dxdt_GUT = -KAi*GUT;</a>
<a class="sourceLine" id="cb98-25" data-line-number="25">dxdt_CENT = KAi*GUT - (CLi/VCi)*CENT;</a>
<a class="sourceLine" id="cb98-26" data-line-number="26"></a>
<a class="sourceLine" id="cb98-27" data-line-number="27">$TABLE</a>
<a class="sourceLine" id="cb98-28" data-line-number="28">capture CP = CENT/VCi;</a>
<a class="sourceLine" id="cb98-29" data-line-number="29"></a>
<a class="sourceLine" id="cb98-30" data-line-number="30">$CAPTURE IOV ECL EVC</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-components.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-set-chapter.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["user-guide.pdf"],
"toc": {
"collapse": "none",
"sharing": false
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
