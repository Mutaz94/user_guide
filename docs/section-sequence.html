<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 5 Simulation sequence | mrgsolve User Guide</title>
  <meta name="description" content="A guide to using mrgsolve.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 5 Simulation sequence | mrgsolve User Guide" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://mrgsolve.github.io/user_guide/" />
  
  <meta property="og:description" content="A guide to using mrgsolve." />
  <meta name="github-repo" content="mrgsolve/user_guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Simulation sequence | mrgsolve User Guide" />
  <meta name="twitter:site" content="@mrgsolve" />
  <meta name="twitter:description" content="A guide to using mrgsolve." />
  

<meta name="author" content="Metrum Research Group, LLC">


<meta name="date" content="2019-02-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="simulated-output.html">
<link rel="next" href="topics.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="bookstyle.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">User Guide: mrgsolve</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="model-components.html"><a href="model-components.html"><i class="fa fa-check"></i><b>1</b> Model components</a><ul>
<li class="chapter" data-level="1.1" data-path="model-components.html"><a href="model-components.html#component-param"><i class="fa fa-check"></i><b>1.1</b> Parameter list</a><ul>
<li class="chapter" data-level="1.1.1" data-path="model-components.html"><a href="model-components.html#central-role-of-parameters-in-planning-simulations"><i class="fa fa-check"></i><b>1.1.1</b> Central role of parameters in planning simulations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="model-components.html"><a href="model-components.html#component-init"><i class="fa fa-check"></i><b>1.2</b> Compartment list</a></li>
<li class="chapter" data-level="1.3" data-path="model-components.html"><a href="model-components.html#component-stime"><i class="fa fa-check"></i><b>1.3</b> Simulation time grid</a><ul>
<li class="chapter" data-level="1.3.1" data-path="model-components.html"><a href="model-components.html#component-tgrid"><i class="fa fa-check"></i><b>1.3.1</b> <code>tgrid</code> objects</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="model-components.html"><a href="model-components.html#solver-settings"><i class="fa fa-check"></i><b>1.4</b> Solver settings</a><ul>
<li class="chapter" data-level="1.4.1" data-path="model-components.html"><a href="model-components.html#atol"><i class="fa fa-check"></i><b>1.4.1</b> <code>atol</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="model-components.html"><a href="model-components.html#rtol"><i class="fa fa-check"></i><b>1.4.2</b> <code>rtol</code></a></li>
<li class="chapter" data-level="1.4.3" data-path="model-components.html"><a href="model-components.html#maxsteps"><i class="fa fa-check"></i><b>1.4.3</b> <code>maxsteps</code></a></li>
<li class="chapter" data-level="1.4.4" data-path="model-components.html"><a href="model-components.html#hmax"><i class="fa fa-check"></i><b>1.4.4</b> <code>hmax</code></a></li>
<li class="chapter" data-level="1.4.5" data-path="model-components.html"><a href="model-components.html#hmin"><i class="fa fa-check"></i><b>1.4.5</b> <code>hmin</code></a></li>
<li class="chapter" data-level="1.4.6" data-path="model-components.html"><a href="model-components.html#ixpr"><i class="fa fa-check"></i><b>1.4.6</b> <code>ixpr</code></a></li>
<li class="chapter" data-level="1.4.7" data-path="model-components.html"><a href="model-components.html#mxhnil"><i class="fa fa-check"></i><b>1.4.7</b> <code>mxhnil</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="model-components.html"><a href="model-components.html#functions"><i class="fa fa-check"></i><b>1.5</b> Functions</a><ul>
<li class="chapter" data-level="1.5.1" data-path="model-components.html"><a href="model-components.html#the-preamble-function"><i class="fa fa-check"></i><b>1.5.1</b> The <code>$PREAMBLE</code> function</a></li>
<li class="chapter" data-level="1.5.2" data-path="model-components.html"><a href="model-components.html#the-main-function"><i class="fa fa-check"></i><b>1.5.2</b> The <code>$MAIN</code> function</a></li>
<li class="chapter" data-level="1.5.3" data-path="model-components.html"><a href="model-components.html#the-ode-function"><i class="fa fa-check"></i><b>1.5.3</b> The <code>$ODE</code> function</a></li>
<li class="chapter" data-level="1.5.4" data-path="model-components.html"><a href="model-components.html#the-table-function"><i class="fa fa-check"></i><b>1.5.4</b> The <code>$TABLE</code> function</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="model-components.html"><a href="model-components.html#random-effect-variances"><i class="fa fa-check"></i><b>1.6</b> Random effect variances</a><ul>
<li class="chapter" data-level="1.6.1" data-path="model-components.html"><a href="model-components.html#omega"><i class="fa fa-check"></i><b>1.6.1</b> <code>OMEGA</code></a></li>
<li class="chapter" data-level="1.6.2" data-path="model-components.html"><a href="model-components.html#sigma"><i class="fa fa-check"></i><b>1.6.2</b> <code>SIGMA</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="model-specification.html"><a href="model-specification.html"><i class="fa fa-check"></i><b>2</b> Model specification</a><ul>
<li class="chapter" data-level="2.1" data-path="model-specification.html"><a href="model-specification.html#how-where-to-write-a-model"><i class="fa fa-check"></i><b>2.1</b> How / where to write a model</a><ul>
<li class="chapter" data-level="2.1.1" data-path="model-specification.html"><a href="model-specification.html#spec-separate-file"><i class="fa fa-check"></i><b>2.1.1</b> Separate file</a></li>
<li class="chapter" data-level="2.1.2" data-path="model-specification.html"><a href="model-specification.html#spec-inline"><i class="fa fa-check"></i><b>2.1.2</b> Inline / <code>code</code>  </a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="model-specification.html"><a href="model-specification.html#code-blocks"><i class="fa fa-check"></i><b>2.2</b> Code blocks</a><ul>
<li class="chapter" data-level="2.2.1" data-path="model-specification.html"><a href="model-specification.html#about-code-blocks"><i class="fa fa-check"></i><b>2.2.1</b> About code blocks</a></li>
<li class="chapter" data-level="2.2.2" data-path="model-specification.html"><a href="model-specification.html#block-param"><i class="fa fa-check"></i><b>2.2.2</b> <code>$PARAM</code>  </a></li>
<li class="chapter" data-level="2.2.3" data-path="model-specification.html"><a href="model-specification.html#block-fixed"><i class="fa fa-check"></i><b>2.2.3</b> <code>$FIXED</code>  </a></li>
<li class="chapter" data-level="2.2.4" data-path="model-specification.html"><a href="model-specification.html#cmt-and-init"><i class="fa fa-check"></i><b>2.2.4</b> <code>$CMT</code> and <code>$INIT</code></a></li>
<li class="chapter" data-level="2.2.5" data-path="model-specification.html"><a href="model-specification.html#block-main"><i class="fa fa-check"></i><b>2.2.5</b> <code>$MAIN</code>  </a></li>
<li class="chapter" data-level="2.2.6" data-path="model-specification.html"><a href="model-specification.html#block-ode"><i class="fa fa-check"></i><b>2.2.6</b> <code>$ODE</code>  </a></li>
<li class="chapter" data-level="2.2.7" data-path="model-specification.html"><a href="model-specification.html#block-table"><i class="fa fa-check"></i><b>2.2.7</b> <code>$TABLE</code>  </a></li>
<li class="chapter" data-level="2.2.8" data-path="model-specification.html"><a href="model-specification.html#block-preamble"><i class="fa fa-check"></i><b>2.2.8</b> <code>$PREAMBLE</code>  </a></li>
<li class="chapter" data-level="2.2.9" data-path="model-specification.html"><a href="model-specification.html#block-pred"><i class="fa fa-check"></i><b>2.2.9</b> <code>$PRED</code>  </a></li>
<li class="chapter" data-level="2.2.10" data-path="model-specification.html"><a href="model-specification.html#block-capture"><i class="fa fa-check"></i><b>2.2.10</b> <code>$CAPTURE</code>  </a></li>
<li class="chapter" data-level="2.2.11" data-path="model-specification.html"><a href="model-specification.html#block-omega"><i class="fa fa-check"></i><b>2.2.11</b> <code>$OMEGA</code>  </a></li>
<li class="chapter" data-level="2.2.12" data-path="model-specification.html"><a href="model-specification.html#block-sigma"><i class="fa fa-check"></i><b>2.2.12</b> <code>$SIGMA</code>  </a></li>
<li class="chapter" data-level="2.2.13" data-path="model-specification.html"><a href="model-specification.html#set"><i class="fa fa-check"></i><b>2.2.13</b> <code>$SET</code></a></li>
<li class="chapter" data-level="2.2.14" data-path="model-specification.html"><a href="model-specification.html#global"><i class="fa fa-check"></i><b>2.2.14</b> <code>$GLOBAL</code></a></li>
<li class="chapter" data-level="2.2.15" data-path="model-specification.html"><a href="model-specification.html#pkmodel"><i class="fa fa-check"></i><b>2.2.15</b> <code>$PKMODEL</code></a></li>
<li class="chapter" data-level="2.2.16" data-path="model-specification.html"><a href="model-specification.html#block-plugin"><i class="fa fa-check"></i><b>2.2.16</b> <code>$PLUGIN</code>  </a></li>
<li class="chapter" data-level="2.2.17" data-path="model-specification.html"><a href="model-specification.html#block-theta"><i class="fa fa-check"></i><b>2.2.17</b> <code>$THETA</code>  </a></li>
<li class="chapter" data-level="2.2.18" data-path="model-specification.html"><a href="model-specification.html#block-nmxml"><i class="fa fa-check"></i><b>2.2.18</b> <code>$NMXML</code>  </a></li>
<li class="chapter" data-level="2.2.19" data-path="model-specification.html"><a href="model-specification.html#block-include"><i class="fa fa-check"></i><b>2.2.19</b> <code>$INCLUDE</code>  </a></li>
<li class="chapter" data-level="2.2.20" data-path="model-specification.html"><a href="model-specification.html#block-env"><i class="fa fa-check"></i><b>2.2.20</b> <code>$ENV</code>  </a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="model-specification.html"><a href="model-specification.html#variables-and-macros"><i class="fa fa-check"></i><b>2.3</b> Variables and Macros</a><ul>
<li class="chapter" data-level="2.3.1" data-path="model-specification.html"><a href="model-specification.html#id"><i class="fa fa-check"></i><b>2.3.1</b> <code>ID</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="model-specification.html"><a href="model-specification.html#time"><i class="fa fa-check"></i><b>2.3.2</b> <code>TIME</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="model-specification.html"><a href="model-specification.html#solvertime"><i class="fa fa-check"></i><b>2.3.3</b> <code>SOLVERTIME</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="model-specification.html"><a href="model-specification.html#evid"><i class="fa fa-check"></i><b>2.3.4</b> <code>EVID</code></a></li>
<li class="chapter" data-level="2.3.5" data-path="model-specification.html"><a href="model-specification.html#newind"><i class="fa fa-check"></i><b>2.3.5</b> <code>NEWIND</code></a></li>
<li class="chapter" data-level="2.3.6" data-path="model-specification.html"><a href="model-specification.html#self.cmt"><i class="fa fa-check"></i><b>2.3.6</b> <code>self.cmt</code></a></li>
<li class="chapter" data-level="2.3.7" data-path="model-specification.html"><a href="model-specification.html#self.amt"><i class="fa fa-check"></i><b>2.3.7</b> <code>self.amt</code></a></li>
<li class="chapter" data-level="2.3.8" data-path="model-specification.html"><a href="model-specification.html#self.nid"><i class="fa fa-check"></i><b>2.3.8</b> <code>self.nid</code></a></li>
<li class="chapter" data-level="2.3.9" data-path="model-specification.html"><a href="model-specification.html#self.idn"><i class="fa fa-check"></i><b>2.3.9</b> <code>self.idn</code></a></li>
<li class="chapter" data-level="2.3.10" data-path="model-specification.html"><a href="model-specification.html#self.nrow"><i class="fa fa-check"></i><b>2.3.10</b> <code>self.nrow</code></a></li>
<li class="chapter" data-level="2.3.11" data-path="model-specification.html"><a href="model-specification.html#self.rown"><i class="fa fa-check"></i><b>2.3.11</b> <code>self.rown</code></a></li>
<li class="chapter" data-level="2.3.12" data-path="model-specification.html"><a href="model-specification.html#etan"><i class="fa fa-check"></i><b>2.3.12</b> <code>ETA(n)</code></a></li>
<li class="chapter" data-level="2.3.13" data-path="model-specification.html"><a href="model-specification.html#epsn"><i class="fa fa-check"></i><b>2.3.13</b> <code>EPS(n)</code></a></li>
<li class="chapter" data-level="2.3.14" data-path="model-specification.html"><a href="model-specification.html#tablename"><i class="fa fa-check"></i><b>2.3.14</b> <code>table(name)</code></a></li>
<li class="chapter" data-level="2.3.15" data-path="model-specification.html"><a href="model-specification.html#spec-f"><i class="fa fa-check"></i><b>2.3.15</b> <code>F_CMT</code>  </a></li>
<li class="chapter" data-level="2.3.16" data-path="model-specification.html"><a href="model-specification.html#spec-alag"><i class="fa fa-check"></i><b>2.3.16</b> <code>ALAG_CMT</code>  </a></li>
<li class="chapter" data-level="2.3.17" data-path="model-specification.html"><a href="model-specification.html#spec-r"><i class="fa fa-check"></i><b>2.3.17</b> <code>R_CMT</code>  </a></li>
<li class="chapter" data-level="2.3.18" data-path="model-specification.html"><a href="model-specification.html#spec-d"><i class="fa fa-check"></i><b>2.3.18</b> <code>D_CMT</code>  </a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-specification.html"><a href="model-specification.html#new-variables"><i class="fa fa-check"></i><b>2.4</b> Derive new variables</a></li>
<li class="chapter" data-level="2.5" data-path="model-specification.html"><a href="model-specification.html#examples"><i class="fa fa-check"></i><b>2.5</b> Examples</a><ul>
<li class="chapter" data-level="2.5.1" data-path="model-specification.html"><a href="model-specification.html#simple-pk-model"><i class="fa fa-check"></i><b>2.5.1</b> Simple PK model</a></li>
<li class="chapter" data-level="2.5.2" data-path="model-specification.html"><a href="model-specification.html#pkpd-model"><i class="fa fa-check"></i><b>2.5.2</b> PK/PD model</a></li>
<li class="chapter" data-level="2.5.3" data-path="model-specification.html"><a href="model-specification.html#population-pk-model-with-covariates-and-iov"><i class="fa fa-check"></i><b>2.5.3</b> Population PK model with covariates and IOV</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="input-data-sets.html"><a href="input-data-sets.html"><i class="fa fa-check"></i><b>3</b> Input data sets</a><ul>
<li class="chapter" data-level="3.1" data-path="input-data-sets.html"><a href="input-data-sets.html#datasets"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="input-data-sets.html"><a href="input-data-sets.html#data-set"><i class="fa fa-check"></i><b>3.2</b> Event data sets (<code>data</code>)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="input-data-sets.html"><a href="input-data-sets.html#two-types-of-data_set"><i class="fa fa-check"></i><b>3.2.1</b> Two types of <code>data_set</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="input-data-sets.html"><a href="input-data-sets.html#sorting-requirements"><i class="fa fa-check"></i><b>3.2.2</b> Sorting requirements</a></li>
<li class="chapter" data-level="3.2.3" data-path="input-data-sets.html"><a href="input-data-sets.html#creating-data-sets"><i class="fa fa-check"></i><b>3.2.3</b> Creating data sets</a></li>
<li class="chapter" data-level="3.2.4" data-path="input-data-sets.html"><a href="input-data-sets.html#example"><i class="fa fa-check"></i><b>3.2.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="input-data-sets.html"><a href="input-data-sets.html#idata-set"><i class="fa fa-check"></i><b>3.3</b> Individual data sets (<code>idata</code>)</a><ul>
<li class="chapter" data-level="3.3.1" data-path="input-data-sets.html"><a href="input-data-sets.html#use-case"><i class="fa fa-check"></i><b>3.3.1</b> Use case</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="input-data-sets.html"><a href="input-data-sets.html#numeric-only"><i class="fa fa-check"></i><b>3.4</b> Numeric data only</a></li>
<li class="chapter" data-level="3.5" data-path="input-data-sets.html"><a href="input-data-sets.html#pred-data"><i class="fa fa-check"></i><b>3.5</b> Data sets for use with <code>$PRED</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simulated-output.html"><a href="simulated-output.html"><i class="fa fa-check"></i><b>4</b> Simulated output</a><ul>
<li class="chapter" data-level="4.1" data-path="simulated-output.html"><a href="simulated-output.html#coercion-methods"><i class="fa fa-check"></i><b>4.1</b> Coercion methods</a></li>
<li class="chapter" data-level="4.2" data-path="simulated-output.html"><a href="simulated-output.html#query-methods"><i class="fa fa-check"></i><b>4.2</b> Query methods</a></li>
<li class="chapter" data-level="4.3" data-path="simulated-output.html"><a href="simulated-output.html#methods-for-dplyr-verbs"><i class="fa fa-check"></i><b>4.3</b> Methods for <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-sequence.html"><a href="section-sequence.html"><i class="fa fa-check"></i><b>5</b> Simulation sequence</a><ul>
<li class="chapter" data-level="5.1" data-path="section-sequence.html"><a href="section-sequence.html#functions-to-call"><i class="fa fa-check"></i><b>5.1</b> Functions to call</a></li>
<li class="chapter" data-level="5.2" data-path="section-sequence.html"><a href="section-sequence.html#problem-initiation"><i class="fa fa-check"></i><b>5.2</b> Problem initiation</a></li>
<li class="chapter" data-level="5.3" data-path="section-sequence.html"><a href="section-sequence.html#subject-initiation"><i class="fa fa-check"></i><b>5.3</b> Subject initiation</a></li>
<li class="chapter" data-level="5.4" data-path="section-sequence.html"><a href="section-sequence.html#sequence-for-a-single-record"><i class="fa fa-check"></i><b>5.4</b> Sequence for a single record</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="topics.html"><a href="topics.html"><i class="fa fa-check"></i><b>6</b> Topics</a><ul>
<li class="chapter" data-level="6.1" data-path="topics.html"><a href="topics.html#topic-annotated"><i class="fa fa-check"></i><b>6.1</b> Annotated model specification</a></li>
<li class="chapter" data-level="6.2" data-path="topics.html"><a href="topics.html#topic-init"><i class="fa fa-check"></i><b>6.2</b> Set initial conditions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="topics.html"><a href="topics.html#summary"><i class="fa fa-check"></i><b>6.2.1</b> Summary</a></li>
<li class="chapter" data-level="6.2.2" data-path="topics.html"><a href="topics.html#make-a-model-only-to-examine-init-behavior"><i class="fa fa-check"></i><b>6.2.2</b> Make a model only to examine <code>init</code> behavior</a></li>
<li class="chapter" data-level="6.2.3" data-path="topics.html"><a href="topics.html#example-pkpd-model-with-initial-condition"><i class="fa fa-check"></i><b>6.2.3</b> Example PK/PD model with initial condition</a></li>
<li class="chapter" data-level="6.2.4" data-path="topics.html"><a href="topics.html#remember-calling-init-will-let-you-check-to-see-what-is-going-on"><i class="fa fa-check"></i><b>6.2.4</b> Remember: calling <code>init</code> will let you check to see what is going on</a></li>
<li class="chapter" data-level="6.2.5" data-path="topics.html"><a href="topics.html#set-initial-conditions-via-idata"><i class="fa fa-check"></i><b>6.2.5</b> Set initial conditions via <code>idata</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="topics.html"><a href="topics.html#topic-parameter-update"><i class="fa fa-check"></i><b>6.3</b> Updating parameters</a><ul>
<li class="chapter" data-level="6.3.1" data-path="topics.html"><a href="topics.html#parameter-update-hierarchy"><i class="fa fa-check"></i><b>6.3.1</b> Parameter update hierarchy</a></li>
<li class="chapter" data-level="6.3.2" data-path="topics.html"><a href="topics.html#topic-parameter-update-base"><i class="fa fa-check"></i><b>6.3.2</b> Updating the base parameter list</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="topics.html"><a href="topics.html#topic-tgrid"><i class="fa fa-check"></i><b>6.4</b> Time grid objects</a></li>
<li class="chapter" data-level="6.5" data-path="topics.html"><a href="topics.html#topic-designs"><i class="fa fa-check"></i><b>6.5</b> Individualized sampling designs</a></li>
<li class="chapter" data-level="6.6" data-path="topics.html"><a href="topics.html#some-helpful-c"><i class="fa fa-check"></i><b>6.6</b> Some helpful <code>C++</code></a></li>
<li class="chapter" data-level="6.7" data-path="topics.html"><a href="topics.html#resimulate-eta-and-eps"><i class="fa fa-check"></i><b>6.7</b> Resimulate <code>ETA</code> and <code>EPS</code></a></li>
<li class="chapter" data-level="6.8" data-path="topics.html"><a href="topics.html#topic-matrix-update"><i class="fa fa-check"></i><b>6.8</b> Updating <code>$OMEGA</code> and <code>$SIGMA</code>  </a><ul>
<li class="chapter" data-level="6.8.1" data-path="topics.html"><a href="topics.html#matrix-helper-functions"><i class="fa fa-check"></i><b>6.8.1</b> Matrix helper functions</a></li>
<li class="chapter" data-level="6.8.2" data-path="topics.html"><a href="topics.html#fill-a-matrix-with-zeros"><i class="fa fa-check"></i><b>6.8.2</b> Fill a matrix with zeros</a></li>
<li class="chapter" data-level="6.8.3" data-path="topics.html"><a href="topics.html#example-unnamed-matrix"><i class="fa fa-check"></i><b>6.8.3</b> Example: unnamed matrix</a></li>
<li class="chapter" data-level="6.8.4" data-path="topics.html"><a href="topics.html#example-named-matrices"><i class="fa fa-check"></i><b>6.8.4</b> Example: named matrices</a></li>
<li class="chapter" data-level="6.8.5" data-path="topics.html"><a href="topics.html#example-unnamed-matrices"><i class="fa fa-check"></i><b>6.8.5</b> Example: unnamed matrices</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="topics.html"><a href="topics.html#topics-time-varying"><i class="fa fa-check"></i><b>6.9</b> Time varying covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>7</b> Installation</a></li>
<li class="divider"></li>
<li><a href="https://mrgsolve.github.io" target="blank">https://mrgsolve.github.io</a></li>
<li><a href="https:/metrumrg.com" target="blank">https://metrumrg.com</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">mrgsolve User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-sequence" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Simulation sequence</h1>
<p>This section is intended to help the user understand the steps <code>mrgsolve</code> takes when working through a simulation problem. The focus is on the order in which <code>mrgsolve</code> calls different user-defined functions as well as when parameter updates and output writing happens during the simulation sequence.</p>
<div id="functions-to-call" class="section level2">
<h2><span class="header-section-number">5.1</span> Functions to call</h2>
<p>The model specification results in the definition of four functions that <code>mrgsolve</code> calls during the simulation sequence. Naming them by their code block identifiers, the functions are</p>
<ol style="list-style-type: decimal">
<li><code>$PREAMBLE</code></li>
<li><code>$MAIN</code></li>
<li><code>$ODE</code></li>
<li><code>$TABLE</code></li>
</ol>
</div>
<div id="problem-initiation" class="section level2">
<h2><span class="header-section-number">5.2</span> Problem initiation</h2>
<p>Just prior to starting the problem (when <code>NEWIND</code> is equal to <code>0</code>), <code>mrgsolve</code> calls <code>$PREAMBLE</code>. This function is only called once during the simulation sequence. The goal of <code>$PREAMBLE</code> is to allow the user to work with different <code>C++</code> data structures to get them ready for the simulation run.</p>
</div>
<div id="subject-initiation" class="section level2">
<h2><span class="header-section-number">5.3</span> Subject initiation</h2>
<p>After the <code>$PREAMBLE</code> call, <code>mrgsolve</code> simulates each <code>ID</code> in the data set, one after another. <code>mrgsolve</code> runs this sequence just prior to simulating a given <code>ID</code></p>
<ol style="list-style-type: decimal">
<li>Copy any parameters that are found in the <code>idata_set</code> to the working parameter list</li>
<li>Copy any parameters that are found in the <code>data_set</code> to the working parameter list, with the copy being taken from the first actual data set row for that individual. If the first actual data set record in the data set is not the first record for the individual, <code>mrgsolve</code> still copies from the first data set record as long as the <code>fillbak</code> argument to <code>mrgsim</code> is <code>TRUE</code>.</li>
<li>Set initial estimates from the base initial estimate list</li>
<li>Copy initial estimates from <code>idata_set</code> if they are found there.</li>
<li>Call <code>$MAIN</code></li>
<li>Start simulating the records for that individual</li>
</ol>
</div>
<div id="sequence-for-a-single-record" class="section level2">
<h2><span class="header-section-number">5.4</span> Sequence for a single record</h2>
<p><code>mrgsolve</code> executes this sequence while working from record to record for a given <code>ID</code></p>
<ol style="list-style-type: decimal">
<li>If <code>nocb</code> (next observation carried backward) is <code>TRUE</code>, then parameters are copied from the current record if that is an actual data set record. Note that if <code>nocb</code> is <code>FALSE</code> then <code>locf</code> (first observation carried forward) is assumed to be <code>TRUE</code> (see below). This is the last parameters will be copied from any input data set prior to advancing the system (when <code>locf</code> is being used). Therefore, when parameter columns are found in both an <code>idata_set</code> and a <code>data_set</code>, it will be the value found in the <code>data_set</code> that will overwrite both the base list and any parameter value that was copied from an <code>idata_set</code>. It is not an error to have different parameter values in an <code>idata_set</code> and a <code>data-set</code>, but the value found in the <code>data_set</code> will be used when this happens. More on parameters and the parameter update sequence can be found in sections <a href="topics.html#topic-parameter-update">6.3</a> and <a href="model-components.html#component-param">1.1</a>.</li>
<li><code>$MAIN</code> is called</li>
<li>The system is advanced via <code>$ODE</code> or <code>$PKMODEL</code>, whichever one is invoked in the model specification file.</li>
<li>If the current record is a dosing record, the dose is implemented (e.g. bolus made or infusion started).</li>
<li>If the system is advancing according to <code>locf</code>, then parameters are copied from the current record if that is an actual data set record. This is in contrast to <code>nocb</code> advance (see above).</li>
<li>The <code>$TABLE</code> function is called</li>
<li>If the current record is marked for inclusion in the simulated output, results are written to the output matrix.</li>
<li>Continue to the next record in the individual.</li>
<li>Once the last record is processed in an individual, a new individual is started.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simulated-output.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="topics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["user-guide.pdf"],
"toc": {
"collapse": "none",
"sharing": false
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
